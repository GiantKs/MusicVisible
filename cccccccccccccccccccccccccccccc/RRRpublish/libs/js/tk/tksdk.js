var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,a,f){b!=Array.prototype&&b!=Object.prototype&&(b[a]=f.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var b=0;return function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+b++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(b){var a=0;return $jscomp.iteratorPrototype(function(){return a<b.length?{done:!1,value:b[a++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};$jscomp.iteratorFromArray=function(b,a){$jscomp.initSymbolIterator();b instanceof String&&(b+="");var f=0,e={next:function(){if(f<b.length){var c=f++;return{value:a(c,b[c]),done:!1}}e.next=function(){return{done:!0,value:void 0}};return e.next()}};e[Symbol.iterator]=function(){return e};return e};
$jscomp.polyfill=function(b,a,f,e){if(a){f=$jscomp.global;b=b.split(".");for(e=0;e<b.length-1;e++){var c=b[e];c in f||(f[c]={});f=f[c]}b=b[b.length-1];e=f[b];a=a(e);a!=e&&null!=a&&$jscomp.defineProperty(f,b,{configurable:!0,writable:!0,value:a})}};$jscomp.polyfill("Array.prototype.keys",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
(function(){var b=!1;if(void 0!==window.__SDKDEV__&&null!==window.__SDKDEV__&&"boolean"===typeof window.__SDKDEV__)try{b=window.__SDKDEV__}catch(f){b=!1}if(!b){b=decodeURIComponent(window.location.href);var a=b.indexOf("?");b=b.substring(a+1).match(/(^|&)debug=([^&]*)(&|$)/i);b=null!=b?b[2]:""}window.__TkSdkBuild__=!b;try{window.localStorage?window.localStorage.setItem("debug",b?"*":"none"):console.warn("[tk-sdk]window.localStorage is not exist!")}catch(f){console.warn("[tk-sdk]Browser does not support localStorage!")}})();
!function(b,a){"object"==typeof exports&&"object"==typeof module?module.exports=a():"function"==typeof define&&define.amd?define([],a):"object"==typeof exports?exports.io=a():b.io=a()}(this,function(){return function(b){function a(e){if(f[e])return f[e].exports;var c=f[e]={exports:{},id:e,loaded:!1};return b[e].call(c.exports,c,c.exports,a),c.loaded=!0,c.exports}var f={};return a.m=b,a.c=f,a.p="",a(0)}([function(b,a,f){function e(a,b){"object"===("undefined"==typeof a?"undefined":c(a))&&(b=a,a=void 0);
b=b||{};var e;a=d(a);var t=a.source,k=a.id,n=a.path;n=l[k]&&n in l[k].nsps;return b.forceNew||b["force new connection"]||!1===b.multiplex||n?(g("ignoring socket cache for %s",t),e=m(t,b)):(l[k]||(g("new io instance for %s",t),l[k]=m(t,b)),e=l[k]),a.query&&!b.query&&(b.query=a.query),e.socket(a.path,b)}var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":
typeof a},d=f(1),k=f(7),m=f(13),g=f(3)("socket.io-client");b.exports=a=e;var l=a.managers={};a.protocol=k.protocol;a.connect=e;a.Manager=f(13);a.Socket=f(39)},function(b,a,f){(function(a){var c=f(2),d=f(3)("socket.io-client:url");b.exports=function(b,e){var g=b;e=e||a.location;null==b&&(b=e.protocol+"//"+e.host);"string"==typeof b&&("/"===b.charAt(0)&&(b="/"===b.charAt(1)?e.protocol+b:e.host+b),/^(https?|wss?):\/\//.test(b)||(d("protocol-less url %s",b),b="undefined"!=typeof e?e.protocol+"//"+b:"https://"+
b),d("parse %s",b),g=c(b));g.port||(/^(http|ws)$/.test(g.protocol)?g.port="80":/^(http|ws)s$/.test(g.protocol)&&(g.port="443"));g.path=g.path||"/";b=-1!==g.host.indexOf(":")?"["+g.host+"]":g.host;return g.id=g.protocol+"://"+b+":"+g.port,g.href=g.protocol+"://"+b+(e&&e.port===g.port?"":":"+g.port),g}}).call(a,function(){return this}())},function(b,a){var f=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,
e="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");b.exports=function(a){var b=a,c=a.indexOf("["),m=a.indexOf("]");-1!=c&&-1!=m&&(a=a.substring(0,c)+a.substring(c,m).replace(/:/g,";")+a.substring(m,a.length));a=f.exec(a||"");for(var g={},l=14;l--;)g[e[l]]=a[l]||"";return-1!=c&&-1!=m&&(g.source=b,g.host=g.host.substring(1,g.host.length-1).replace(/;/g,":"),g.authority=g.authority.replace("[","").replace("]","").replace(/;/g,":"),g.ipv6uri=
!0),g}},function(b,a,f){(function(e){function c(){try{var b=a.storage.debug}catch(g){}return!b&&"undefined"!=typeof e&&"env"in e&&(b=e.env.DEBUG),b}a=b.exports=f(5);a.log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)};a.formatArgs=function(b){var c=this.useColors;if(b[0]=(c?"%c":"")+this.namespace+(c?" %c":" ")+b[0]+(c?"%c ":" ")+"+"+a.humanize(this.diff),c){c="color: "+this.color;b.splice(1,0,c,"color: inherit");var d=0,e=0;b[0].replace(/%[a-zA-Z%]/g,
function(a){"%%"!==a&&(d++,"%c"===a&&(e=d))});b.splice(e,0,c)}};a.save=function(b){try{null==b?a.storage.removeItem("debug"):a.storage.debug=b}catch(g){}};a.load=c;a.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&
window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)};var d=a;if("undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage)var k=chrome.storage.local;else a:{try{k=window.localStorage;break a}catch(m){}k=void 0}d.storage=k;a.colors="lightseagreen forestgreen goldenrod dodgerblue darkorchid crimson".split(" ");
a.formatters.j=function(a){try{return JSON.stringify(a)}catch(g){return"[UnexpectedJSONParseError]: "+g.message}};a.enable(c())}).call(a,f(4))},function(b,a){function f(){throw Error("setTimeout has not been defined");}function e(){throw Error("clearTimeout has not been defined");}function c(a){if(p===setTimeout)return setTimeout(a,0);if((p===f||!p)&&setTimeout)return p=setTimeout,setTimeout(a,0);try{return p(a,0)}catch(y){try{return p.call(null,a,0)}catch(F){return p.call(this,a,0)}}}function d(a){if(n===
clearTimeout)return clearTimeout(a);if((n===e||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(a);try{return n(a)}catch(y){try{return n.call(null,a)}catch(F){return n.call(this,a)}}}function k(){w&&u&&(w=!1,u.length?t=u.concat(t):A=-1,t.length&&m())}function m(){if(!w){var a=c(k);w=!0;for(var b=t.length;b;){u=t;for(t=[];++A<b;)u&&u[A].run();A=-1;b=t.length}u=null;w=!1;d(a)}}function g(a,b){this.fun=a;this.array=b}function l(){}b=b.exports={};try{var p="function"==typeof setTimeout?setTimeout:
f}catch(C){p=f}try{var n="function"==typeof clearTimeout?clearTimeout:e}catch(C){n=e}!0;var u,t=[],w=!1,A=-1;b.nextTick=function(a){var b=Array(arguments.length-1);if(1<arguments.length)for(var d=1;d<arguments.length;d++)b[d-1]=arguments[d];t.push(new g(a,b));1!==t.length||w||c(m)};g.prototype.run=function(){this.fun.apply(null,this.array)};b.title="browser";b.browser=!0;b.env={};b.argv=[];b.version="";b.versions={};b.on=l;b.addListener=l;b.once=l;b.off=l;b.removeListener=l;b.removeAllListeners=l;
b.emit=l;b.prependListener=l;b.prependOnceListener=l;b.listeners=function(a){return[]};b.binding=function(a){throw Error("process.binding is not supported");};b.cwd=function(){return"/"};b.chdir=function(a){throw Error("process.chdir is not supported");};b.umask=function(){return 0}},function(b,a,f){function e(b){var c,d=0;for(c in b)d=(d<<5)-d+b.charCodeAt(c),d|=0;return a.colors[Math.abs(d)%a.colors.length]}function c(b){function c(){if(c.enabled){var b=+new Date;c.diff=b-(d||b);c.prev=d;d=c.curr=
b;var e=Array(arguments.length);for(b=0;b<e.length;b++)e[b]=arguments[b];e[0]=a.coerce(e[0]);"string"!=typeof e[0]&&e.unshift("%O");var k=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,function(b,d){if("%%"===b)return b;k++;d=a.formatters[d];"function"==typeof d&&(b=d.call(c,e[k]),e.splice(k,1),k--);return b});a.formatArgs.call(c,e);(c.log||a.log||console.log.bind(console)).apply(c,e)}}return c.namespace=b,c.enabled=a.enabled(b),c.useColors=a.useColors(),c.color=e(b),"function"==typeof a.init&&a.init(c),c}a=
b.exports=c.debug=c["default"]=c;a.coerce=function(a){return a instanceof Error?a.stack||a.message:a};a.disable=function(){a.enable("")};a.enable=function(b){a.save(b);a.names=[];a.skips=[];for(var c=("string"==typeof b?b:"").split(/[\s,]+/),d=c.length,e=0;e<d;e++)c[e]&&(b=c[e].replace(/\*/g,".*?"),"-"===b[0]?a.skips.push(new RegExp("^"+b.substr(1)+"$")):a.names.push(new RegExp("^"+b+"$")))};a.enabled=function(b){var c;var d=0;for(c=a.skips.length;d<c;d++)if(a.skips[d].test(b))return!1;d=0;for(c=
a.names.length;d<c;d++)if(a.names[d].test(b))return!0;return!1};a.humanize=f(6);a.names=[];a.skips=[];a.formatters={};var d},function(b,a){function f(a){if(a=String(a),!(100<a.length))if(a=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(a)){var b=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case "years":case "year":case "yrs":case "yr":case "y":return b*g;case "days":case "day":case "d":return b*m;case "hours":case "hour":case "hrs":case "hr":case "h":return b*
k;case "minutes":case "minute":case "mins":case "min":case "m":return b*d;case "seconds":case "second":case "secs":case "sec":case "s":return b*c;case "milliseconds":case "millisecond":case "msecs":case "msec":case "ms":return b}}}function e(a,b,c){if(!(a<b))return a<1.5*b?Math.floor(a/b)+" "+c:Math.ceil(a/b)+" "+c+"s"}var c=1E3,d=60*c,k=60*d,m=24*k,g=365.25*m;b.exports=function(a,b){b=b||{};var n=typeof a;if("string"===n&&0<a.length)return f(a);if("number"===n&&!1===isNaN(a))return b["long"]?e(a,
m,"day")||e(a,k,"hour")||e(a,d,"minute")||e(a,c,"second")||a+" ms":a>=m?Math.round(a/m)+"d":a>=k?Math.round(a/k)+"h":a>=d?Math.round(a/d)+"m":a>=c?Math.round(a/c)+"s":a+"ms";throw Error("val is not a non-empty string or a valid number. val\x3d"+JSON.stringify(a));}},function(b,a,f){function e(){}function c(b){var c=""+b.type;return a.BINARY_EVENT!==b.type&&a.BINARY_ACK!==b.type||(c+=b.attachments+"-"),b.nsp&&"/"!==b.nsp&&(c+=b.nsp+","),null!=b.id&&(c+=b.id),null!=b.data&&(c+=JSON.stringify(b.data)),
l("encoded %j as %s",b,c),c}function d(a,b){n.removeBlobs(a,function(a){var d=n.deconstructPacket(a);a=c(d.packet);d=d.buffers;d.unshift(a);b(d)})}function k(){this.reconstructor=null}function m(a){this.reconPack=a;this.buffers=[]}function g(){return{type:a.ERROR,data:"parser error"}}var l=f(3)("socket.io-parser");b=f(8);var p=f(9),n=f(11),u=f(12);a.protocol=4;a.types="CONNECT DISCONNECT EVENT ACK ERROR BINARY_EVENT BINARY_ACK".split(" ");a.CONNECT=0;a.DISCONNECT=1;a.EVENT=2;a.ACK=3;a.ERROR=4;a.BINARY_EVENT=
5;a.BINARY_ACK=6;a.Encoder=e;a.Decoder=k;e.prototype.encode=function(b,e){(b.type!==a.EVENT&&b.type!==a.ACK||!p(b.data)||(b.type=b.type===a.EVENT?a.BINARY_EVENT:a.BINARY_ACK),l("encoding packet %j",b),a.BINARY_EVENT===b.type||a.BINARY_ACK===b.type)?d(b,e):(b=c(b),e([b]))};b(k.prototype);k.prototype.add=function(b){if("string"==typeof b){var c=0,d={type:Number(b.charAt(0))};if(null==a.types[d.type])b=g();else{if(a.BINARY_EVENT===d.type||a.BINARY_ACK===d.type){for(var e="";"-"!==b.charAt(++c)&&(e+=
b.charAt(c),c!=b.length););if(e!=Number(e)||"-"!==b.charAt(c))throw Error("Illegal attachments");d.attachments=Number(e)}if("/"===b.charAt(c+1))for(d.nsp="";++c;){e=b.charAt(c);if(","===e)break;if(d.nsp+=e,c===b.length)break}else d.nsp="/";e=b.charAt(c+1);if(""!==e&&Number(e)==e){for(d.id="";++c;){e=b.charAt(c);if(null==e||Number(e)!=e){--c;break}if(d.id+=b.charAt(c),c===b.length)break}d.id=Number(d.id)}if(b.charAt(++c)){b:{c=b.substr(c);try{d.data=JSON.parse(c)}catch(y){c=g();break b}c=d}d=c}b=(l("decoded %s as %j",
b,d),d)}a.BINARY_EVENT===b.type||a.BINARY_ACK===b.type?(this.reconstructor=new m(b),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",b)):this.emit("decoded",b)}else{if(!u(b)&&!b.base64)throw Error("Unknown type: "+b);if(!this.reconstructor)throw Error("got binary data when not reconstructing a packet");(b=this.reconstructor.takeBinaryData(b))&&(this.reconstructor=null,this.emit("decoded",b))}};k.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()};
m.prototype.takeBinaryData=function(a){return(this.buffers.push(a),this.buffers.length===this.reconPack.attachments)?(a=n.reconstructPacket(this.reconPack,this.buffers),this.finishedReconstruction(),a):null};m.prototype.finishedReconstruction=function(){this.reconPack=null;this.buffers=[]}},function(b,a,f){function e(a){if(a){for(var b in e.prototype)a[b]=e.prototype[b];return a}}b.exports=e;e.prototype.on=e.prototype.addEventListener=function(a,b){return this._callbacks=this._callbacks||{},(this._callbacks["$"+
a]=this._callbacks["$"+a]||[]).push(b),this};e.prototype.once=function(a,b){function c(){this.off(a,c);b.apply(this,arguments)}return c.fn=b,this.on(a,c),this};e.prototype.off=e.prototype.removeListener=e.prototype.removeAllListeners=e.prototype.removeEventListener=function(a,b){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var c=this._callbacks["$"+a];if(!c)return this;if(1==arguments.length)return delete this._callbacks["$"+a],this;for(var d,e=0;e<c.length;e++)if(d=
c[e],d===b||d.fn===b){c.splice(e,1);break}return this};e.prototype.emit=function(a){this._callbacks=this._callbacks||{};var b=[].slice.call(arguments,1),c=this._callbacks["$"+a];if(c){c=c.slice(0);for(var e=0,g=c.length;e<g;++e)c[e].apply(this,b)}return this};e.prototype.listeners=function(a){return this._callbacks=this._callbacks||{},this._callbacks["$"+a]||[]};e.prototype.hasListeners=function(a){return!!this.listeners(a).length}},function(b,a,f){(function(a){function c(b){if(!b||"object"!=typeof b)return!1;
if(d(b)){for(var e=0,n=b.length;e<n;e++)if(c(b[e]))return!0;return!1}if("function"==typeof a.Buffer&&a.Buffer.isBuffer&&a.Buffer.isBuffer(b)||"function"==typeof a.ArrayBuffer&&b instanceof ArrayBuffer||m&&b instanceof Blob||g&&b instanceof File)return!0;if(b.toJSON&&"function"==typeof b.toJSON&&1===arguments.length)return c(b.toJSON(),!0);for(e in b)if(Object.prototype.hasOwnProperty.call(b,e)&&c(b[e]))return!0;return!1}var d=f(10),e=Object.prototype.toString,m="function"==typeof a.Blob||"[object BlobConstructor]"===
e.call(a.Blob),g="function"==typeof a.File||"[object FileConstructor]"===e.call(a.File);b.exports=c}).call(a,function(){return this}())},function(b,a){var f={}.toString;b.exports=Array.isArray||function(a){return"[object Array]"==f.call(a)}},function(b,a,f){(function(b){function c(a,b){if(!a)return a;if(m(a)){var d={_placeholder:!0,num:b.length};return b.push(a),d}if(e(a)){d=Array(a.length);for(var n=0;n<a.length;n++)d[n]=c(a[n],b);return d}if("object"==typeof a&&!(a instanceof Date)){d={};for(n in a)d[n]=
c(a[n],b);return d}return a}function d(a,b){if(!a)return a;if(a&&a._placeholder)return b[a.num];if(e(a))for(var c=0;c<a.length;c++)a[c]=d(a[c],b);else if("object"==typeof a)for(c in a)a[c]=d(a[c],b);return a}var e=f(10),m=f(12),g=Object.prototype.toString,l="function"==typeof b.Blob||"[object BlobConstructor]"===g.call(b.Blob),p="function"==typeof b.File||"[object FileConstructor]"===g.call(b.File);a.deconstructPacket=function(a){var b=[];return a.data=c(a.data,b),a.attachments=b.length,{packet:a,
buffers:b}};a.reconstructPacket=function(a,b){return a.data=d(a.data,b),a.attachments=void 0,a};a.removeBlobs=function(a,b){function c(a,n,k){if(!a)return a;if(l&&a instanceof Blob||p&&a instanceof File){d++;var t=new FileReader;t.onload=function(){k?k[n]=this.result:g=this.result;--d||b(g)};t.readAsArrayBuffer(a)}else if(e(a))for(t=0;t<a.length;t++)c(a[t],t,a);else if("object"==typeof a&&!m(a))for(t in a)c(a[t],t,a)}var d=0,g=a;c(g);d||b(g)}}).call(a,function(){return this}())},function(b,a){(function(a){b.exports=
function(b){return a.Buffer&&a.Buffer.isBuffer(b)||a.ArrayBuffer&&b instanceof ArrayBuffer}}).call(a,function(){return this}())},function(b,a,f){function e(a,b){if(!(this instanceof e))return new e(a,b);a&&"object"===("undefined"==typeof a?"undefined":c(a))&&(b=a,a=void 0);b=b||{};b.path=b.path||"/socket.io";this.nsps={};this.subs=[];this.opts=b;this.reconnection(!1!==b.reconnection);this.reconnectionAttempts(b.reconnectionAttempts||1/0);this.reconnectionDelay(b.reconnectionDelay||1E3);this.reconnectionDelayMax(b.reconnectionDelayMax||
5E3);this.randomizationFactor(b.randomizationFactor||.5);this.backoff=new u({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()});this.timeout(null==b.timeout?2E4:b.timeout);this.readyState="closed";this.uri=a;this.connecting=[];this.lastPing=null;this.encoding=!1;this.packetBuffer=[];a=b.parser||m;this.encoder=new a.Encoder;this.decoder=new a.Decoder;(this.autoConnect=!1!==b.autoConnect)&&this.open()}var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?
function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},d=f(14),k=f(39);a=f(8);var m=f(7),g=f(41),l=f(42),p=f(3)("socket.io-client:manager"),n=f(37),u=f(43),t=Object.prototype.hasOwnProperty;b.exports=e;e.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var a in this.nsps)t.call(this.nsps,a)&&this.nsps[a].emit.apply(this.nsps[a],arguments)};e.prototype.updateSocketIds=function(){for(var a in this.nsps)t.call(this.nsps,
a)&&(this.nsps[a].id=this.generateId(a))};e.prototype.generateId=function(a){return("/"===a?"":a+"#")+this.engine.id};a(e.prototype);e.prototype.reconnection=function(a){return arguments.length?(this._reconnection=!!a,this):this._reconnection};e.prototype.reconnectionAttempts=function(a){return arguments.length?(this._reconnectionAttempts=a,this):this._reconnectionAttempts};e.prototype.reconnectionDelay=function(a){return arguments.length?(this._reconnectionDelay=a,this.backoff&&this.backoff.setMin(a),
this):this._reconnectionDelay};e.prototype.randomizationFactor=function(a){return arguments.length?(this._randomizationFactor=a,this.backoff&&this.backoff.setJitter(a),this):this._randomizationFactor};e.prototype.reconnectionDelayMax=function(a){return arguments.length?(this._reconnectionDelayMax=a,this.backoff&&this.backoff.setMax(a),this):this._reconnectionDelayMax};e.prototype.timeout=function(a){return arguments.length?(this._timeout=a,this):this._timeout};e.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&
this._reconnection&&0===this.backoff.attempts&&this.reconnect()};e.prototype.open=e.prototype.connect=function(a,b){if(p("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;p("opening %s",this.uri);var c=this.engine=d(this.uri,this.opts),e=this;this.readyState="opening";this.skipReconnect=!1;var k=g(c,"open",function(){e.onopen();a&&a()});b=g(c,"error",function(b){if(p("connect_error"),e.cleanup(),e.readyState="closed",e.emitAll("connect_error",b),a){var c=Error("Connection error");
c.data=b;a(c)}else e.maybeReconnectOnOpen()});if(!1!==this._timeout){var n=this._timeout;p("connect attempt will timeout after %d",n);var t=setTimeout(function(){p("connect attempt timed out after %d",n);k.destroy();c.close();c.emit("error","timeout");e.emitAll("connect_timeout",n)},n);this.subs.push({destroy:function(){clearTimeout(t)}})}return this.subs.push(k),this.subs.push(b),this};e.prototype.onopen=function(){p("open");this.cleanup();this.readyState="open";this.emit("open");var a=this.engine;
this.subs.push(g(a,"data",l(this,"ondata")));this.subs.push(g(a,"ping",l(this,"onping")));this.subs.push(g(a,"pong",l(this,"onpong")));this.subs.push(g(a,"error",l(this,"onerror")));this.subs.push(g(a,"close",l(this,"onclose")));this.subs.push(g(this.decoder,"decoded",l(this,"ondecoded")))};e.prototype.onping=function(){this.lastPing=new Date;this.emitAll("ping")};e.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)};e.prototype.ondata=function(a){this.decoder.add(a)};e.prototype.ondecoded=
function(a){this.emit("packet",a)};e.prototype.onerror=function(a){p("error",a);this.emitAll("error",a)};e.prototype.socket=function(a,b){function c(){~n(e.connecting,d)||e.connecting.push(d)}var d=this.nsps[a];if(!d){d=new k(this,a,b);this.nsps[a]=d;var e=this;d.on("connecting",c);d.on("connect",function(){d.id=e.generateId(a)});this.autoConnect&&c()}return d};e.prototype.destroy=function(a){a=n(this.connecting,a);~a&&this.connecting.splice(a,1);this.connecting.length||this.close()};e.prototype.packet=
function(a){p("writing packet %j",a);var b=this;a.query&&0===a.type&&(a.nsp+="?"+a.query);b.encoding?b.packetBuffer.push(a):(b.encoding=!0,this.encoder.encode(a,function(c){for(var d=0;d<c.length;d++)b.engine.write(c[d],a.options);b.encoding=!1;b.processPacketQueue()}))};e.prototype.processPacketQueue=function(){if(0<this.packetBuffer.length&&!this.encoding){var a=this.packetBuffer.shift();this.packet(a)}};e.prototype.cleanup=function(){p("cleanup");for(var a=this.subs.length,b=0;b<a;b++)this.subs.shift().destroy();
this.packetBuffer=[];this.encoding=!1;this.lastPing=null;this.decoder.destroy()};e.prototype.close=e.prototype.disconnect=function(){p("disconnect");this.skipReconnect=!0;this.reconnecting=!1;"opening"===this.readyState&&this.cleanup();this.backoff.reset();this.readyState="closed";this.engine&&this.engine.close()};e.prototype.onclose=function(a){p("onclose");this.cleanup();this.backoff.reset();this.readyState="closed";this.emit("close",a);this._reconnection&&!this.skipReconnect&&this.reconnect()};
e.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var a=this;if(this.backoff.attempts>=this._reconnectionAttempts)p("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var b=this.backoff.duration();p("will wait %dms before reconnect attempt",b);this.reconnecting=!0;var c=setTimeout(function(){a.skipReconnect||(p("attempting reconnect"),a.emitAll("reconnect_attempt",a.backoff.attempts),a.emitAll("reconnecting",a.backoff.attempts),
a.skipReconnect||a.open(function(b){b?(p("reconnect attempt error"),a.reconnecting=!1,a.reconnect(),a.emitAll("reconnect_error",b.data)):(p("reconnect success"),a.onreconnect())}))},b);this.subs.push({destroy:function(){clearTimeout(c)}})}};e.prototype.onreconnect=function(){var a=this.backoff.attempts;this.reconnecting=!1;this.backoff.reset();this.updateSocketIds();this.emitAll("reconnect",a)}},function(b,a,f){b.exports=f(15)},function(b,a,f){b.exports=f(16);b.exports.parser=f(23)},function(b,a,
f){(function(a){function c(b,d){if(!(this instanceof c))return new c(b,d);d=d||{};b&&"object"==typeof b&&(d=b,b=null);b?(b=p(b),d.hostname=b.host,d.secure="https"===b.protocol||"wss"===b.protocol,d.port=b.port,b.query&&(d.query=b.query)):d.host&&(d.hostname=p(d.host).host);this.secure=null!=d.secure?d.secure:a.location&&"https:"===location.protocol;d.hostname&&!d.port&&(d.port=this.secure?"443":"80");this.agent=d.agent||!1;this.hostname=d.hostname||(a.location?location.hostname:"localhost");this.port=
d.port||(a.location&&location.port?location.port:this.secure?443:80);this.query=d.query||{};"string"==typeof this.query&&(this.query=u.decode(this.query));this.upgrade=!1!==d.upgrade;this.path=(d.path||"/engine.io").replace(/\/$/,"")+"/";this.forceJSONP=!!d.forceJSONP;this.jsonp=!1!==d.jsonp;this.forceBase64=!!d.forceBase64;this.enablesXDR=!!d.enablesXDR;this.timestampParam=d.timestampParam||"t";this.timestampRequests=d.timestampRequests;this.transports=d.transports||["polling","websocket"];this.transportOptions=
d.transportOptions||{};this.readyState="";this.writeBuffer=[];this.prevBufferLen=0;this.policyPort=d.policyPort||843;this.rememberUpgrade=d.rememberUpgrade||!1;this.binaryType=null;this.onlyBinaryUpgrades=d.onlyBinaryUpgrades;this.perMessageDeflate=!1!==d.perMessageDeflate&&(d.perMessageDeflate||{});!0===this.perMessageDeflate&&(this.perMessageDeflate={});this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024);this.pfx=d.pfx||null;this.key=d.key||null;
this.passphrase=d.passphrase||null;this.cert=d.cert||null;this.ca=d.ca||null;this.ciphers=d.ciphers||null;this.rejectUnauthorized=void 0===d.rejectUnauthorized||d.rejectUnauthorized;this.forceNode=!!d.forceNode;b="object"==typeof a&&a;b.global===b&&(d.extraHeaders&&0<Object.keys(d.extraHeaders).length&&(this.extraHeaders=d.extraHeaders),d.localAddress&&(this.localAddress=d.localAddress));this.pingTimeoutTimer=this.pingIntervalTimer=this.pingTimeout=this.pingInterval=this.upgrades=this.id=null;this.open()}
var d=f(17),e=f(8),m=f(3)("engine.io-client:socket"),g=f(37),l=f(23),p=f(2),n=f(38),u=f(31);b.exports=c;c.priorWebsocketSuccess=!1;e(c.prototype);c.protocol=l.protocol;c.Socket=c;c.Transport=f(22);c.transports=f(17);c.parser=f(23);c.prototype.createTransport=function(a){m('creating transport "%s"',a);var b=this.query,c={},e;for(e in b)b.hasOwnProperty(e)&&(c[e]=b[e]);c.EIO=l.protocol;c.transport=a;b=this.transportOptions[a]||{};this.id&&(c.sid=this.id);return new d[a]({query:c,socket:this,agent:b.agent||
this.agent,hostname:b.hostname||this.hostname,port:b.port||this.port,secure:b.secure||this.secure,path:b.path||this.path,forceJSONP:b.forceJSONP||this.forceJSONP,jsonp:b.jsonp||this.jsonp,forceBase64:b.forceBase64||this.forceBase64,enablesXDR:b.enablesXDR||this.enablesXDR,timestampRequests:b.timestampRequests||this.timestampRequests,timestampParam:b.timestampParam||this.timestampParam,policyPort:b.policyPort||this.policyPort,pfx:b.pfx||this.pfx,key:b.key||this.key,passphrase:b.passphrase||this.passphrase,
cert:b.cert||this.cert,ca:b.ca||this.ca,ciphers:b.ciphers||this.ciphers,rejectUnauthorized:b.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:b.perMessageDeflate||this.perMessageDeflate,extraHeaders:b.extraHeaders||this.extraHeaders,forceNode:b.forceNode||this.forceNode,localAddress:b.localAddress||this.localAddress,requestTimeout:b.requestTimeout||this.requestTimeout,protocols:b.protocols||void 0})};c.prototype.open=function(){if(this.rememberUpgrade&&c.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))var a=
"websocket";else{if(0===this.transports.length){var b=this;return void setTimeout(function(){b.emit("error","No transports available")},0)}a=this.transports[0]}this.readyState="opening";try{a=this.createTransport(a)}catch(A){return this.transports.shift(),void this.open()}a.open();this.setTransport(a)};c.prototype.setTransport=function(a){m("setting transport %s",a.name);var b=this;this.transport&&(m("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners());this.transport=
a;a.on("drain",function(){b.onDrain()}).on("packet",function(a){b.onPacket(a)}).on("error",function(a){b.onError(a)}).on("close",function(){b.onClose("transport close")})};c.prototype.probe=function(a){function b(){if(l.onlyBinaryUpgrades){var b=!this.supportsBinary&&l.transport.supportsBinary;t=t||b}t||(m('probe transport "%s" opened',a),p.send([{type:"ping",data:"probe"}]),p.once("packet",function(b){if(!t)if("pong"===b.type&&"probe"===b.data){if(m('probe transport "%s" pong',a),l.upgrading=!0,
l.emit("upgrading",p),p)c.priorWebsocketSuccess="websocket"===p.name,m('pausing current transport "%s"',l.transport.name),l.transport.pause(function(){t||"closed"!==l.readyState&&(m("changing transport and sending upgrade packet"),f(),l.setTransport(p),p.send([{type:"upgrade"}]),l.emit("upgrade",p),p=null,l.upgrading=!1,l.flush())})}else m('probe transport "%s" failed',a),b=Error("probe error"),b.transport=p.name,l.emit("upgradeError",b)}))}function d(){t||(t=!0,f(),p.close(),p=null)}function e(b){var c=
Error("probe error: "+b);c.transport=p.name;d();m('probe transport "%s" failed because of error: %s',a,b);l.emit("upgradeError",c)}function g(){e("transport closed")}function n(){e("socket closed")}function k(a){p&&a.name!==p.name&&(m('"%s" works - aborting "%s"',a.name,p.name),d())}function f(){p.removeListener("open",b);p.removeListener("error",e);p.removeListener("close",g);l.removeListener("close",n);l.removeListener("upgrading",k)}m('probing transport "%s"',a);var p=this.createTransport(a,{probe:1}),
t=!1,l=this;c.priorWebsocketSuccess=!1;p.once("open",b);p.once("error",e);p.once("close",g);this.once("close",n);this.once("upgrading",k);p.open()};c.prototype.onOpen=function(){if(m("socket open"),this.readyState="open",c.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){m("starting upgrade probes");for(var a=0,b=this.upgrades.length;a<b;a++)this.probe(this.upgrades[a])}};c.prototype.onPacket=function(a){if("opening"===
this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(m('socket receive: type "%s", data "%s"',a.type,a.data),this.emit("packet",a),this.emit("heartbeat"),a.type){case "open":this.onHandshake(n(a.data));break;case "pong":this.setPing();this.emit("pong");break;case "error":var b=Error("server error");b.code=a.data;this.onError(b);break;case "message":this.emit("data",a.data),this.emit("message",a.data)}else m('packet received with socket readyState "%s"',this.readyState)};c.prototype.onHandshake=
function(a){this.emit("handshake",a);this.id=a.sid;this.transport.query.sid=a.sid;this.upgrades=this.filterUpgrades(a.upgrades);this.pingInterval=a.pingInterval;this.pingTimeout=a.pingTimeout;this.onOpen();"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))};c.prototype.onHeartbeat=function(a){clearTimeout(this.pingTimeoutTimer);var b=this;b.pingTimeoutTimer=setTimeout(function(){"closed"!==b.readyState&&b.onClose("ping timeout")},
a||b.pingInterval+b.pingTimeout)};c.prototype.setPing=function(){var a=this;clearTimeout(a.pingIntervalTimer);a.pingIntervalTimer=setTimeout(function(){m("writing ping packet - expecting pong within %sms",a.pingTimeout);a.ping();a.onHeartbeat(a.pingTimeout)},a.pingInterval)};c.prototype.ping=function(){var a=this;this.sendPacket("ping",function(){a.emit("ping")})};c.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen);this.prevBufferLen=0;0===this.writeBuffer.length?this.emit("drain"):
this.flush()};c.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(m("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))};c.prototype.write=c.prototype.send=function(a,b,c){return this.sendPacket("message",a,b,c),this};c.prototype.sendPacket=function(a,b,c,d){if("function"==typeof b&&(d=b,b=void 0),"function"==typeof c&&(d=
c,c=null),"closing"!==this.readyState&&"closed"!==this.readyState)c=c||{},c.compress=!1!==c.compress,a={type:a,data:b,options:c},this.emit("packetCreate",a),this.writeBuffer.push(a),d&&this.once("flush",d),this.flush()};c.prototype.close=function(){function a(){d.onClose("forced close");m("socket closing - telling transport to close");d.transport.close()}function b(){d.removeListener("upgrade",b);d.removeListener("upgradeError",b);a()}function c(){d.once("upgrade",b);d.once("upgradeError",b)}if("opening"===
this.readyState||"open"===this.readyState){this.readyState="closing";var d=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?c():a()}):this.upgrading?c():a()}return this};c.prototype.onError=function(a){m("socket error %j",a);c.priorWebsocketSuccess=!1;this.emit("error",a);this.onClose("transport error",a)};c.prototype.onClose=function(a,b){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)m('socket close with reason: "%s"',a),clearTimeout(this.pingIntervalTimer),
clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",a,b),this.writeBuffer=[],this.prevBufferLen=0};c.prototype.filterUpgrades=function(a){for(var b=[],c=0,d=a.length;c<d;c++)~g(this.transports,a[c])&&b.push(a[c]);return b}}).call(a,function(){return this}())},function(b,a,f){(function(b){var c=f(18),d=f(20),e=f(34),m=f(35);a.polling=function(a){var g,k=!1,n=
!1,f=!1!==a.jsonp;b.location&&(n="https:"===location.protocol,(k=location.port)||(k=n?443:80),k=a.hostname!==location.hostname||k!==a.port,n=a.secure!==n);if(a.xdomain=k,a.xscheme=n,g=new c(a),"open"in g&&!a.forceJSONP)return new d(a);if(!f)throw Error("JSONP disabled");return new e(a)};a.websocket=m}).call(a,function(){return this}())},function(b,a,f){(function(a){var c=f(19);b.exports=function(b){var d=b.xdomain,e=b.xscheme;b=b.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!d||c))return new XMLHttpRequest}catch(g){}try{if("undefined"!=
typeof XDomainRequest&&!e&&b)return new XDomainRequest}catch(g){}if(!d)try{return new (a[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(g){}}}).call(a,function(){return this}())},function(b,a){try{b.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(f){b.exports=!1}},function(b,a,f){(function(a){function c(){}function d(b){if(l.call(this,b),this.requestTimeout=b.requestTimeout,this.extraHeaders=b.extraHeaders,a.location){var c="https:"===location.protocol,
d=location.port;d||(d=c?443:80);this.xd=b.hostname!==a.location.hostname||d!==b.port;this.xs=b.secure!==c}}function e(a){this.method=a.method||"GET";this.uri=a.uri;this.xd=!!a.xd;this.xs=!!a.xs;this.async=!1!==a.async;this.data=void 0!==a.data?a.data:null;this.agent=a.agent;this.isBinary=a.isBinary;this.supportsBinary=a.supportsBinary;this.enablesXDR=a.enablesXDR;this.requestTimeout=a.requestTimeout;this.pfx=a.pfx;this.key=a.key;this.passphrase=a.passphrase;this.cert=a.cert;this.ca=a.ca;this.ciphers=
a.ciphers;this.rejectUnauthorized=a.rejectUnauthorized;this.extraHeaders=a.extraHeaders;this.create()}function m(){for(var a in e.requests)e.requests.hasOwnProperty(a)&&e.requests[a].abort()}var g=f(18),l=f(21),p=f(8),n=f(32),u=f(3)("engine.io-client:polling-xhr");b.exports=d;b.exports.Request=e;n(d,l);d.prototype.supportsBinary=!0;d.prototype.request=function(a){return a=a||{},a.uri=this.uri(),a.xd=this.xd,a.xs=this.xs,a.agent=this.agent||!1,a.supportsBinary=this.supportsBinary,a.enablesXDR=this.enablesXDR,
a.pfx=this.pfx,a.key=this.key,a.passphrase=this.passphrase,a.cert=this.cert,a.ca=this.ca,a.ciphers=this.ciphers,a.rejectUnauthorized=this.rejectUnauthorized,a.requestTimeout=this.requestTimeout,a.extraHeaders=this.extraHeaders,new e(a)};d.prototype.doWrite=function(a,b){a=this.request({method:"POST",data:a,isBinary:"string"!=typeof a&&void 0!==a});var c=this;a.on("success",b);a.on("error",function(a){c.onError("xhr post error",a)});this.sendXhr=a};d.prototype.doPoll=function(){u("xhr poll");var a=
this.request(),b=this;a.on("data",function(a){b.onData(a)});a.on("error",function(a){b.onError("xhr poll error",a)});this.pollXhr=a};p(e.prototype);e.prototype.create=function(){var b={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};b.pfx=this.pfx;b.key=this.key;b.passphrase=this.passphrase;b.cert=this.cert;b.ca=this.ca;b.ciphers=this.ciphers;b.rejectUnauthorized=this.rejectUnauthorized;var c=this.xhr=new g(b),d=this;try{u("xhr open %s: %s",this.method,this.uri);c.open(this.method,
this.uri,this.async);try{if(this.extraHeaders){c.setDisableHeaderCheck&&c.setDisableHeaderCheck(!0);for(var n in this.extraHeaders)this.extraHeaders.hasOwnProperty(n)&&c.setRequestHeader(n,this.extraHeaders[n])}}catch(y){}if("POST"===this.method)try{this.isBinary?c.setRequestHeader("Content-type","application/octet-stream"):c.setRequestHeader("Content-type","text/plain;charset\x3dUTF-8")}catch(y){}try{c.setRequestHeader("Accept","*/*")}catch(y){}"withCredentials"in c&&(c.withCredentials=!0);this.requestTimeout&&
(c.timeout=this.requestTimeout);this.hasXDR()?(c.onload=function(){d.onLoad()},c.onerror=function(){d.onError(c.responseText)}):c.onreadystatechange=function(){if(2===c.readyState){try{var a=c.getResponseHeader("Content-Type")}catch(F){}"application/octet-stream"===a&&(c.responseType="arraybuffer")}4===c.readyState&&(200===c.status||1223===c.status?d.onLoad():setTimeout(function(){d.onError(c.status)},0))};u("xhr data %s",this.data);c.send(this.data)}catch(y){return void setTimeout(function(){d.onError(y)},
0)}a.document&&(this.index=e.requestsCount++,e.requests[this.index]=this)};e.prototype.onSuccess=function(){this.emit("success");this.cleanup()};e.prototype.onData=function(a){this.emit("data",a);this.onSuccess()};e.prototype.onError=function(a){this.emit("error",a);this.cleanup(!0)};e.prototype.cleanup=function(b){if("undefined"!=typeof this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=c:this.xhr.onreadystatechange=c,b)try{this.xhr.abort()}catch(w){}a.document&&delete e.requests[this.index];
this.xhr=null}};e.prototype.onLoad=function(){try{try{var a=this.xhr.getResponseHeader("Content-Type")}catch(A){}var b="application/octet-stream"===a?this.xhr.response||this.xhr.responseText:this.xhr.responseText}catch(A){this.onError(A)}null!=b&&this.onData(b)};e.prototype.hasXDR=function(){return"undefined"!=typeof a.XDomainRequest&&!this.xs&&this.enablesXDR};e.prototype.abort=function(){this.cleanup()};e.requestsCount=0;e.requests={};a.document&&(a.attachEvent?a.attachEvent("onunload",m):a.addEventListener&&
a.addEventListener("beforeunload",m,!1))}).call(a,function(){return this}())},function(b,a,f){function e(a){var b=a&&a.forceBase64;l&&!b||(this.supportsBinary=!1);c.call(this,a)}var c=f(22),d=f(31),k=f(23);a=f(32);var m=f(33),g=f(3)("engine.io-client:polling");b.exports=e;var l=null!=(new (f(18))({xdomain:!1})).responseType;a(e,c);e.prototype.name="polling";e.prototype.doOpen=function(){this.poll()};e.prototype.pause=function(a){function b(){g("paused");c.readyState="paused";a()}var c=this;if(this.readyState=
"pausing",this.polling||!this.writable){var d=0;this.polling&&(g("we are currently polling - waiting to pause"),d++,this.once("pollComplete",function(){g("pre-pause polling complete");--d||b()}));this.writable||(g("we are currently writing - waiting to pause"),d++,this.once("drain",function(){g("pre-pause writing complete");--d||b()}))}else b()};e.prototype.poll=function(){g("polling");this.polling=!0;this.doPoll();this.emit("poll")};e.prototype.onData=function(a){var b=this;g("polling got data %s",
a);k.decodePayload(a,this.socket.binaryType,function(a,c,d){return"opening"===b.readyState&&b.onOpen(),"close"===a.type?(b.onClose(),!1):void b.onPacket(a)});"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():g('ignoring poll - transport state "%s"',this.readyState))};e.prototype.doClose=function(){function a(){g("writing close packet");b.write([{type:"close"}])}var b=this;"open"===this.readyState?(g("transport open - closing"),a()):(g("transport not open - deferring close"),
this.once("open",a))};e.prototype.write=function(a){var b=this;this.writable=!1;var c=function(){b.writable=!0;b.emit("drain")};k.encodePayload(a,this.supportsBinary,function(a){b.doWrite(a,c)})};e.prototype.uri=function(){var a=this.query||{},b=this.secure?"https":"http",c="";!1!==this.timestampRequests&&(a[this.timestampParam]=m());this.supportsBinary||a.sid||(a.b64=1);a=d.encode(a);this.port&&("https"===b&&443!==Number(this.port)||"http"===b&&80!==Number(this.port))&&(c=":"+this.port);a.length&&
(a="?"+a);var e=-1!==this.hostname.indexOf(":");return b+"://"+(e?"["+this.hostname+"]":this.hostname)+c+this.path+a}},function(b,a,f){function e(a){this.path=a.path;this.hostname=a.hostname;this.port=a.port;this.secure=a.secure;this.query=a.query;this.timestampParam=a.timestampParam;this.timestampRequests=a.timestampRequests;this.readyState="";this.agent=a.agent||!1;this.socket=a.socket;this.enablesXDR=a.enablesXDR;this.pfx=a.pfx;this.key=a.key;this.passphrase=a.passphrase;this.cert=a.cert;this.ca=
a.ca;this.ciphers=a.ciphers;this.rejectUnauthorized=a.rejectUnauthorized;this.forceNode=a.forceNode;this.extraHeaders=a.extraHeaders;this.localAddress=a.localAddress}var c=f(23);a=f(8);b.exports=e;a(e.prototype);e.prototype.onError=function(a,b){a=Error(a);return a.type="TransportError",a.description=b,this.emit("error",a),this};e.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this};e.prototype.close=function(){return"opening"!==
this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this};e.prototype.send=function(a){if("open"!==this.readyState)throw Error("Transport not open");this.write(a)};e.prototype.onOpen=function(){this.readyState="open";this.writable=!0;this.emit("open")};e.prototype.onData=function(a){a=c.decodePacket(a,this.socket.binaryType);this.onPacket(a)};e.prototype.onPacket=function(a){this.emit("packet",a)};e.prototype.onClose=function(){this.readyState="closed";this.emit("close")}},
function(b,a,f){(function(b){function c(b,c,d){if(!c)return a.encodeBase64Packet(b,d);var e=new FileReader;return e.onload=function(){b.data=e.result;a.encodePacket(b,c,!0,d)},e.readAsArrayBuffer(b.data)}function d(a,b,c){var d=Array(a.length);c=p(a.length,c);for(var e=function(a,c,e){b(c,function(b,c){d[a]=c;e(b,d)})},g=0;g<a.length;g++)e(g,a[g],c)}var e,m=f(24),g=f(9),l=f(25),p=f(26),n=f(27);b&&b.ArrayBuffer&&(e=f(29));var u="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),t=
"undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),w=u||t;a.protocol=3;var A=a.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},C=m(A),y={type:"error",data:"parser error"},F=f(30);a.encodePacket=function(d,e,g,k){"function"==typeof e&&(k=e,e=!1);"function"==typeof g&&(k=g,g=null);var f=void 0===d.data?void 0:d.data.buffer||d.data;if(b.ArrayBuffer&&f instanceof ArrayBuffer){if(e){g=d.data;e=new Uint8Array(g);g=new Uint8Array(1+g.byteLength);g[0]=A[d.type];for(d=
0;d<e.length;d++)g[d+1]=e[d];d=k(g.buffer)}else d=a.encodeBase64Packet(d,k);return d}if(F&&f instanceof b.Blob)return e?w?d=c(d,e,k):(e=new Uint8Array(1),e[0]=A[d.type],d=new F([e.buffer,d.data]),d=k(d)):d=a.encodeBase64Packet(d,k),d;if(f&&f.base64)return k("b"+a.packets[d.type]+d.data.data);e=A[d.type];return void 0!==d.data&&(e+=g?n.encode(String(d.data),{strict:!1}):String(d.data)),k(""+e)};a.encodeBase64Packet=function(c,d){var e="b"+a.packets[c.type];if(F&&c.data instanceof b.Blob){var g=new FileReader;
return g.onload=function(){var a=g.result.split(",")[1];d(e+a)},g.readAsDataURL(c.data)}try{var n=String.fromCharCode.apply(null,new Uint8Array(c.data))}catch(oa){c=new Uint8Array(c.data);n=Array(c.length);for(var k=0;k<c.length;k++)n[k]=c[k];n=String.fromCharCode.apply(null,n)}return e+=b.btoa(n),d(e)};a.decodePacket=function(b,c,d){if(void 0===b)return y;if("string"==typeof b){if("b"===b.charAt(0))return a.decodeBase64Packet(b.substr(1),c);if(c=d){c=b;try{c=n.decode(c,{strict:!1})}catch(K){c=!1}c=
(b=c,!1===b)}if(c)return y;d=b.charAt(0);return Number(d)==d&&C[d]?1<b.length?{type:C[d],data:b.substring(1)}:{type:C[d]}:y}d=(new Uint8Array(b))[0];b=l(b,1);return F&&"blob"===c&&(b=new F([b])),{type:C[d],data:b}};a.decodeBase64Packet=function(a,b){var c=C[a.charAt(0)];if(!e)return{type:c,data:{base64:!0,data:a.substr(1)}};a=e.decode(a.substr(1));return"blob"===b&&F&&(a=new F([a])),{type:c,data:a}};a.encodePayload=function(b,c,e){function n(b,d){a.encodePacket(b,!!k&&c,!1,function(a){d(null,a.length+
":"+a)})}"function"==typeof c&&(e=c,c=null);var k=g(b);return c&&k?F&&!w?a.encodePayloadAsBlob(b,e):a.encodePayloadAsArrayBuffer(b,e):b.length?void d(b,n,function(a,b){return e(b.join(""))}):e("0:")};a.decodePayload=function(b,c,d){if("string"!=typeof b)return a.decodePayloadAsBinary(b,c,d);"function"==typeof c&&(d=c,c=null);var e;if(""===b)return d(y,0,1);for(var g,n,k="",f=0,p=b.length;f<p;f++){var l=b.charAt(f);if(":"===l){if(""===k||k!=(g=Number(k))||(n=b.substr(f+1,g),k!=n.length))return d(y,
0,1);if(n.length){if(e=a.decodePacket(n,c,!1),y.type===e.type&&y.data===e.data)return d(y,0,1);if(!1===d(e,f+g,p))return}f+=g;k=""}else k+=l}return""!==k?d(y,0,1):void 0};a.encodePayloadAsArrayBuffer=function(b,c){function e(b,c){a.encodePacket(b,!0,!0,function(a){return c(null,a)})}return b.length?void d(b,e,function(a,b){a=b.reduce(function(a,b){var c;return c="string"==typeof b?b.length:b.byteLength,a+c.toString().length+c+2},0);var d=new Uint8Array(a),e=0;return b.forEach(function(a){var b="string"==
typeof a,c=a;if(b){c=new Uint8Array(a.length);for(var g=0;g<a.length;g++)c[g]=a.charCodeAt(g);c=c.buffer}b?d[e++]=0:d[e++]=1;a=c.byteLength.toString();for(g=0;g<a.length;g++)d[e++]=parseInt(a[g]);d[e++]=255;c=new Uint8Array(c);for(g=0;g<c.length;g++)d[e++]=c[g]}),c(d.buffer)}):c(new ArrayBuffer(0))};a.encodePayloadAsBlob=function(b,c){d(b,function(b,c){a.encodePacket(b,!0,!0,function(a){var b=new Uint8Array(1);if(b[0]=1,"string"==typeof a){for(var d=new Uint8Array(a.length),e=0;e<a.length;e++)d[e]=
a.charCodeAt(e);a=d.buffer;b[0]=0}d=(a instanceof ArrayBuffer?a.byteLength:a.size).toString();var g=new Uint8Array(d.length+1);for(e=0;e<d.length;e++)g[e]=parseInt(d[e]);if(g[d.length]=255,F)a=new F([b.buffer,g.buffer,a]),c(null,a)})},function(a,b){return c(new F(b))})};a.decodePayloadAsBinary=function(b,c,d){"function"==typeof c&&(d=c,c=null);for(var e=[];0<b.byteLength;){for(var g=new Uint8Array(b),k=0===g[0],n="",f=1;255!==g[f];f++){if(310<n.length)return d(y,0,1);n+=g[f]}b=l(b,2+n.length);n=parseInt(n);
g=l(b,0,n);if(k)try{g=String.fromCharCode.apply(null,new Uint8Array(g))}catch(pa){for(k=new Uint8Array(g),g="",f=0;f<k.length;f++)g+=String.fromCharCode(k[f])}e.push(g);b=l(b,n)}var p=e.length;e.forEach(function(b,e){d(a.decodePacket(b,c,!0),e,p)})}}).call(a,function(){return this}())},function(b,a){b.exports=Object.keys||function(a){var b=[],c=Object.prototype.hasOwnProperty,d;for(d in a)c.call(a,d)&&b.push(d);return b}},function(b,a){b.exports=function(a,b,c){var d=a.byteLength;if(b=b||0,c=c||d,
a.slice)return a.slice(b,c);if(0>b&&(b+=d),0>c&&(c+=d),c>d&&(c=d),b>=d||b>=c||0===d)return new ArrayBuffer(0);a=new Uint8Array(a);d=new Uint8Array(c-b);for(var e=0;b<c;b++,e++)d[e]=a[b];return d.buffer}},function(b,a){function f(){}b.exports=function(a,b,d){function c(a,k){if(0>=c.count)throw Error("after called too many times");--c.count;a?(e=!0,b(a),b=d):0!==c.count||e||b(null,k)}var e=!1;return d=d||f,c.count=a,0===a?b():c}},function(b,a,f){var e;(function(b,d){!function(c){function d(a){for(var b,
c,d=[],e=0,g=a.length;e<g;)b=a.charCodeAt(e++),55296<=b&&56319>=b&&e<g?(c=a.charCodeAt(e++),56320==(64512&c)?d.push(((1023&b)<<10)+(1023&c)+65536):(d.push(b),e--)):d.push(b);return d}function g(a,b){if(55296<=a&&57343>=a){if(b)throw Error("Lone surrogate U+"+a.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function k(){if(t>=u)throw Error("Invalid byte index");var a=255&n[t];if(t++,128==(192&a))return 63&a;throw Error("Invalid continuation byte");}function f(a){var b,c,d,e,
f;if(t>u)throw Error("Invalid byte index");if(t==u)return!1;if(b=255&n[t],t++,0==(128&b))return b;if(192==(224&b)){if(c=k(),f=(31&b)<<6|c,128<=f)return f;throw Error("Invalid continuation byte");}if(224==(240&b)){if(c=k(),d=k(),f=(15&b)<<12|c<<6|d,2048<=f)return g(f,a)?f:65533;throw Error("Invalid continuation byte");}if(240==(248&b)&&(c=k(),d=k(),e=k(),f=(7&b)<<18|c<<12|d<<6|e,65536<=f&&1114111>=f))return f;throw Error("Invalid UTF-8 detected");}c="object"==typeof a&&a;"object"==typeof b&&b&&b.exports==
c&&b;var n,u,t,w=String.fromCharCode;e={version:"2.1.2",encode:function(a,b){b=b||{};b=!1!==b.strict;a=d(a);for(var c=a.length,e=-1,n="";++e<c;){var k=a[e];var f=b;if(0==(4294967168&k))f=w(k);else{var p="";f=(0==(4294965248&k)?p=w(k>>6&31|192):0==(4294901760&k)?(g(k,f)||(k=65533),p=w(k>>12&15|224),p+=w(k>>6&63|128)):0==(4292870144&k)&&(p=w(k>>18&7|240),p+=w(k>>12&63|128),p+=w(k>>6&63|128)),p+w(63&k|128))}n+=f}return n},decode:function(a,b){b=b||{};b=!1!==b.strict;n=d(a);u=n.length;t=0;var c;for(a=
[];!1!==(c=f(b));)a.push(c);c=a.length;for(var e=-1,g="";++e<c;)b=a[e],65535<b&&(b-=65536,g+=w(b>>>10&1023|55296),b=56320|1023&b),g+=w(b);return g}};!(void 0!==e&&(b.exports=e))}(this)}).call(a,f(28)(b),function(){return this}())},function(b,a){b.exports=function(a){return a.webpackPolyfill||(a.deprecate=function(){},a.paths=[],a.children=[],a.webpackPolyfill=1),a}},function(b,a){!function(){for(var b=new Uint8Array(256),e=0;64>e;e++)b["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(e)]=
e;a.encode=function(a){var b=new Uint8Array(a),c=b.length,e="";for(a=0;a<c;a+=3)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[b[a]>>2],e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(3&b[a])<<4|b[a+1]>>4],e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(15&b[a+1])<<2|b[a+2]>>6],e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[63&b[a+2]];return 2===c%3?e=e.substring(0,e.length-1)+"\x3d":1===c%3&&(e=e.substring(0,
e.length-2)+"\x3d\x3d"),e};a.decode=function(a){var c=.75*a.length;var e=a.length,f=0;"\x3d"===a[a.length-1]&&(c--,"\x3d"===a[a.length-2]&&c--);var g=new ArrayBuffer(c),l=new Uint8Array(g);for(c=0;c<e;c+=4){var p=b[a.charCodeAt(c)];var n=b[a.charCodeAt(c+1)];var u=b[a.charCodeAt(c+2)];var t=b[a.charCodeAt(c+3)];l[f++]=p<<2|n>>4;l[f++]=(15&n)<<4|u>>2;l[f++]=(3&u)<<6|63&t}return g}}()},function(b,a){(function(a){function e(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.buffer instanceof ArrayBuffer){var d=
c.buffer;if(c.byteLength!==d.byteLength){var e=new Uint8Array(c.byteLength);e.set(new Uint8Array(d,c.byteOffset,c.byteLength));d=e.buffer}a[b]=d}}}function c(a,b){b=b||{};var c=new k;e(a);for(var d=0;d<a.length;d++)c.append(a[d]);return b.type?c.getBlob(b.type):c.getBlob()}function d(a,b){return e(a),new Blob(a,b||{})}var k=a.BlobBuilder||a.WebKitBlobBuilder||a.MSBlobBuilder||a.MozBlobBuilder;try{var f=2===(new Blob(["hi"])).size}catch(p){f=!1}var g;if(g=f)try{g=2===(new Blob([new Uint8Array([1,2])])).size}catch(p){g=
!1}var l=k&&k.prototype.append&&k.prototype.getBlob;b.exports=f?g?a.Blob:d:l?c:void 0}).call(a,function(){return this}())},function(b,a){a.encode=function(a){var b="",c;for(c in a)a.hasOwnProperty(c)&&(b.length&&(b+="\x26"),b+=encodeURIComponent(c)+"\x3d"+encodeURIComponent(a[c]));return b};a.decode=function(a){var b={};a=a.split("\x26");for(var c=0,d=a.length;c<d;c++){var k=a[c].split("\x3d");b[decodeURIComponent(k[0])]=decodeURIComponent(k[1])}return b}},function(b,a){b.exports=function(a,b){var c=
function(){};c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a}},function(b,a){function f(a){var b="";do b=d[a%k]+b,a=Math.floor(a/k);while(0<a);return b}function e(){var a=f(+new Date);return a!==c?(g=0,c=a):a+"."+f(g++)}for(var c,d="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),k=64,m={},g=0,l=0;l<k;l++)m[d[l]]=l;e.encode=f;e.decode=function(a){var b=0;for(l=0;l<a.length;l++)b=b*k+m[a.charAt(l)];return b};b.exports=e},function(b,a,f){(function(a){function c(){}
function d(b){e.call(this,b);this.query=this.query||{};g||(a.___eio||(a.___eio=[]),g=a.___eio);this.index=g.length;var d=this;g.push(function(a){d.onData(a)});this.query.j=this.index;a.document&&a.addEventListener&&a.addEventListener("beforeunload",function(){d.script&&(d.script.onerror=c)},!1)}var e=f(21),m=f(32);b.exports=d;var g,l=/\n/g,p=/\\n/g;m(d,e);d.prototype.supportsBinary=!1;d.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null);this.form&&
(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null);e.prototype.doClose.call(this)};d.prototype.doPoll=function(){var a=this,b=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null);b.async=!0;b.src=this.uri();b.onerror=function(b){a.onError("jsonp poll error",b)};var c=document.getElementsByTagName("script")[0];c?c.parentNode.insertBefore(b,c):(document.head||document.body).appendChild(b);this.script=b;"undefined"!=
typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var a=document.createElement("iframe");document.body.appendChild(a);document.body.removeChild(a)},100)};d.prototype.doWrite=function(a,b){function c(){d();b()}function d(){if(e.iframe)try{e.form.removeChild(e.iframe)}catch(U){e.onError("jsonp polling iframe removal error",U)}try{g=document.createElement('\x3ciframe src\x3d"javascript:0" name\x3d"'+e.iframeId+'"\x3e')}catch(U){g=document.createElement("iframe"),g.name=e.iframeId,
g.src="javascript:0"}g.id=e.iframeId;e.form.appendChild(g);e.iframe=g}var e=this;if(!this.form){var g,k=document.createElement("form"),n=document.createElement("textarea"),f=this.iframeId="eio_iframe_"+this.index;k.className="socketio";k.style.position="absolute";k.style.top="-1000px";k.style.left="-1000px";k.target=f;k.method="POST";k.setAttribute("accept-charset","utf-8");n.name="d";k.appendChild(n);document.body.appendChild(k);this.form=k;this.area=n}this.form.action=this.uri();d();a=a.replace(p,
"\\\n");this.area.value=a.replace(l,"\\n");try{this.form.submit()}catch(U){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===e.iframe.readyState&&c()}:this.iframe.onload=c}}).call(a,function(){return this}())},function(b,a,f){(function(a){function c(a){a&&a.forceBase64&&(this.supportsBinary=!1);this.perMessageDeflate=a.perMessageDeflate;this.usingBrowserWebSocket=n&&!a.forceNode;this.protocols=a.protocols;this.usingBrowserWebSocket||(t=u);d.call(this,a)}var d=f(22),e=
f(23),m=f(31),g=f(32),l=f(33),p=f(3)("engine.io-client:websocket"),n=a.WebSocket||a.MozWebSocket;if("undefined"==typeof window)try{var u=f(36)}catch(w){}var t=n;t||"undefined"!=typeof window||(t=u);b.exports=c;g(c,d);c.prototype.name="websocket";c.prototype.supportsBinary=!0;c.prototype.doOpen=function(){if(this.check()){var a=this.uri(),b=this.protocols,c={agent:this.agent,perMessageDeflate:this.perMessageDeflate};c.pfx=this.pfx;c.key=this.key;c.passphrase=this.passphrase;c.cert=this.cert;c.ca=this.ca;
c.ciphers=this.ciphers;c.rejectUnauthorized=this.rejectUnauthorized;this.extraHeaders&&(c.headers=this.extraHeaders);this.localAddress&&(c.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket?b?new t(a,b):new t(a):new t(a,b,c)}catch(y){return this.emit("error",y)}void 0===this.ws.binaryType&&(this.supportsBinary=!1);this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer";this.addEventListeners()}};c.prototype.addEventListeners=
function(){var a=this;this.ws.onopen=function(){a.onOpen()};this.ws.onclose=function(){a.onClose()};this.ws.onmessage=function(b){a.onData(b.data)};this.ws.onerror=function(b){a.onError("websocket error",b)}};c.prototype.write=function(b){function c(){d.emit("flush");setTimeout(function(){d.writable=!0;d.emit("drain")},0)}var d=this;this.writable=!1;for(var g=b.length,k=0,n=g;k<n;k++)!function(b){e.encodePacket(b,d.supportsBinary,function(e){if(!d.usingBrowserWebSocket){var k={};(b.options&&(k.compress=
b.options.compress),d.perMessageDeflate)&&("string"==typeof e?a.Buffer.byteLength(e):e.length)<d.perMessageDeflate.threshold&&(k.compress=!1)}try{d.usingBrowserWebSocket?d.ws.send(e):d.ws.send(e,k)}catch(S){p("websocket closed before onclose event")}--g||c()})}(b[k])};c.prototype.onClose=function(){d.prototype.onClose.call(this)};c.prototype.doClose=function(){"undefined"!=typeof this.ws&&this.ws.close()};c.prototype.uri=function(){var a=this.query||{},b=this.secure?"wss":"ws",c="";this.port&&("wss"===
b&&443!==Number(this.port)||"ws"===b&&80!==Number(this.port))&&(c=":"+this.port);this.timestampRequests&&(a[this.timestampParam]=l());this.supportsBinary||(a.b64=1);a=m.encode(a);a.length&&(a="?"+a);var d=-1!==this.hostname.indexOf(":");return b+"://"+(d?"["+this.hostname+"]":this.hostname)+c+this.path+a};c.prototype.check=function(){return!(!t||"__initialize"in t&&this.name===c.prototype.name)}}).call(a,function(){return this}())},function(b,a){},function(b,a){var f=[].indexOf;b.exports=function(a,
b){if(f)return a.indexOf(b);for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}},function(b,a){(function(a){var e=/^[\],:{}\s]*$/,c=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,d=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,k=/(?:^|:|,)(?:\s*\[)+/g,f=/^\s+/,g=/\s+$/;b.exports=function(b){return"string"==typeof b&&b?(b=b.replace(f,"").replace(g,""),a.JSON&&JSON.parse?JSON.parse(b):e.test(b.replace(c,"@").replace(d,"]").replace(k,""))?(new Function("return "+b))():void 0):null}}).call(a,
function(){return this}())},function(b,a,f){function e(a,b,c){this.io=a;this.nsp=b;this.json=this;this.ids=0;this.acks={};this.receiveBuffer=[];this.sendBuffer=[];this.connected=!1;this.disconnected=!0;c&&c.query&&(this.query=c.query);this.io.autoConnect&&this.open()}var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},d=f(7);a=f(8);var k=f(40),
m=f(41),g=f(42),l=f(3)("socket.io-client:socket"),p=f(31);b.exports=e;var n={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},u=a.prototype.emit;a(e.prototype);e.prototype.subEvents=function(){if(!this.subs){var a=this.io;this.subs=[m(a,"open",g(this,"onopen")),m(a,"packet",g(this,"onpacket")),m(a,"close",g(this,"onclose"))]}};e.prototype.open=e.prototype.connect=function(){return this.connected?
this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)};e.prototype.send=function(){var a=k(arguments);return a.unshift("message"),this.emit.apply(this,a),this};e.prototype.emit=function(a){if(n.hasOwnProperty(a))return u.apply(this,arguments),this;var b=k(arguments),c={type:d.EVENT,data:b};return c.options={},c.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof b[b.length-1]&&(l("emitting packet with ack id %d",this.ids),
this.acks[this.ids]=b.pop(),c.id=this.ids++),this.connected?this.packet(c):this.sendBuffer.push(c),delete this.flags,this};e.prototype.packet=function(a){a.nsp=this.nsp;this.io.packet(a)};e.prototype.onopen=function(){if(l("transport is open - connecting"),"/"!==this.nsp)if(this.query){var a="object"===c(this.query)?p.encode(this.query):this.query;l("sending connect packet with query %s",a);this.packet({type:d.CONNECT,query:a})}else this.packet({type:d.CONNECT})};e.prototype.onclose=function(a){l("close (%s)",
a);this.connected=!1;this.disconnected=!0;delete this.id;this.emit("disconnect",a)};e.prototype.onpacket=function(a){if(a.nsp===this.nsp)switch(a.type){case d.CONNECT:this.onconnect();break;case d.EVENT:this.onevent(a);break;case d.BINARY_EVENT:this.onevent(a);break;case d.ACK:this.onack(a);break;case d.BINARY_ACK:this.onack(a);break;case d.DISCONNECT:this.ondisconnect();break;case d.ERROR:this.emit("error",a.data)}};e.prototype.onevent=function(a){var b=a.data||[];l("emitting event %j",b);null!=
a.id&&(l("attaching ack callback to event"),b.push(this.ack(a.id)));this.connected?u.apply(this,b):this.receiveBuffer.push(b)};e.prototype.ack=function(a){var b=this,c=!1;return function(){if(!c){c=!0;var e=k(arguments);l("sending ack %j",e);b.packet({type:d.ACK,id:a,data:e})}}};e.prototype.onack=function(a){var b=this.acks[a.id];"function"==typeof b?(l("calling ack %s with %j",a.id,a.data),b.apply(this,a.data),delete this.acks[a.id]):l("bad ack %s",a.id)};e.prototype.onconnect=function(){this.connected=
!0;this.disconnected=!1;this.emit("connect");this.emitBuffered()};e.prototype.emitBuffered=function(){var a;for(a=0;a<this.receiveBuffer.length;a++)u.apply(this,this.receiveBuffer[a]);this.receiveBuffer=[];for(a=0;a<this.sendBuffer.length;a++)this.packet(this.sendBuffer[a]);this.sendBuffer=[]};e.prototype.ondisconnect=function(){l("server disconnect (%s)",this.nsp);this.destroy();this.onclose("io server disconnect")};e.prototype.destroy=function(){if(this.subs){for(var a=0;a<this.subs.length;a++)this.subs[a].destroy();
this.subs=null}this.io.destroy(this)};e.prototype.close=e.prototype.disconnect=function(){return this.connected&&(l("performing disconnect (%s)",this.nsp),this.packet({type:d.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this};e.prototype.compress=function(a){return this.flags=this.flags||{},this.flags.compress=a,this}},function(b,a){b.exports=function(a,b){for(var c=[],d=(b=b||0)||0;d<a.length;d++)c[d-b]=a[d];return c}},function(b,a){b.exports=function(a,b,c){return a.on(b,
c),{destroy:function(){a.removeListener(b,c)}}}},function(b,a){var f=[].slice;b.exports=function(a,b){if("string"==typeof b&&(b=a[b]),"function"!=typeof b)throw Error("bind() requires a function");var c=f.call(arguments,2);return function(){return b.apply(a,c.concat(f.call(arguments)))}}},function(b,a){function f(a){a=a||{};this.ms=a.min||100;this.max=a.max||1E4;this.factor=a.factor||2;this.jitter=0<a.jitter&&1>=a.jitter?a.jitter:0;this.attempts=0}b.exports=f;f.prototype.duration=function(){var a=
this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var b=Math.random(),d=Math.floor(b*this.jitter*a);a=0==(1&Math.floor(10*b))?a-d:a+d}return 0|Math.min(a,this.max)};f.prototype.reset=function(){this.attempts=0};f.prototype.setMin=function(a){this.ms=a};f.prototype.setMax=function(a){this.max=a};f.prototype.setJitter=function(a){this.jitter=a}}])});var TK=TK||{};
TK.EventDispatcher=function(b){var a={};b.dispatcher={};b.dispatcher.eventListeners={};b.dispatcher.backupListerners={};a.addEventListener=function(a,e,c){void 0!==a&&null!==a&&(void 0===b.dispatcher.eventListeners[a]&&(b.dispatcher.eventListeners[a]=[]),b.dispatcher.eventListeners[a].push(e),c&&(void 0===b.dispatcher.backupListerners[c]&&(b.dispatcher.backupListerners[c]=[]),b.dispatcher.backupListerners[c].push({eventType:a,listener:e})))};a.removeEventListener=function(a,e){b.dispatcher.eventListeners[a]?(e=
b.dispatcher.eventListeners[a].indexOf(e),-1!==e&&b.dispatcher.eventListeners[a].splice(e,1)):L.Logger.info("[tk-sdk]not event type: "+a)};a.removeAllEventListener=function(f){if(f&&"object"===typeof f&&"number"===typeof f.length&&"function"===typeof f.splice&&!f.propertyIsEnumerable("length"))for(var e in f){var c=f[e];delete b.dispatcher.eventListeners[c]}else if("string"===typeof f)delete b.dispatcher.eventListeners[f];else if("object"===typeof f)for(var d in f)c=d,a.removeEventListener(c,f[d])};
a.dispatchEvent=function(a,e){var c;(void 0!=e?e:1)&&L.Logger.debug("sdk-dispatchEvent , event type: "+a.type);for(c in b.dispatcher.eventListeners[a.type])if(b.dispatcher.eventListeners[a.type].hasOwnProperty(c))b.dispatcher.eventListeners[a.type][c](a)};a.removeBackupListerner=function(f){if(f&&b.dispatcher.backupListerners[f]){for(var e=0;e<b.dispatcher.backupListerners[f].length;e++){var c=b.dispatcher.backupListerners[f][e];a.removeEventListener(c.eventType,c.listener)}b.dispatcher.backupListerners[f].length=
0;delete b.dispatcher.backupListerners[f]}};return a};TK.TalkEvent=function(b){var a={};a.type=b.type;return a};TK.RoomEvent=function(b,a){var f=TK.TalkEvent(b);f.streams=b.streams;f.message=b.message;f.user=b.user;if(a&&"object"===typeof a)for(var e in a)f[e]=a[e];return f};TK.StreamEvent=function(b,a){var f=TK.TalkEvent(b);f.stream=b.stream;f.message=b.message;f.bandwidth=b.bandwidth;f.attrs=b.attrs;if(a&&"object"===typeof a)for(var e in a)f[e]=a[e];return f};
TK.PublisherEvent=function(b,a){b=TK.TalkEvent(b);if(a&&"object"===typeof a)for(var f in a)b[f]=a[f];return b};TK.coreEventController=TK.EventDispatcher({});TK=TK||{};
TK.FcStack=function(b){var a={pcConfig:{},peerConnection:{},desc:{},signalCallback:void 0},f=f||{};a.close=function(){f.Logger.debug("[tk-sdk]Close FcStack")};a.createOffer=function(){f.Logger.debug("[tk-sdk]FCSTACK: CreateOffer")};a.addStream=function(a){f.Logger.debug("[tk-sdk]FCSTACK: addStream",a)};a.removeStream=function(a){f.Logger.debug("[tk-sdk]FCSTACK: removeStream",a)};a.processSignalingMessage=function(b){f.Logger.debug("[tk-sdk]FCSTACK: processSignaling",b);void 0!==a.signalCallback&&a.signalCallback(b)};
a.sendSignalingMessage=function(a){f.Logger.debug("[tk-sdk]FCSTACK: Sending signaling Message",a);b.callback(a)};a.setSignalingCallback=function(b){f.Logger.debug("[tk-sdk]FCSTACK: Setting signalling callback");a.signalCallback=b};return a};TK=TK||{};
TK.FirefoxStack=function(b){var a={},f=mozRTCPeerConnection,e=mozRTCSessionDescription,c=mozRTCIceCandidate;a.pcConfig={iceServers:[]};void 0!==b.iceServers&&(a.pcConfig.iceServers=b.iceServers);void 0===b.audio&&(b.audio=!0);void 0===b.video&&(b.video=!0);a.mediaConstraints={offerToReceiveAudio:!0,offerToReceiveVideo:!0,mozDontOfferDataChannel:!0};var d=function(a){L.Logger.error("[tk-sdk]Error in Stack ",a)},k=function(){b.video&&b.simulcast&&a.peerConnection.getSenders().forEach(function(a){"video"===a.track.kind&&
(a.getParameters(),a.setParameters({encodings:[{rid:"spam",active:!0,priority:"high",maxBitrate:4E4,maxHeight:640,maxWidth:480},{rid:"egg",active:!0,priority:"medium",maxBitrate:1E4,maxHeight:320,maxWidth:240}]}))})},m=!1;a.peerConnection=new f(a.pcConfig,a.con);b.localCandidates=[];a.peerConnection.onicecandidate=function(a){a.candidate?(m=!0,a.candidate.candidate.match(/a=/)||(a.candidate.candidate="a\x3d"+a.candidate.candidate),a=a.candidate,b.remoteDescriptionSet?b.callback({type:"candidate",
candidate:a}):(b.localCandidates.push(a),L.Logger.debug("[tk-sdk]Local Candidates stored: ",b.localCandidates.length,b.localCandidates))):L.Logger.debug("[tk-sdk]Gathered all candidates. Sending END candidate")};a.peerConnection.onaddstream=function(b){if(a.onaddstream)a.onaddstream(b)};a.peerConnection.onremovestream=function(b){if(a.onremovestream)a.onremovestream(b)};a.peerConnection.oniceconnectionstatechange=function(b){if(a.oniceconnectionstatechange)a.oniceconnectionstatechange(b.target.iceConnectionState)};
var g=function(a){if(b.video&&b.maxVideoBW){a=a.replace(/b=AS:.*\r\n/g,"");var c=a.match(/m=video.*\r\n/);null==c&&(c=a.match(/m=video.*\n/));if(c&&0<c.length){var d=c[0]+"b\x3dAS:"+b.maxVideoBW+"\r\n";a=a.replace(c[0],d)}}b.audio&&b.maxAudioBW&&(c=a.match(/m=audio.*\r\n/),null==c&&(c=a.match(/m=audio.*\n/)),c&&0<c.length&&(d=c[0]+"b\x3dAS:"+b.maxAudioBW+"\r\n",a=a.replace(c[0],d)));return a},l,p=function(a){a.sdp=g(a.sdp);a.sdp=a.sdp.replace(/a=ice-options:google-ice\r\n/g,"");b.callback(a);l=a},
n=function(c){c.sdp=g(c.sdp);c.sdp=c.sdp.replace(/a=ice-options:google-ice\r\n/g,"");b.callback(c);l=c;a.peerConnection.setLocalDescription(l)};a.updateSpec=function(a){if(a.maxVideoBW||a.maxAudioBW)a.maxVideoBW&&(L.Logger.debug("[tk-sdk]Maxvideo Requested",a.maxVideoBW,"limit",b.limitMaxVideoBW),a.maxVideoBW>b.limitMaxVideoBW&&(a.maxVideoBW=b.limitMaxVideoBW),b.maxVideoBW=a.maxVideoBW),a.maxAudioBW&&(a.maxAudioBW>b.limitMaxAudioBW&&(a.maxAudioBW=b.limitMaxAudioBW),b.maxAudioBW=a.maxAudioBW),l.sdp=
g(l.sdp),a.Sdp?L.Logger.error("[tk-sdk]Cannot update with renegotiation in Firefox, try without renegotiation"):(L.Logger.debug("[tk-sdk]Updating without renegotiation, newVideoBW:",b.maxVideoBW,", newAudioBW:",b.maxAudioBW),b.callback({type:"updatestream",sdp:l.sdp}));if(a.minVideoBW||void 0!==a.slideShowMode||void 0!==a.muteStream||void 0!==a.qualityLayer)L.Logger.debug("[tk-sdk]MinVideo Changed to ",a.minVideoBW),L.Logger.debug("[tk-sdk]SlideShowMode Changed to ",a.slideShowMode),L.Logger.debug("[tk-sdk]muteStream changed to ",
a.muteStream),b.callback({type:"updatestream",config:a})};a.createOffer=function(b){!0!==b&&(k(),a.mediaConstraints={offerToReceiveAudio:!1,offerToReceiveVideo:!1,mozDontOfferDataChannel:!0});a.peerConnection.createOffer(p,d,a.mediaConstraints)};a.addStream=function(b){a.peerConnection.addStream(b)};a.removeStream=function(b){a.peerConnection.removeStream(b)};b.remoteCandidates=[];b.remoteDescriptionSet=!1;a.close=function(){a.state="closed";a.peerConnection.close()};a.processSignalingMessage=function(d){if("offer"===
d.type)d.sdp=g(d.sdp),a.peerConnection.setRemoteDescription(new e(d),function(){a.peerConnection.createAnswer(n,function(a){L.Logger.error("[tk-sdk]Error",a)},a.mediaConstraints);b.remoteDescriptionSet=!0},function(a){L.Logger.error("[tk-sdk]Error setting Remote Description",a)});else if("answer"===d.type)L.Logger.debug("[tk-sdk]Set remote and local description"),L.Logger.debug("[tk-sdk]Local Description to set",l.sdp),L.Logger.debug("[tk-sdk]Remote Description to set",d.sdp),d.sdp=g(d.sdp),a.peerConnection.setLocalDescription(l,
function(){a.peerConnection.setRemoteDescription(new e(d),function(){b.remoteDescriptionSet=!0;for(L.Logger.debug("[tk-sdk]Remote Description successfully set");0<b.remoteCandidates.length&&m;)L.Logger.debug("[tk-sdk]Setting stored remote candidates"),a.peerConnection.addIceCandidate(b.remoteCandidates.shift());for(;0<b.localCandidates.length;)L.Logger.debug("[tk-sdk]Sending Candidate from list"),b.callback({type:"candidate",candidate:b.localCandidates.shift()})},function(a){L.Logger.error("[tk-sdk]Error Setting Remote Description",
a)})},function(a){L.Logger.error("[tk-sdk]Failure setting Local Description",a)});else if("candidate"===d.type)try{var k="object"===typeof d.candidate?d.candidate:L.Utils.toJsonParse(d.candidate);k.candidate=k.candidate.replace(/ generation 0/g,"");k.candidate=k.candidate.replace(/ udp /g," UDP ");k.sdpMLineIndex=parseInt(k.sdpMLineIndex);var f=new c(k);if(b.remoteDescriptionSet&&m)for(a.peerConnection.addIceCandidate(f);0<b.remoteCandidates.length;)L.Logger.debug("[tk-sdk]Setting stored remote candidates"),
a.peerConnection.addIceCandidate(b.remoteCandidates.shift());else b.remoteCandidates.push(f)}catch(A){L.Logger.error("[tk-sdk]Error parsing candidate",d.candidate,A)}};return a};TK=TK||{};
window.TkWebkitRTCPeerConnection=function(b,a){b&&b.iceTransportPolicy&&(b.iceTransports=b.iceTransportPolicy);b=new webkitRTCPeerConnection(b,a);var f=b.getStats.bind(b);b.getStats=function(a,b,d){var c=arguments;if(0<arguments.length&&"function"===typeof a)return f(a,b);var e=function(a){var b={};a.result().forEach(function(a){var c={id:a.id,timestamp:(new Date(a.timestamp)).getTime(),type:a.type};a.names().forEach(function(b){c[b]=a.stat(b)});b[c.id]=c});return b};if(2<=arguments.length)return f.apply(this,[function(a){c[1](e(a))},
arguments[0]])};return b};
TK.TkChromeStableStack=function(b){var a={},f=window.TkWebkitRTCPeerConnection;a.pcConfig={iceServers:[]};a.con={optional:[{DtlsSrtpKeyAgreement:!0}]};void 0!==b.iceServers&&(a.pcConfig.iceServers=b.iceServers);void 0===b.audio&&(b.audio=!0);void 0===b.video&&(b.video=!0);a.mediaConstraints={mandatory:{OfferToReceiveVideo:b.video,OfferToReceiveAudio:b.audio}};var e=function(a){L.Logger.error("[tk-sdk]Error in Stack ",a)};a.peerConnection=new f(a.pcConfig,a.con);var c=function(a){var b="a\x3dssrc-group:SIM";
a.forEach(function(a){b+=" "+a});return b+"\r\n"},d=function(a){if(!b.video||!b.simulcast)return a;var d=a.match(/a=ssrc-group:FID ([0-9]*) ([0-9]*)\r?\n/);if(!d||0>=d.length)return a;var e=b.simulcast.numSpatialLayers||2;var g=parseInt(d[1]),k=parseInt(d[2]),n=a.match(new RegExp("a\x3dssrc:"+d[1]+" cname:(.*)\r?\n"))[1],f=a.match(new RegExp("a\x3dssrc:"+d[1]+" msid:(.*)\r?\n"))[1],p=a.match(new RegExp("a\x3dssrc:"+d[1]+" mslabel:(.*)\r?\n"))[1],l=a.match(new RegExp("a\x3dssrc:"+d[1]+" label:(.*)\r?\n"))[1];
a.match(new RegExp("a\x3dssrc:"+d[1]+".*\r?\n","g")).forEach(function(b){a=a.replace(b,"")});a.match(new RegExp("a\x3dssrc:"+d[2]+".*\r?\n","g")).forEach(function(b){a=a.replace(b,"")});for(var m=[g],R=[k],K=1;K<e;K++)m.push(g+1E3*K),R.push(k+1E3*K);e=c(m);for(var S in m)g=m[S],k=R[S],e+="a\x3dssrc-group:FID "+g+" "+k+"\r\n";for(S in m)g=m[S],k=R[S],e+="a\x3dssrc:"+g+" cname:"+n+"\r\na\x3dssrc:"+g+" msid:"+f+"\r\na\x3dssrc:"+g+" mslabel:"+p+"\r\na\x3dssrc:"+g+" label:"+l+"\r\na\x3dssrc:"+k+" cname:"+
n+"\r\na\x3dssrc:"+k+" msid:"+f+"\r\na\x3dssrc:"+k+" mslabel:"+p+"\r\na\x3dssrc:"+k+" label:"+l+"\r\n";return a.replace(d[0],e+"a\x3dx-google-flag:conference\r\n")},k=function(a){if(b.video&&b.maxVideoBW){a=a.replace(/b=AS:.*\r\n/g,"");var c=a.match(/m=video.*\r\n/);null==c&&(c=a.match(/m=video.*\n/));if(c&&0<c.length){var d=c[0]+"b\x3dAS:"+b.maxVideoBW+"\r\n";a=a.replace(c[0],d)}}b.audio&&b.maxAudioBW&&(c=a.match(/m=audio.*\r\n/),null==c&&(c=a.match(/m=audio.*\n/)),c&&0<c.length&&(d=c[0]+"b\x3dAS:"+
b.maxAudioBW+"\r\n",a=a.replace(c[0],d)));return a};a.close=function(){a.state="closed";a.peerConnection.close()};b.localCandidates=[];a.peerConnection.onicecandidate=function(a){a.candidate?(a.candidate.candidate.match(/a=/)||(a.candidate.candidate="a\x3d"+a.candidate.candidate),a={sdpMLineIndex:a.candidate.sdpMLineIndex,sdpMid:a.candidate.sdpMid,candidate:a.candidate.candidate}):(L.Logger.debug("[tk-sdk]Gathered all candidates. Sending END candidate"),a={sdpMLineIndex:-1,sdpMid:"end",candidate:"end"});
b.remoteDescriptionSet?b.callback({type:"candidate",candidate:a}):(b.localCandidates.push(a),L.Logger.debug("[tk-sdk]Storing candidate: ",b.localCandidates.length,a))};a.peerConnection.onaddstream=function(b){if(a.onaddstream)a.onaddstream(b)};a.peerConnection.onremovestream=function(b){if(a.onremovestream)a.onremovestream(b)};a.peerConnection.oniceconnectionstatechange=function(b){if(a.oniceconnectionstatechange)a.oniceconnectionstatechange(b.target.iceConnectionState)};var m,g,l=function(a,c){a||
(c.sdp=d(c.sdp));c.sdp=k(c.sdp);a=c.sdp;var e=a.match(/a=rtpmap:(.*)opus.*\r\n/);null!==e&&(a=a.replace(e[0],e[0]+"a\x3drtcp-fb:"+e[1]+"nack\r\n"));c.sdp=a;c.sdp=c.sdp.replace(/a=ice-options:google-ice\r\n/g,"");c.sdp=c.sdp.replace(/a=rtcp-fb:\d+ transport-cc\r\n/g,"");b.callback({type:c.type,sdp:c.sdp});m=c},p=function(c){c.sdp=k(c.sdp);b.callback({type:c.type,sdp:c.sdp});m=c;a.peerConnection.setLocalDescription(c)};a.updateSpec=function(c,d){if(c.maxVideoBW||c.maxAudioBW)c.maxVideoBW&&(L.Logger.debug("[tk-sdk]Maxvideo Requested:",
c.maxVideoBW,"limit:",b.limitMaxVideoBW),c.maxVideoBW>b.limitMaxVideoBW&&(c.maxVideoBW=b.limitMaxVideoBW),b.maxVideoBW=c.maxVideoBW),c.maxAudioBW&&(c.maxAudioBW>b.limitMaxAudioBW&&(c.maxAudioBW=b.limitMaxAudioBW),b.maxAudioBW=c.maxAudioBW),m.sdp=k(m.sdp),c.Sdp||c.maxAudioBW?(L.Logger.debug("[tk-sdk]Updating with SDP renegotiation",b.maxVideoBW,b.maxAudioBW),a.peerConnection.setLocalDescription(m,function(){g.sdp=k(g.sdp);a.peerConnection.setRemoteDescription(new RTCSessionDescription(g),function(){b.remoteDescriptionSet=
!0;b.callback({type:"updatestream",sdp:m.sdp})})},function(a){L.Logger.error("[tk-sdk]Error updating configuration",a);d("error")})):(L.Logger.debug("[tk-sdk]Updating without SDP renegotiation, newVideoBW:",b.maxVideoBW,"newAudioBW:",b.maxAudioBW),b.callback({type:"updatestream",sdp:m.sdp}));if(c.minVideoBW||void 0!==c.slideShowMode||void 0!==c.muteStream||void 0!==c.qualityLayer)L.Logger.debug("[tk-sdk]MinVideo Changed to ",c.minVideoBW),L.Logger.debug("[tk-sdk]SlideShowMode Changed to ",c.slideShowMode),
L.Logger.debug("[tk-sdk]muteStream changed to ",c.muteStream),b.callback({type:"updatestream",config:c})};a.createOffer=function(b){!0!==b&&(a.mediaConstraints={mandatory:{OfferToReceiveVideo:!1,OfferToReceiveAudio:!1}});a.peerConnection.createOffer(l.bind(null,b),e,a.mediaConstraints)};a.addStream=function(b){b?a.peerConnection.addStream(b):L.Logger.error("[tk-sdk]chromeStableStack addStream : stream is not exist!")};a.removeStream=function(b){a.peerConnection.removeStream(b)};a.getStats=function(b){if(b&&
"function"===typeof b)if(a.peerConnection&&a.peerConnection.getStats)try{a.peerConnection.getStats(void 0,function(a){b(a,void 0)},function(a){L.Logger.error("[tk-sdk]that.peerConnection.getStats error:",a);b(void 0,-2)})}catch(u){L.Logger.error("[tk-sdk]that.peerConnection.getStats error:",u),b(void 0,-3)}else b(void 0,-1)};b.remoteCandidates=[];b.remoteDescriptionSet=!1;a.processSignalingMessage=function(c,d){L.Logger.debug("[tk-sdk]Process Signaling Message ",L.Utils.toJsonStringify(c));if(c.sdp&&
"answer"===c.type){var e=c.sdp,f=e.indexOf("udp");if(-1!==f){var l="";d&&(l+="stream sdp info:stream id:"+d.getID()+" , extensionId is "+d.extensionId+", attrs is "+L.Utils.toJsonStringify(d.getAttributes())+". \n");l+="udp info:"+(window.__TkSdkBuild__?L.Utils.encrypt(e.substr(f,58)):e.substr(f,58));L.Logger.info(l)}}if("offer"===c.type)c.sdp=k(c.sdp),a.peerConnection.setRemoteDescription(new RTCSessionDescription(c),function(){a.peerConnection.createAnswer(p,function(a){L.Logger.error("[tk-sdk]createAnswer Error: ",
a)},a.mediaConstraints);b.remoteDescriptionSet=!0},function(a){L.Logger.error("[tk-sdk]Error setting Remote Description",a)});else if("answer"===c.type)L.Logger.debug("[tk-sdk]Set remote and local description"),L.Logger.debug("[tk-sdk]Remote Description",c.sdp),L.Logger.debug("[tk-sdk]Local Description",m.sdp),c.sdp=k(c.sdp),g=c,a.peerConnection.setLocalDescription(m,function(){a.peerConnection.setRemoteDescription(new RTCSessionDescription(c),function(){b.remoteDescriptionSet=!0;for(L.Logger.debug("[tk-sdk]Candidates to be added: ",
b.remoteCandidates.length,b.remoteCandidates);0<b.remoteCandidates.length;)a.peerConnection.addIceCandidate(b.remoteCandidates.shift());for(L.Logger.debug("[tk-sdk]Local candidates to send:",b.localCandidates.length);0<b.localCandidates.length;)b.callback({type:"candidate",candidate:b.localCandidates.shift()})})});else if("candidate"===c.type)try{var n="object"===typeof c.candidate?c.candidate:L.Utils.toJsonParse(c.candidate);if("end"!==n.candidate){n.candidate=n.candidate.replace(/a=/g,"");n.sdpMLineIndex=
parseInt(n.sdpMLineIndex);var u=new RTCIceCandidate(n);b.remoteDescriptionSet?a.peerConnection.addIceCandidate(u):b.remoteCandidates.push(u)}}catch(F){L.Logger.error("[tk-sdk]Error parsing candidate",c.candidate)}};return a};TK=TK||{};
TK.BowserStack=function(b){var a={},f=webkitRTCPeerConnection;a.pcConfig={iceServers:[]};a.con={optional:[{DtlsSrtpKeyAgreement:!0}]};void 0!==b.stunServerUrl&&a.pcConfig.iceServers.push({url:b.stunServerUrl});(b.turnServer||{}).url&&a.pcConfig.iceServers.push({username:b.turnServer.username,credential:b.turnServer.password,url:b.turnServer.url});void 0===b.audio&&(b.audio=!0);void 0===b.video&&(b.video=!0);a.mediaConstraints={offerToReceiveVideo:b.video,offerToReceiveAudio:b.audio};a.peerConnection=new f(a.pcConfig,
a.con);b.remoteDescriptionSet=!1;var e=function(a){if(b.maxVideoBW){var c=a.match(/m=video.*\r\n/);null==c&&(c=a.match(/m=video.*\n/));if(c&&0<c.length){var d=c[0]+"b\x3dAS:"+b.maxVideoBW+"\r\n";a=a.replace(c[0],d)}}b.maxAudioBW&&(c=a.match(/m=audio.*\r\n/),null==c&&(c=a.match(/m=audio.*\n/)),c&&0<c.length&&(d=c[0]+"b\x3dAS:"+b.maxAudioBW+"\r\n",a=a.replace(c[0],d)));return a};a.close=function(){a.state="closed";a.peerConnection.close()};b.localCandidates=[];a.peerConnection.onicecandidate=function(c){c.candidate?
(c.candidate.candidate.match(/a=/)||(c.candidate.candidate="a\x3d"+c.candidate.candidate),b.remoteDescriptionSet?b.callback({type:"candidate",candidate:c.candidate}):b.localCandidates.push(c.candidate)):L.Logger.debug("End of candidates.",a.peerConnection.localDescription)};a.peerConnection.onaddstream=function(b){if(a.onaddstream)a.onaddstream(b)};a.peerConnection.onremovestream=function(b){if(a.onremovestream)a.onremovestream(b)};var c=function(a){L.Logger.debug("Error in Stack ",a)},d,k=function(g){g.sdp=
e(g.sdp);L.Logger.debug("Set local description",g.sdp);d=g;a.peerConnection.setLocalDescription(d,function(){L.Logger.debug("The final LocalDesc",a.peerConnection.localDescription);b.callback(a.peerConnection.localDescription)},c)},m=function(c){c.sdp=e(c.sdp);b.callback(c);d=c;a.peerConnection.setLocalDescription(c)};a.createOffer=function(b){!0===b?a.peerConnection.createOffer(k,c,a.mediaConstraints):a.peerConnection.createOffer(k,c)};a.addStream=function(b){a.peerConnection.addStream(b)};b.remoteCandidates=
[];a.processSignalingMessage=function(d){L.Logger.debug("Process Signaling Message",d);if("offer"===d.type)d.sdp=e(d.sdp),a.peerConnection.setRemoteDescription(new RTCSessionDescription(d)),a.peerConnection.createAnswer(m,null,a.mediaConstraints),b.remoteDescriptionSet=!0;else if("answer"===d.type)L.Logger.debug("Set remote description",d.sdp),d.sdp=e(d.sdp),a.peerConnection.setRemoteDescription(new RTCSessionDescription(d),function(){b.remoteDescriptionSet=!0;for(L.Logger.debug("Candidates to be added: ",
b.remoteCandidates.length);0<b.remoteCandidates.length;)L.Logger.debug("Candidate :",b.remoteCandidates[b.remoteCandidates.length-1]),a.peerConnection.addIceCandidate(b.remoteCandidates.shift(),function(){},c);for(;0<b.localCandidates.length;)b.callback({type:"candidate",candidate:b.localCandidates.shift()})},function(){L.Logger.warning("Error Setting Remote Description")});else if("candidate"===d.type){L.Logger.debug("Message with candidate");try{var k="object"===typeof d.candidate?d.candidate:L.Utils.toJsonParse(d.candidate);
k.candidate=k.candidate.replace(/a=/g,"");k.sdpMLineIndex=parseInt(k.sdpMLineIndex);k.sdpMLineIndex="audio"===k.sdpMid?0:1;var g=new RTCIceCandidate(k);L.Logger.debug("Remote Candidate",g);b.remoteDescriptionSet?a.peerConnection.addIceCandidate(g,function(){},c):b.remoteCandidates.push(g)}catch(n){L.Logger.error("[tk-sdk]Error parsing candidate",d.candidate)}}};return a};TK=TK||{};
TK.ChromeCanaryStack=function(b){var a={},f=webkitRTCPeerConnection;a.pcConfig={iceServers:[]};a.con={optional:[{DtlsSrtpKeyAgreement:!0}]};void 0!==b.stunServerUrl&&a.pcConfig.iceServers.push({url:b.stunServerUrl});(b.turnServer||{}).url&&a.pcConfig.iceServers.push({username:b.turnServer.username,credential:b.turnServer.password,url:b.turnServer.url});if(void 0===b.audio||b.nop2p)b.audio=!0;if(void 0===b.video||b.nop2p)b.video=!0;a.mediaConstraints={mandatory:{OfferToReceiveVideo:b.video,OfferToReceiveAudio:b.audio}};
a.roapSessionId=103;a.peerConnection=new f(a.pcConfig,a.con);a.peerConnection.onicecandidate=function(c){L.Logger.debug("[tk-sdk]PeerConnection: ",b.sessionId);c.candidate?a.iceCandidateCount+=1:(L.Logger.debug("[tk-sdk]State: "+a.peerConnection.iceGatheringState),void 0===a.ices&&(a.ices=0),a.ices+=1,1<=a.ices&&a.moreIceComing&&(a.moreIceComing=!1,a.markActionNeeded()))};var e=function(a){var c;if(b.maxVideoBW&&(c=a.match(/m=video.*\r\n/))&&0<c.length){var e=c[0]+"b\x3dAS:"+b.maxVideoBW+"\r\n";a=
a.replace(c[0],e)}b.maxAudioBW&&(c=a.match(/m=audio.*\r\n/))&&0<c.length&&(e=c[0]+"b\x3dAS:"+b.maxAudioBW+"\r\n",a=a.replace(c[0],e));return a};a.processSignalingMessage=function(b){L.Logger.debug("[tk-sdk]Activity on conn "+a.sessionId);b=L.Utils.toJsonParse(b);a.incomingMessage=b;"new"===a.state?"OFFER"===b.messageType?(b={sdp:b.sdp,type:"offer"},a.peerConnection.setRemoteDescription(new RTCSessionDescription(b)),a.state="offer-received",a.markActionNeeded()):a.error("Illegal message for this state: "+
b.messageType+" in state "+a.state):"offer-sent"===a.state?"ANSWER"===b.messageType?(b={sdp:b.sdp,type:"answer"},L.Logger.debug("[tk-sdk]Received ANSWER: ",b.sdp),b.sdp=e(b.sdp),a.peerConnection.setRemoteDescription(new RTCSessionDescription(b)),a.sendOK(),a.state="established"):"pr-answer"===b.messageType?(b={sdp:b.sdp,type:"pr-answer"},a.peerConnection.setRemoteDescription(new RTCSessionDescription(b))):"offer"===b.messageType?a.error("Not written yet"):a.error("Illegal message for this state: "+
b.messageType+" in state "+a.state):"established"===a.state&&("OFFER"===b.messageType?(b={sdp:b.sdp,type:"offer"},a.peerConnection.setRemoteDescription(new RTCSessionDescription(b)),a.state="offer-received",a.markActionNeeded()):a.error("Illegal message for this state: "+b.messageType+" in state "+a.state))};a.addStream=function(b){a.peerConnection.addStream(b);a.markActionNeeded()};a.removeStream=function(b){a.peerConnection.removeStream(b)};a.removeStream=function(){a.markActionNeeded()};a.close=
function(){a.state="closed";a.peerConnection.close()};a.markActionNeeded=function(){a.actionNeeded=!0;a.doLater(function(){a.onstablestate()})};a.doLater=function(a){window.setTimeout(a,1)};a.onstablestate=function(){if(a.actionNeeded){if("new"===a.state||"established"===a.state)a.peerConnection.createOffer(function(b){b.sdp=e(b.sdp);L.Logger.debug("[tk-sdk]Changed",b.sdp);b.sdp!==a.prevOffer?(a.peerConnection.setLocalDescription(b),a.state="preparing-offer",a.markActionNeeded()):L.Logger.debug("[tk-sdk]Not sending a new offer")},
null,a.mediaConstraints);else if("preparing-offer"===a.state){if(a.moreIceComing)return;a.prevOffer=a.peerConnection.localDescription.sdp;L.Logger.debug("[tk-sdk]Sending OFFER: "+a.prevOffer);a.sendMessage("OFFER",a.prevOffer);a.state="offer-sent"}else if("offer-received"===a.state)a.peerConnection.createAnswer(function(b){a.peerConnection.setLocalDescription(b);a.state="offer-received-preparing-answer";a.iceStarted?a.markActionNeeded():(L.Logger.debug("[tk-sdk]"+(new Date).getTime()+": Starting ICE in responder"),
a.iceStarted=!0)},null,a.mediaConstraints);else if("offer-received-preparing-answer"===a.state){if(a.moreIceComing)return;var b=a.peerConnection.localDescription.sdp;a.sendMessage("ANSWER",b);a.state="established"}else a.error("Dazed and confused in state "+a.state+", stopping here");a.actionNeeded=!1}};a.sendOK=function(){a.sendMessage("OK")};a.sendMessage=function(b,d){var c={};c.messageType=b;c.sdp=d;"OFFER"===b?(c.offererSessionId=a.sessionId,c.answererSessionId=a.otherSessionId,c.seq=a.sequenceNumber+=
1,c.tiebreaker=Math.floor(429496723*Math.random()+1)):(c.offererSessionId=a.incomingMessage.offererSessionId,c.answererSessionId=a.sessionId,c.seq=a.incomingMessage.seq);a.onsignalingmessage(L.Utils.toJsonStringify(c))};a.error=function(a){throw"Error in RoapOnJsep: "+a;};a.sessionId=a.roapSessionId+=1;a.sequenceNumber=0;a.actionNeeded=!1;a.iceStarted=!1;a.moreIceComing=!0;a.iceCandidateCount=0;a.onsignalingmessage=b.callback;a.peerConnection.onopen=function(){if(a.onopen)a.onopen()};a.peerConnection.onaddstream=
function(b){if(a.onaddstream)a.onaddstream(b)};a.peerConnection.onremovestream=function(b){if(a.onremovestream)a.onremovestream(b)};a.peerConnection.oniceconnectionstatechange=function(b){if(a.oniceconnectionstatechange)a.oniceconnectionstatechange(b.currentTarget.iceConnectionState)};a.onaddstream=null;a.onremovestream=null;a.state="new";a.markActionNeeded();return a};TK=TK||{};
TK.ChromeRoapStack=function(b){var a={},f=webkitRTCPeerConnection;a.pcConfig={iceServers:[]};a.con={optional:[{DtlsSrtpKeyAgreement:!0}]};void 0!==b.stunServerUrl&&a.pcConfig.iceServers.push({url:b.stunServerUrl});(b.turnServer||{}).url&&a.pcConfig.iceServers.push({username:b.turnServer.username,credential:b.turnServer.password,url:b.turnServer.url});if(void 0===b.audio||b.nop2p)b.audio=!0;if(void 0===b.video||b.nop2p)b.video=!0;a.mediaConstraints={mandatory:{OfferToReceiveVideo:b.video,OfferToReceiveAudio:b.audio}};
a.roapSessionId=103;a.peerConnection=new f(a.pcConfig,a.con);a.peerConnection.onicecandidate=function(c){L.Logger.debug("[tk-sdk]PeerConnection: ",b.sessionId);c.candidate?a.iceCandidateCount+=1:(L.Logger.debug("[tk-sdk]onicecandidate state: "+a.peerConnection.iceGatheringState),void 0===a.ices&&(a.ices=0),a.ices+=1,1<=a.ices&&a.moreIceComing&&(a.moreIceComing=!1,a.markActionNeeded()))};var e=function(a){var c;if(b.maxVideoBW&&(c=a.match(/m=video.*\r\n/))&&0<c.length){var e=c[0]+"b\x3dAS:"+b.maxVideoBW+
"\r\n";a=a.replace(c[0],e)}b.maxAudioBW&&(c=a.match(/m=audio.*\r\n/))&&0<c.length&&(e=c[0]+"b\x3dAS:"+b.maxAudioBW+"\r\n",a=a.replace(c[0],e));return a};a.processSignalingMessage=function(b){L.Logger.debug("[tk-sdk]Activity on conn "+a.sessionId);b=L.Utils.toJsonParse(b);a.incomingMessage=b;"new"===a.state?"OFFER"===b.messageType?(b={sdp:b.sdp,type:"offer"},a.peerConnection.setRemoteDescription(new RTCSessionDescription(b)),a.state="offer-received",a.markActionNeeded()):a.error("Illegal message for this state: "+
b.messageType+" in state "+a.state):"offer-sent"===a.state?"ANSWER"===b.messageType?(b={sdp:b.sdp,type:"answer"},L.Logger.debug("[tk-sdk]Received ANSWER: ",b.sdp),b.sdp=e(b.sdp),a.peerConnection.setRemoteDescription(new RTCSessionDescription(b)),a.sendOK(),a.state="established"):"pr-answer"===b.messageType?(b={sdp:b.sdp,type:"pr-answer"},a.peerConnection.setRemoteDescription(new RTCSessionDescription(b))):"offer"===b.messageType?a.error("Not written yet"):a.error("Illegal message for this state: "+
b.messageType+" in state "+a.state):"established"===a.state&&("OFFER"===b.messageType?(b={sdp:b.sdp,type:"offer"},a.peerConnection.setRemoteDescription(new RTCSessionDescription(b)),a.state="offer-received",a.markActionNeeded()):a.error("Illegal message for this state: "+b.messageType+" in state "+a.state))};a.addStream=function(b){a.peerConnection.addStream(b);a.markActionNeeded()};a.removeStream=function(b){a.peerConnection.removeStream(b)};a.removeStream=function(){a.markActionNeeded()};a.close=
function(){a.state="closed";a.peerConnection.close()};a.markActionNeeded=function(){a.actionNeeded=!0;a.doLater(function(){a.onstablestate()})};a.doLater=function(a){window.setTimeout(a,1)};a.onstablestate=function(){if(a.actionNeeded){if("new"===a.state||"established"===a.state)a.peerConnection.createOffer(function(b){b.sdp=e(b.sdp);L.Logger.debug("[tk-sdk]Changed",b.sdp);b.sdp!==a.prevOffer?(a.peerConnection.setLocalDescription(b),a.state="preparing-offer",a.markActionNeeded()):L.Logger.debug("[tk-sdk]Not sending a new offer")},
null,a.mediaConstraints);else if("preparing-offer"===a.state){if(a.moreIceComing)return;a.prevOffer=a.peerConnection.localDescription.sdp;L.Logger.debug("[tk-sdk]Sending OFFER: "+a.prevOffer);a.sendMessage("OFFER",a.prevOffer);a.state="offer-sent"}else if("offer-received"===a.state)a.peerConnection.createAnswer(function(b){a.peerConnection.setLocalDescription(b);a.state="offer-received-preparing-answer";a.iceStarted?a.markActionNeeded():(L.Logger.debug("[tk-sdk]"+(new Date).getTime()+": Starting ICE in responder"),
a.iceStarted=!0)},null,a.mediaConstraints);else if("offer-received-preparing-answer"===a.state){if(a.moreIceComing)return;var b=a.peerConnection.localDescription.sdp;a.sendMessage("ANSWER",b);a.state="established"}else a.error("Dazed and confused in state "+a.state+", stopping here");a.actionNeeded=!1}};a.sendOK=function(){a.sendMessage("OK")};a.sendMessage=function(b,d){var c={};c.messageType=b;c.sdp=d;"OFFER"===b?(c.offererSessionId=a.sessionId,c.answererSessionId=a.otherSessionId,c.seq=a.sequenceNumber+=
1,c.tiebreaker=Math.floor(429496723*Math.random()+1)):(c.offererSessionId=a.incomingMessage.offererSessionId,c.answererSessionId=a.sessionId,c.seq=a.incomingMessage.seq);a.onsignalingmessage(L.Utils.toJsonStringify(c))};a.error=function(a){throw"Error in RoapOnJsep: "+a;};a.sessionId=a.roapSessionId+=1;a.sequenceNumber=0;a.actionNeeded=!1;a.iceStarted=!1;a.moreIceComing=!0;a.iceCandidateCount=0;a.onsignalingmessage=b.callback;a.peerConnection.onopen=function(){if(a.onopen)a.onopen()};a.peerConnection.onaddstream=
function(b){if(a.onaddstream)a.onaddstream(b)};a.peerConnection.onremovestream=function(b){if(a.onremovestream)a.onremovestream(b)};a.peerConnection.oniceconnectionstatechange=function(b){if(a.oniceconnectionstatechange)a.oniceconnectionstatechange(b.currentTarget.iceConnectionState)};a.onaddstream=null;a.onremovestream=null;a.state="new";a.markActionNeeded();return a};TK=TK||{};TK.nativeEntry=function(){var b=document.createElement("embed");document.body.appendChild(b);b.setAttribute("id","tknative");b.setAttribute("mainentry",!0);b.setAttribute("hidden",!0);b.setAttribute("type","application/x-ppapi-proxy");return b};
TK.nativePeerConnection=function(b){var a={},f={},e=b.audio,c=b.video,d=b.screen,k=!0;void 0===d&&(d=!1);a.onicecandidate=null;a.onaddstream=null;a.onremovestream=null;a.oniceconnectionstatechange=null;var m=function(){if(!b.cnnId)throw Error("Invalid native-peer-connection ID");return b.media?b.cnnId+":media":b.screen?b.cnnId+":screen":b.cnnId};tknative.addEventListener("message",function(b){var c=b.data.name;if(b.data.connectionId==m()){if("onLocalDescription"===c){var d={};d.sdp=b.data.sdp;d.type=
"offer";"function"===typeof f.createOffer_suc&&f.createOffer_suc(d);delete f.createOffer_suc;delete f.createOffer_fai}"onIceCandidate"===c&&a.onicecandidate&&(d={candidate:{}},d.candidate.sdpMLineIndex=b.data.sdpMLineIndex,d.candidate.sdpMid=b.data.sdpMid,d.candidate.candidate=b.data.candidate,a.onicecandidate(d));if("onIceStatusChanged"===c){b=b.data.state;if(1==b)a.oniceconnectionstatechange("checking");if(2==b)a.oniceconnectionstatechange("connected");if(3==b)a.oniceconnectionstatechange("completed");
if(4==b)a.oniceconnectionstatechange("failed");if(5==b)a.oniceconnectionstatechange("disconnected");if(6==b)a.oniceconnectionstatechange("closed")}if("onAddStream"===c)a.onaddstream({stream:{}})}},!1);a.close=function(){tknative.postMessage({command:"closeConnection",streamId:m().toString(),offerToSend:k,type:Number(b.media?1:b.screen?2:0)})};a.createOffer=function(a,b,p){p&&(k=!1);tknative.postMessage({command:"createOffer",streamId:m().toString(),includeLocalMedia:k,hasAudio:e,hasVideo:c,hasScreen:d,
offerToSend:k});f.createOffer_suc=a;f.createOffer_fai=b};a.setRemoteDescription=function(a,b,c){tknative.postMessage({command:"setRemoteDescription",sdpAnswer:a.sdp,streamId:m().toString()});b&&"function"===typeof b&&b()};a.addIceCandidate=function(a){tknative.postMessage({command:"setIceCandidate",candidate:a.candidate,sdpMid:0,sdpMLineIndex:a.sdpMLineIndex,streamId:m().toString()})};a.addStream=function(a){tknative.postMessage({command:"addStream",streamId:m().toString(),type:Number(b.media?1:b.screen?
2:0)})};a.removeStream=function(a){tknative.postMessage({command:"removeStream",streamId:m().toString(),type:Number(b.media?1:b.screen?2:0)})};a.setLocalDescription=function(a){};a.getStats=function(a){a&&"function"===typeof a&&a(void 0,-1)};return a};TK=TK||{};
TK.TkNativeStack=function(b){var a={},f=TK.nativePeerConnection;a.isNative=!0;a.pcConfig={iceServers:[]};a.con={optional:[{DtlsSrtpKeyAgreement:!0}]};void 0!==b.iceServers&&(a.pcConfig.iceServers=b.iceServers);void 0===b.audio&&(b.audio=!0);void 0===b.video&&(b.video=!0);a.mediaConstraints={mandatory:{OfferToReceiveVideo:b.video,OfferToReceiveAudio:b.audio}};var e=function(a){L.Logger.error("Error in Stack ",a)};a.peerConnection=new f(b);var c=function(a){var b="a\x3dssrc-group:SIM";a.forEach(function(a){b+=" "+
a});return b+"\r\n"},d=function(a){if(!b.video||!b.simulcast)return a;var d=a.match(/a=ssrc-group:FID ([0-9]*) ([0-9]*)\r?\n/);if(!d||0>=d.length)return a;var e=b.simulcast.numSpatialLayers||2;var k=parseInt(d[1]),g=parseInt(d[2]),f=a.match(new RegExp("a\x3dssrc:"+d[1]+" cname:(.*)\r?\n"))[1],l=a.match(new RegExp("a\x3dssrc:"+d[1]+" msid:(.*)\r?\n"))[1],p=a.match(new RegExp("a\x3dssrc:"+d[1]+" mslabel:(.*)\r?\n"))[1],m=a.match(new RegExp("a\x3dssrc:"+d[1]+" label:(.*)\r?\n"))[1];a.match(new RegExp("a\x3dssrc:"+
d[1]+".*\r?\n","g")).forEach(function(b){a=a.replace(b,"")});a.match(new RegExp("a\x3dssrc:"+d[2]+".*\r?\n","g")).forEach(function(b){a=a.replace(b,"")});for(var P=[k],U=[g],R=1;R<e;R++)P.push(k+1E3*R),U.push(g+1E3*R);e=c(P);for(var K in P)k=P[K],g=U[K],e+="a\x3dssrc-group:FID "+k+" "+g+"\r\n";for(K in P)k=P[K],g=U[K],e+="a\x3dssrc:"+k+" cname:"+f+"\r\na\x3dssrc:"+k+" msid:"+l+"\r\na\x3dssrc:"+k+" mslabel:"+p+"\r\na\x3dssrc:"+k+" label:"+m+"\r\na\x3dssrc:"+g+" cname:"+f+"\r\na\x3dssrc:"+g+" msid:"+
l+"\r\na\x3dssrc:"+g+" mslabel:"+p+"\r\na\x3dssrc:"+g+" label:"+m+"\r\n";return a.replace(d[0],e+"a\x3dx-google-flag:conference\r\n")},k=function(a){if(b.video&&b.maxVideoBW){a=a.replace(/b=AS:.*\r\n/g,"");var c=a.match(/m=video.*\r\n/);null==c&&(c=a.match(/m=video.*\n/));if(c&&0<c.length){var d=c[0]+"b\x3dAS:"+b.maxVideoBW+"\r\n";a=a.replace(c[0],d)}}b.audio&&b.maxAudioBW&&(c=a.match(/m=audio.*\r\n/),null==c&&(c=a.match(/m=audio.*\n/)),c&&0<c.length&&(d=c[0]+"b\x3dAS:"+b.maxAudioBW+"\r\n",a=a.replace(c[0],
d)));return a};a.close=function(){a.state="closed";a.peerConnection.close()};b.localCandidates=[];a.peerConnection.onicecandidate=function(a){a.candidate?(a.candidate.candidate.match(/a=/)||(a.candidate.candidate="a\x3d"+a.candidate.candidate),a={sdpMLineIndex:a.candidate.sdpMLineIndex,sdpMid:a.candidate.sdpMid,candidate:a.candidate.candidate}):(L.Logger.debug("Gathered all candidates. Sending END candidate"),a={sdpMLineIndex:-1,sdpMid:"end",candidate:"end"});b.remoteDescriptionSet?b.callback({type:"candidate",
candidate:a}):(b.localCandidates.push(a),L.Logger.debug("Storing candidate: ",b.localCandidates.length,a))};a.peerConnection.onaddstream=function(b){if(a.onaddstream)a.onaddstream(b)};a.peerConnection.onremovestream=function(b){if(a.onremovestream)a.onremovestream(b)};a.peerConnection.oniceconnectionstatechange=function(b){if(a.oniceconnectionstatechange)a.oniceconnectionstatechange(b)};var m,g=function(a,c){a||(c.sdp=d(c.sdp));c.sdp=k(c.sdp);a=c.sdp;var e=a.match(/a=rtpmap:(.*)opus.*\r\n/);null!==
e&&(a=a.replace(e[0],e[0]+"a\x3drtcp-fb:"+e[1]+"nack\r\n"));c.sdp=a;c.sdp=c.sdp.replace(/a=ice-options:google-ice\r\n/g,"");b.callback({type:c.type,sdp:c.sdp});m=c},l=function(c){c.sdp=k(c.sdp);b.callback({type:c.type,sdp:c.sdp});m=c;a.peerConnection.setLocalDescription(c)};a.updateSpec=function(c,d){if(c.maxVideoBW||c.maxAudioBW)c.maxVideoBW&&(L.Logger.debug("Maxvideo Requested:",c.maxVideoBW,"limit:",b.limitMaxVideoBW),c.maxVideoBW>b.limitMaxVideoBW&&(c.maxVideoBW=b.limitMaxVideoBW),b.maxVideoBW=
c.maxVideoBW,L.Logger.debug("Result",b.maxVideoBW)),c.maxAudioBW&&(c.maxAudioBW>b.limitMaxAudioBW&&(c.maxAudioBW=b.limitMaxAudioBW),b.maxAudioBW=c.maxAudioBW),m.sdp=k(m.sdp),c.Sdp||c.maxAudioBW?(L.Logger.debug("Updating with SDP renegotiation",b.maxVideoBW,b.maxAudioBW),(void 0).sdp=k((void 0).sdp),a.peerConnection.setRemoteDescription(void 0,function(){b.remoteDescriptionSet=!0;b.callback({type:"updatestream",sdp:m.sdp})})):(L.Logger.debug("Updating without SDP renegotiation, newVideoBW:",b.maxVideoBW,
"newAudioBW:",b.maxAudioBW),b.callback({type:"updatestream",sdp:m.sdp}));if(c.minVideoBW||void 0!==c.slideShowMode||void 0!==c.muteStream||void 0!==c.qualityLayer)L.Logger.debug("MinVideo Changed to ",c.minVideoBW),L.Logger.debug("SlideShowMode Changed to ",c.slideShowMode),L.Logger.debug("muteStream changed to ",c.muteStream),b.callback({type:"updatestream",config:c})};a.createOffer=function(b){a.peerConnection.createOffer(g.bind(null,b),e,b)};a.addStream=function(b){a.peerConnection.addStream(b)};
a.removeStream=function(b){a.peerConnection.removeStream(b)};b.remoteCandidates=[];b.remoteDescriptionSet=!1;a.processSignalingMessage=function(c){L.Logger.debug("Process Signaling Message",c);if("offer"===c.type)c.sdp=k(c.sdp),a.peerConnection.setRemoteDescription(c.sdp,l,function(a){L.Logger.error("Error: ",a)});else if("answer"===c.type)L.Logger.debug("Set remote and local description"),L.Logger.debug("Remote Description",c.sdp),L.Logger.debug("Local Description",m.sdp),c.sdp=k(c.sdp),a.peerConnection.setRemoteDescription(new RTCSessionDescription(c),
function(){b.remoteDescriptionSet=!0;for(L.Logger.debug("Candidates to be added: ",b.remoteCandidates.length,b.remoteCandidates);0<b.remoteCandidates.length;)a.peerConnection.addIceCandidate(b.remoteCandidates.shift());for(L.Logger.debug("Local candidates to send:",b.localCandidates.length);0<b.localCandidates.length;)b.callback({type:"candidate",candidate:b.localCandidates.shift()})});else if("candidate"===c.type)try{var d="object"===typeof c.candidate?c.candidate:L.Utils.toJsonParse(c.candidate);
if("end"!==d.candidate){d.candidate=d.candidate.replace(/a=/g,"");d.sdpMLineIndex=parseInt(d.sdpMLineIndex);var e=new RTCIceCandidate(d);b.remoteDescriptionSet?a.peerConnection.addIceCandidate(e):b.remoteCandidates.push(e)}}catch(t){L.Logger.error("Error parsing candidate",c.candidate)}};return a};TK=TK||{};TK.sessionId=103;
TK.Connection=function(b,a){var f={};b.sessionId=TK.sessionId+=1;f.browser=TK.getBrowser();if(!0===a)L.Logger.debug("Talk-Client Stack"),f=TK.TkNativeStack(b);else if("fake"===f.browser)L.Logger.warning("[tk-sdk]Publish/subscribe video/audio streams not supported in erizofc yet"),f=TK.FcStack(b);else if("mozilla"===f.browser)L.Logger.debug("[tk-sdk]Firefox Stack"),f=TK.FirefoxStack(b);else if("bowser"===f.browser)L.Logger.debug("[tk-sdk]Bowser Stack"),f=TK.BowserStack(b);else if("chrome-stable"===
f.browser||"electron"===f.browser)L.Logger.debug("[tk-sdk]Chrome Stable Stack"),f=TK.TkChromeStableStack(b);else throw L.Logger.error("[tk-sdk]No stack available for this browser"),"WebRTC stack not available";f.updateSpec||(f.updateSpec=function(a,b){L.Logger.error("[tk-sdk]Update Configuration not implemented in this browser");b&&b("unimplemented")});return f};
TK.getBrowser=function(){var b="none";"undefined"!==typeof module&&module.exports?b="fake":null!==window.navigator.userAgent.match("Firefox")?b="mozilla":null!==window.navigator.userAgent.match("Bowser")?b="bowser":null!==window.navigator.userAgent.match("Chrome")?(b="chrome-stable",null!==window.navigator.userAgent.match("Electron")&&(b="electron")):null!==window.navigator.userAgent.match("Safari")?b="bowser":null!==window.navigator.userAgent.match("AppleWebKit")&&(b="bowser");return b};TK=TK||{};TK.Stream=function(b,a){return!0===a?TK.NativeStream(b):TK.StreamInner(b)};
TK.StreamInner=function(b){var a=TK.EventDispatcher(b);void 0!==b.video&&"number"===typeof b.video&&(b.video=0!==b.video);void 0!==b.audio&&"number"===typeof b.audio&&(b.audio=0!==b.audio);a.stream=b.stream;a.url=b.url;a.recording=b.recording;a.room=void 0;a.playing=!1;a.local=!1;a.video=b.video;a.audio=b.audio;a.screen=b.screen;a.videoSize=b.videoSize;a.videoFrameRate=b.videoFrameRate;a.extensionId=b.extensionId;a.desktopStreamId=b.desktopStreamId;a.videoMuted=!1;a.audioMuted=!1;a.attributes=b.attributes||
{};a.isTkNative=!1;void 0===a.attributes.type&&L.Logger.error("[tk-sdk]create stream spec.attributes.type is not exist , call video stream type must is video!");if(!(void 0===a.videoSize||a.videoSize instanceof Array&&4===a.videoSize.length))throw Error("Invalid Video Size");if(void 0===b.local||!0===b.local)a.local=!0;a.getID=function(){return a.local&&!b.streamID?"local":b.streamID};a.id=a.getID();a.getAttributes=function(){return b.attributes};a.updateLocalAttributes=function(a){if(a&&"object"===
typeof a)for(var c in a)b.attributes[c]=a[c]};a.hasAudio=function(){return b.audio};a.changeAudio=function(a){b.audio=a};a.hasVideo=function(){return b.video};a.changeVideo=function(a){b.video=a};a.hasData=function(){return b.data};a.changeData=function(a){b.data=a};a.hasScreen=function(){return b.screen};a.hasMedia=function(){return!1};a.changeScreen=function(a){b.screen=a};a.sendData=function(){L.Logger.error("[tk-sdk]Failed to send data. This Stream object has not that channel enabled.")};a.init=
function(c){try{if((b.audio||b.video)&&void 0===b.url){L.Logger.debug("[tk-sdk]Requested access to local media");c={dispatchEvent:c,isDemotionLocalStream:!0,isNeedCheckChangeLocalStream:!0,isStopLocalStream:!0};var d={audio:b.audio?{sourceId:L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput)}:!1,video:b.video?{sourceId:L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput)}:!1};TK.AVMgr.getUserMedia(function(b){L.Logger.debug("[tk-sdk]User has granted access to local media.");
a.stream=b;b=void 0;a.stream&&void 0!==a.stream.getUserMediaFailureCode&&(b=a.stream.getUserMediaFailureCode);e=TK.StreamEvent({type:"access-accepted",message:{getUserMediaFailureCode:b}});a.dispatchEvent(e);a.stream.getTracks().forEach(function(b){b.onended=function(){a.stream.getTracks().forEach(function(a){a.onended=null});e=TK.StreamEvent({type:"stream-ended",stream:a,message:b.kind});a.dispatchEvent(e)}})},function(b){L.Logger.error("[tk-sdk]Failed to get access to local media. Error name was "+
b.name+".",b);b=TK.StreamEvent({type:"access-denied",message:{code:L.Constant.accessDenied.streamFail,msg:b}});a.dispatchEvent(b)},d,c)}else{c=d=void 0;b.audio||b.video?(d="There's no audio or video or screen equipment , or url is not undefined",c=L.Constant.accessDenied.notAudioAndVideoAndScreenOrUrlNotUndefined):(d="There's no audio or video equipment",c=L.Constant.accessDenied.notAudioAndVideo);L.Logger.warning("[tk-sdk]"+d,c);var e=TK.StreamEvent({type:"access-denied",message:{code:c,msg:d}});
a.dispatchEvent(e)}}catch(m){c=L.Constant.accessDenied.ohterError,d="[tk-sdk]Failed to get access to local media. Error was "+m+".",L.Logger.error(d),e=TK.StreamEvent({type:"access-denied",message:{code:c,msg:d}}),a.dispatchEvent(e)}};a.close=function(){a.local&&(void 0!==a.room&&a.room.unpublish(a),a.hide(),void 0!==a.stream&&a.stream.getTracks().forEach(function(a){a.onended=null;a.stop()}),a.stream=void 0)};a.play=function(b,d){d=d||{};a.elementID=b;void 0!==b&&(b=new TK.VideoPlayer({id:a.getID(),
stream:a,elementID:b,options:d}),a.player=b,a.playing=!0)};a.stop=function(){a.playing&&void 0!==a.player&&(a.player.destroy(),a.playing=!1)};a.show=function(){void 0!==a.player&&a.player.showVideo()};a.hide=function(){void 0!==a.player&&a.player.hideVideo()};var f=function(){if(void 0!==a.player&&void 0!==a.stream){var b=a.player.video,d=document.defaultView.getComputedStyle(b),e=parseInt(d.getPropertyValue("width"),10),f=parseInt(d.getPropertyValue("height"),10),g=parseInt(d.getPropertyValue("left"),
10);d=parseInt(d.getPropertyValue("top"),10);var l="object"===typeof a.elementID&&"function"===typeof a.elementID.appendChild?a.elementID:document.getElementById(a.elementID);var p=document.defaultView.getComputedStyle(l);l=parseInt(p.getPropertyValue("width"),10);p=parseInt(p.getPropertyValue("height"),10);var n=document.createElement("canvas");n.id="testing";n.width=l;n.height=p;n.setAttribute("style","display: none");n.getContext("2d").drawImage(b,g,d,e,f);return n}return null};a.getVideoFrameURL=
function(a){var b=f();return null!==b?a?b.toDataURL(a):b.toDataURL():null};a.getVideoFrame=function(){var a=f();return null!==a?a.getContext("2d").getImageData(0,0,a.width,a.height):null};a.checkOptions=function(b,d){if(!0===d){if(b.video||b.audio||b.screen)L.Logger.warning("[tk-sdk]Cannot update type of subscription"),b.video=void 0,b.audio=void 0,b.screen=void 0}else!1===a.local&&(!0===b.video&&!1===a.hasVideo()&&(L.Logger.warning("[tk-sdk]Trying to subscribe to video when there is no video, won't subscribe to video"),
b.video=!1),!0===b.audio&&!1===a.hasAudio()&&(L.Logger.warning("[tk-sdk]Trying to subscribe to audio when there is no audio, won't subscribe to audio"),b.audio=!1));!1!==a.local||a.hasVideo()||!0!==b.slideShowMode||(L.Logger.warning("[tk-sdk]Cannot enable slideShowMode if it is not a video subscription, please check your parameters"),b.slideShowMode=!1)};a.updateMuteToServer=function(b){if(a.room&&a.room.p2p)L.Logger.warning("[tk-sdk]muteAudio is not implemented in p2p streams"),b("error");else if(void 0!==
a.pc){var c={muteStream:{video:a.videoMuted,audio:a.audioMuted}};a.checkOptions(c,!0);a.pc.updateSpec(c,b)}};a._setQualityLayer=function(b,d,e){a.room&&a.room.p2p?(L.Logger.warning("[tk-sdk]setQualityLayer is not implemented in p2p streams"),e("error")):(b={qualityLayer:{spatialLayer:b,temporalLayer:d}},a.checkOptions(b,!0),a.pc.updateSpec(b,e))};var e=function(b,d,e){!0!==d&&(d=!1);b="string"===typeof b?[b]:b;b=b instanceof Array?b:[];0<b.length&&a.room.sendControlMessage(a,"control",{name:"controlhandlers",
enable:e,publisherSide:d,handlers:b})};a.disableHandlers=function(a,b){e(a,b,!1)};a.enableHandlers=function(a,b){e(a,b,!0)};a.updateConfiguration=function(b,d){if(void 0!==b)if(a.pc)if(a.checkOptions(b,!0),a.local)if(a.room.p2p)for(var c in a.pc)a.pc[c].updateSpec(b,d);else a.pc.updateSpec(b,d);else a.pc.updateSpec(b,d);else d("This stream has no peerConnection attached, ignoring")};a.muteVideo=function(b,d){a.videoMuted!=b&&(a.videoMuted=b,void 0!==a.stream?(a.stream.getTracks().forEach(function(a){"video"===
a.kind&&(a.enabled=!b)}),a.updateMuteToServer(d)):L.Logger.warning("[tk-sdk]not deviceStream to muteVideo"))};a.muteAudio=function(b,d){a.audioMuted!=b&&(a.audioMuted=b,void 0!==a.stream?(a.stream.getTracks().forEach(function(a){"audio"===a.kind&&(a.enabled=!b)}),a.updateMuteToServer(d)):L.Logger.warning("[tk-sdk]not deviceStream to muteVideo"))};return a};TK=TK||{};
TK.NativeStream=function(b){var a=TK.EventDispatcher(b);a.stream=b.stream;a.url=b.url;a.recording=b.recording;a.room=void 0;a.playing=!1;a.local=!1;a.video=b.video;a.audio=b.audio;a.screen=b.screen;a.media=b.media;a.videoSize=b.videoSize;a.videoFrameRate=b.videoFrameRate;a.extensionId=b.extensionId;a.desktopStreamId=b.desktopStreamId;a.path=b.path;a.videoMuted=!1;a.audioMuted=!1;a.isTkNative=!0;if(!(void 0===a.videoSize||a.videoSize instanceof Array&&4===a.videoSize.length))throw Error("Invalid Video Size");if(void 0===
b.local||!0===b.local)a.local=!0;if(b.screen&&b.media)throw Error("Wrong stream type which contains both media and screen");a.path||(a.path="");var f=function(){return a.media?1:a.screen?2:0};a.getID=function(){return a.local&&!b.streamID?"local":b.streamID};a.getAttributes=function(){return b.attributes};a.updateLocalAttributes=function(a){if(a&&"object"===typeof a)for(var c in a)b.attributes[c]=a[c]};a.hasAudio=function(){return b.audio};a.hasVideo=function(){return b.video};a.hasData=function(){return b.data};
a.hasScreen=function(){return b.screen};a.hasMedia=function(){return b.media};a.sendData=function(){L.Logger.error("[tk-sdk]Failed to send data. This Stream object has not that channel enabled.")};a.init=function(){try{if((b.audio||b.video||b.screen)&&void 0===b.url){L.Logger.debug("[tk-sdk]Requested access to local media");var c=b.video;!0===c||!0===b.screen?(c=!0===c?{}:c,void 0!==a.videoSize&&(c.mandatory=c.mandatory||{},c.mandatory.minWidth=a.videoSize[0],c.mandatory.minHeight=a.videoSize[1],
c.mandatory.maxWidth=a.videoSize[2],c.mandatory.maxHeight=a.videoSize[3]),void 0!==a.videoFrameRate&&(c.optional=c.optional||[],c.optional.push({minFrameRate:a.videoFrameRate[0]}),c.optional.push({maxFrameRate:a.videoFrameRate[1]}))):!0===b.screen&&void 0===c&&(c=!0);TK.AVMgr.getUserMedia(function(b){L.Logger.debug("[tk-sdk]User has granted access to local media.");a.stream=b;e=TK.StreamEvent({type:"access-accepted"});a.dispatchEvent(e)},function(b){L.Logger.error("[tk-sdk]Failed to get access to local media. Error name was "+
b.name+".",b);b=TK.StreamEvent({type:"access-denied",msg:b});a.dispatchEvent(b)},{video:c,audio:b.audio,fake:b.fake,screen:b.screen,extensionId:a.extensionId,desktopStreamId:a.desktopStreamId},{isDemotionLocalStream:!0,isNeedCheckChangeLocalStream:!0,isStopLocalStream:!0})}else{var e=TK.StreamEvent({type:"access-accepted"});a.dispatchEvent(e)}}catch(m){L.Logger.error("[tk-sdk]Failed to get access to local media. Error was:",m),e=TK.StreamEvent({type:"access-denied",msg:m}),a.dispatchEvent(e)}};a.close=
function(){a.local&&(void 0!==a.room&&a.room.unpublish(a),a.hide(),a.stream=void 0)};a.create=function(){a.local?tknative.postMessage({command:"playStream",connectionId:b.extensionId.toString(),isLocal:!0,type:Number(f()),args:{path:a.path.toString()}}):tknative.postMessage({command:"playStream",connectionId:b.extensionId.toString(),isLocal:!1,type:Number(f())})};a.destroy=function(){a.local?tknative.postMessage({command:"stopStream",connectionId:b.extensionId.toString(),isLocal:!0,type:Number(f())}):
tknative.postMessage({command:"stopStream",connectionId:b.extensionId.toString(),isLocal:!1,type:Number(f())})};a.play=function(c,e){e=e||{};a.elementID=c;void 0!==c&&(c=new TK.NativeVideoPlayer({id:b.extensionId,stream:a,elementID:c,options:e}),a.player=c,a.playing=!0,a.local?tknative.postMessage({command:"playStream",connectionId:b.extensionId.toString(),isLocal:!0,type:Number(f()),args:{path:a.path.toString()}}):tknative.postMessage({command:"playStream",connectionId:b.extensionId.toString(),isLocal:!1,
type:Number(f())}))};a.stop=function(){a.playing&&(void 0!==a.player&&(a.player.destroy(),a.playing=!1),a.local?tknative.postMessage({command:"stopStream",connectionId:b.extensionId.toString(),isLocal:!0,type:Number(f())}):tknative.postMessage({command:"stopStream",connectionId:b.extensionId.toString(),isLocal:!1,type:Number(f())}))};a.show=function(){void 0!==a.player&&a.player.showVideo()};a.hide=function(){void 0!==a.player&&a.player.hideVideo()};var e=function(){if(void 0!==a.player&&void 0!==
a.stream){var b=a.player.video,c=document.defaultView.getComputedStyle(b),e=parseInt(c.getPropertyValue("width"),10),g=parseInt(c.getPropertyValue("height"),10),f=parseInt(c.getPropertyValue("left"),10);c=parseInt(c.getPropertyValue("top"),10);var p="object"===typeof a.elementID&&"function"===typeof a.elementID.appendChild?a.elementID:document.getElementById(a.elementID);var n=document.defaultView.getComputedStyle(p);p=parseInt(n.getPropertyValue("width"),10);n=parseInt(n.getPropertyValue("height"),
10);var u=document.createElement("canvas");u.id="testing";u.width=p;u.height=n;u.setAttribute("style","display: none");u.getContext("2d").drawImage(b,f,c,e,g);return u}return null};a.getVideoFrameURL=function(a){var b=e();return null!==b?a?b.toDataURL(a):b.toDataURL():null};a.getVideoFrame=function(){var a=e();return null!==a?a.getContext("2d").getImageData(0,0,a.width,a.height):null};a.checkOptions=function(b,c){if(!0===c){if(b.video||b.audio||b.screen)L.Logger.warning("[tk-sdk]Cannot update type of subscription"),
b.video=void 0,b.audio=void 0,b.screen=void 0}else!1===a.local&&(!0===b.video&&!1===a.hasVideo()&&(L.Logger.warning("[tk-sdk]Trying to subscribe to video when there is no video, won't subscribe to video"),b.video=!1),!0===b.audio&&!1===a.hasAudio()&&(L.Logger.warning("[tk-sdk]Trying to subscribe to audio when there is no audio, won't subscribe to audio"),b.audio=!1));!1!==a.local||a.hasVideo()||!0!==b.slideShowMode||(L.Logger.warning("[tk-sdk]Cannot enable slideShowMode if it is not a video subscription, please check your parameters"),
b.slideShowMode=!1)};a.updateMuteToServer=function(b){if(a.room&&a.room.p2p)L.Logger.warning("[tk-sdk]muteAudio is not implemented in p2p streams"),b("error");else if(void 0!==a.pc){var c={muteStream:{video:a.videoMuted,audio:a.audioMuted}};a.checkOptions(c,!0);a.pc.updateSpec(c,b)}};a._setQualityLayer=function(b,c,e){a.room&&a.room.p2p?(L.Logger.warning("[tk-sdk]setQualityLayer is not implemented in p2p streams"),e("error")):(b={qualityLayer:{spatialLayer:b,temporalLayer:c}},a.checkOptions(b,!0),
a.pc.updateSpec(b,e))};var c=function(b,c,e){!0!==c&&(c=!1);b="string"===typeof b?[b]:b;b=b instanceof Array?b:[];0<b.length&&a.room.sendControlMessage(a,"control",{name:"controlhandlers",enable:e,publisherSide:c,handlers:b})};a.disableHandlers=function(a,b){c(a,b,!1)};a.enableHandlers=function(a,b){c(a,b,!0)};a.updateConfiguration=function(b,c){if(void 0!==b)if(a.pc)if(a.checkOptions(b,!0),a.local)if(a.room.p2p)for(var d in a.pc)a.pc[d].updateSpec(b,c);else a.pc.updateSpec(b,c);else a.pc.updateSpec(b,
c);else c("This stream has no peerConnection attached, ignoring")};a.muteVideo=function(b,c){a.videoMuted!=b&&(a.videoMuted=b,tknative.postMessage({command:"enableVideo",enable:!b}),void 0!==a.stream?a.updateMuteToServer(c):L.Logger.warning("[tk-sdk]not deviceStream to muteVideo"))};a.muteAudio=function(b,c){a.audioMuted!=b&&(a.audioMuted=b,tknative.postMessage({command:"enableAudio",enable:!b}),void 0!==a.stream?a.updateMuteToServer(c):L.Logger.warning("[tk-sdk]not deviceStream to muteVideo"))};
return a};TK=TK||{};TK.SDKTYPE="pc";var tknative;TK.Initialize=function(b){!0!==b?TK.isTkNative=!1:(TK.isTkNative=!0,tknative=tknative||TK.nativeEntry(),TK.AVMgr=null,TK.AVMgr=TK.NativeAVMgr())};
TK.Room=function(){function b(a){if(!H){var b=L.Utils.localStorage.getItem("tkLocalstorageServerName");b&&void 0!=b&&null!=b&&"undefind"!=b&&"null"!=b?H=b:a&&!/(192.168.|127.0.0.1|127.17.|localhost)/g.test(a)?(b=a.indexOf("."),0<b?(a=a.substring(0,b))&&(H=a):L.Logger.warning("[tk-sdk]firstSaveServerNameToLocalStorage--\x3eweb request host not find first dot , current host is "+(window.__TkSdkBuild__?L.Utils.encrypt(a):a)+" ! ")):L.Logger.warning("[tk-sdk]firstSaveServerNameToLocalStorage--\x3eservername is undefind and web_host is exist or not a domain name , current host is "+
(window.__TkSdkBuild__?L.Utils.encrypt(a):a)+" ! ")}}function a(a,b){x=a||x;I=b||I;a=TK.RoomEvent({type:"room-updateWebAddressInfo",message:{host:x,port:I}});h.dispatchEvent(a)}function f(a,b,c){var r=T;a=a||{};a.source=a.source||"unknown source";var d=a.source;w(x,I,function(a,e){if(0!==a)L.Logger.error("[tk-sdk]"+d+":step2GetConfig failure --\x3e result and responseText:",a,e);else if(0==a&&2==B){if(r!==T){h.needReconnectSocket=!0;aa&&h.stopIntervalRtcStatsrObserver();v.rtcStatsrObserverTimer&&
h.stopIntervalRtcStatsrObserverByStream(v);TK.isTkNative&&tknative.postMessage({command:"nativeClear"});ca=!1;try{h.socket&&h.socket.disconnect&&h.socket.disconnect()}catch(La){L.Logger.debug("[tk-sdk]"+d+":Socket already disconnected , disconnect errorInfo:",La)}h.socket=void 0;"select service reconnect"===d&&(l(),a=TK.RoomEvent({type:"room-disconnected",message:"select service reconnect , need socket disconnect"}),h.dispatchEvent(a))}A(x,I,function(a,e){L.Logger.debug("[tk-sdk]reconnected room:step2GetFileList result \x3d "+
a+" , message:"+L.Utils.toJsonStringify(e));-1!==a?(void 0!==e?(da=e,a=TK.RoomEvent({type:"room-files",message:da})):(da=[],a=TK.RoomEvent({type:"room-error",message:{source:L.Constant.roomError.GETFILELISTERROR,error:a}})),h.dispatchEvent(a)):L.Logger.info("[tk-sdk]"+d+":step2GetFileList code is "+a);r===T?(L.Logger.info("[tk-sdk]"+d+":room socket url not change  , room socket url:"+(window.__TkSdkBuild__?L.Utils.encrypt(T):T)+"! "),"reconnected room"===d?F(b,c):"select service reconnect"===d&&(L.Logger.warning("[tk-sdk]room uri is not change , no need to perform a reload server"),
fa&&q&&q.id&&z[q.id]&&H!==q.servername&&h.changeUserProperty(q.id,"__all",{servername:H}))):(L.Logger.info("[tk-sdk]"+d+":room socket url  changed  , old room socket url:"+(window.__TkSdkBuild__?L.Utils.encrypt(r):r)+"  , now room socket url:"+(window.__TkSdkBuild__?L.Utils.encrypt(T):T)+"! "),y())})}else L.Logger.error("[tk-sdk]"+d+":step2GetConfig failure --\x3e result and responseText:",a,e," , _status \x3d "+B),a=TK.RoomEvent({type:"room-error",message:{source:L.Constant.roomError.GETCONFIGERROR,
error:a}}),h.dispatchEvent(a)})}function e(a,b){a=a||J;b=b||H;if(void 0!==a&&void 0!==b)for(var c in a)a[c].isUseServer=b===c?!0:!1}function c(){if(!/(192.168.|127.0.0.1|127.17.|localhost)/g.test(x))if(void 0!==x){var b=x.indexOf(".");0<b?(b=x.substring(0,b),b=new RegExp(b),ia=x,b=x.replace(b,H),b!==x?(L.Logger.info("[tk-sdk]changeWebRequest host , old host is "+(window.__TkSdkBuild__?L.Utils.encrypt(ia):ia)+", now host is "+(window.__TkSdkBuild__?L.Utils.encrypt(b):b)),a(b)):L.Logger.info("[tk-sdk]changeWebRequest host , host is not change ,   host is "+
(window.__TkSdkBuild__?L.Utils.encrypt(x):x))):L.Logger.error("[tk-sdk]web request host not find first dot , cannot address to replace , current host is "+(window.__TkSdkBuild__?L.Utils.encrypt(x):x)+" ! ")}else L.Logger.error("[tk-sdk]web request host is not exist , cannot call changeWebRequestAddress ! ")}function d(a,b,c){a=a||q.publishstate;b=b||{hasvideo:q.hasvideo,disablevideo:q.disablevideo};c=c||{hasaudio:q.hasaudio,disableaudio:q.disableaudio};m(b.hasvideo&&!b.disablevideo&&(a===TK.PUBLISH_STATE_VIDEOONLY||
a===TK.PUBLISH_STATE_BOTH));k(c.hasaudio&&!c.disableaudio&&(a===TK.PUBLISH_STATE_AUDIOONLY||a===TK.PUBLISH_STATE_BOTH))}function k(a){v.muteAudio(!a,function(a){if(void 0!==v.getID()||"local"!==v.getID())L.Logger.debug("[tk-sdk]Sending message",a),a=S(a),V("signaling_message",{streamId:v.getID(),msg:a})})}function m(a){v.muteVideo(!a,function(a){if(void 0!==v.getID()||"local"!==v.getID())L.Logger.debug("[tk-sdk]Sending message",a),a=S(a),V("signaling_message",{streamId:v.getID(),msg:a})})}function g(a,
b,c){"failed"===b&&(void 0===a.reconnectionNumber&&(a.reconnectionNumber=0),0!==h.state&&a&&3>a.reconnectionNumber?"publish"===c?a.extensionId===q.id?(L.Logger.info("[tk-sdk]oniceconnectionstatechange failed --\x3eunpublish , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),h.unpublish(a,function(b){setTimeout(function(){b||L.Logger.warning("[tk-sdk]oniceconnectionstatechange failed: unpublish in not success , stream id:"+a.getID()+
" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())+" !");q.publishstate>TK.PUBLISH_STATE_NONE?(L.Logger.info("[tk-sdk]oniceconnectionstatechange failed --\x3epublish , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),a.reconnectionNumber++,h.publish(a,{reconnection:!0})):L.Logger.warning("[tk-sdk]oniceconnectionstatechange failed --\x3emy publishstate is 0 , not need afresh publish , stream id:"+
a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()))},1E3)},{reconnection:!0})):(h.unpublish(a),L.Logger.info("[tk-sdk]publish stream stream.extensionId !\x3d _myself.id   , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()))):"subscribe"===c&&(L.Logger.info("[tk-sdk]oniceconnectionstatechange failed --\x3eunsubscribe , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+
L.Utils.toJsonStringify(a.getAttributes())),h.unsubscribe(a,function(b){setTimeout(function(){b||L.Logger.warning("[tk-sdk]oniceconnectionstatechange failed: unsubscribe in not success , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())+" !");if(h.remoteStreams[a.getID()]){a.reconnectionNumber++;L.Logger.info("[tk-sdk]oniceconnectionstatechange failed --\x3estream-removed(initiative) , stream id:"+a.getID()+" , extensionId is "+a.extensionId+
", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));var r=TK.StreamEvent({type:"stream-removed",stream:a,message:{reconnection:!0,reconnectionNumber:a.reconnectionNumber,isCompleted:a.isCompleted,source:c,isNotRemote:!0}});h.dispatchEvent(r);L.Logger.info("[tk-sdk]oniceconnectionstatechange failed --\x3esubscribe , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));h.subscribe(a,{reconnection:!0})}else L.Logger.info("[tk-sdk]oniceconnectionstatechange failed --\x3eremoteStreams does not contain streams , not need afresh subscribe , stream id:"+
a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()))},1E3)},{reconnection:!0})):3<=a.reconnectionNumber&&("publish"===c?a.extensionId===q.id&&q.publishstate>TK.PUBLISH_STATE_NONE?h.changeUserProperty(a.extensionId,"__all",{publishstate:TK.PUBLISH_STATE_NONE}):h.unpublish(a):"subscribe"===c&&h.unsubscribe(a),a.isCompleted||q.udpstate===L.Constant.udpState.notOnceSuccess||h.changeUserProperty(q.id,"__all",{udpstate:L.Constant.udpState.notOnceSuccess}),
L.Logger.info("[tk-sdk]stream-reconnection-failed , source is "+c+", isCompleted is "+a.isCompleted+", reconnectionNumber is "+a.reconnectionNumber+" , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),b=TK.StreamEvent({type:"stream-reconnection-failed",message:{reconnectionNumber:a.reconnectionNumber,source:c,isCompleted:a.isCompleted,code:a.isCompleted?L.Constant.streamReconnection.midwayReconnectionNotSuccess:L.Constant.streamReconnection.notOnceSuccess},
stream:a}),h.dispatchEvent(b)))}function l(){var a;for(a in h.remoteStreams)if(h.remoteStreams.hasOwnProperty(a)){var b=h.remoteStreams[a];ja(b);delete h.remoteStreams[a];b&&!b.failed&&(L.Logger.info("[tk-sdk]_resetRoomState--\x3estream-removed(), stream id:"+b.getID()+" , extensionId is "+b.extensionId+", attrs is "+L.Utils.toJsonStringify(b.getAttributes())),b=TK.StreamEvent({type:"stream-removed",stream:b}),h.dispatchEvent(b))}h.remoteStreams={};for(a in h.localStreams)if(h.localStreams.hasOwnProperty(a)){b=
h.localStreams[a];if(h.p2p)for(var c in b.pc)b.pc[c].close();else b.pc.close();delete h.localStreams[a]}z&&(u(N),n(z));q&&(q.publishstate=TK.PUBLISH_STATE_NONE)}function p(a){L.Logger.debug("[tk-sdk]setStatus to: "+a);B!=a&&(B=a,6==B?(N[q.role]||(N[q.role]={}),N[q.role][q.id]=q,z[q.id]=q,q.publishstate>TK.PUBLISH_STATE_NONE&&(d(q.publishstate),h.publish(v))):8==B?l():0==B&&l())}function n(a){if(D)for(b in a)a[b].playbackLeaved=!0;else for(var b in a)delete a[b]}function u(a){if(!D)for(var b in a)delete a[b]}
function t(a,b,c,d,e,g){var r=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");r.open(a,b,c);r.setRequestHeader("Content-Type",g?g:"application/x-www-form-urlencoded;charset\x3dutf-8");r.send(d);r.onreadystatechange=e;return r}function w(a,b,c){p(2);if(void 0==W)c(3,null);else{L.Logger.debug("[tk-sdk]Going to getConfig");b=M+a+":"+b+"/ClientAPI/getconfig?ts\x3d"+(new Date).getTime();var r=t("POST",b,!0,"serial\x3d"+W+"\x26userrole\x3d"+q.role,function(){if(4==r.readyState)if(200==
r.status){var b=L.Utils.toJsonParse(r.responseText);L.Logger.debug("[tk-sdk]getConfig resp \x3d ",L.Utils.toJsonStringify(b));za=b;var d=a,e="8889";if(void 0===qa||void 0===ra){if(void 0!==b.courseserver){var g=b.courseserver;null!=g&&0<g.length&&(d=g)}void 0!==b.courseserverport&&(e=/http:/g.test(M)?Number(b.courseserverport)+1:Number(b.courseserverport))}else d=qa,e=ra;T=M+d+":"+e;C(a,Aa);L.Logger.debug("[tk-sdk]_room_uri \x3d "+T);c(b?0:3,r.responseText)}else L.Logger.error("[tk-sdk]getConfig fail[readyState-status]:",
r.readyState,r.status),c(3,r.responseText)})}}function A(a,b,c){if(void 0===W)c(3,void 0);else if(Ba){L.Logger.debug("[tk-sdk]Going to getFileList");a=M+a+":"+b+"/ClientAPI/getroomfile?ts\x3d"+(new Date).getTime();var r=t("POST",a,!0,"serial\x3d"+W,function(){if(4==r.readyState)if(200==r.status){var a=L.Utils.toJsonParse(r.responseText);L.Logger.debug("[tk-sdk]getFileList resp \x3d ",L.Utils.toJsonStringify(a));var b=a.result,d;0==b&&void 0!==a.roomfile?d=a.roomfile:L.Logger.info("[tk-sdk]getFileList resp.roomfile is not exist , nRet:"+
b);c(b,d)}else L.Logger.error("[tk-sdk]getFileList fail[readyState-status]:",r.readyState,r.status),c(3,void 0)})}else c(-1,void 0)}function C(a,b){Ca&&(b=M+a+":"+b+"/index.html?ts\x3d"+(new Date).getTime(),(sa=/(192.168.|127.0.0.1|127.17.|localhost)/g.test(a)?!1:!0)&&$.ajax({url:b,type:"get",async:!1}).done(function(a){L.Logger.info("[tk-sdk]getFalsificationIp resp :",window.__TkSdkBuild__?L.Utils.encrypt(a):a);a&&"string"===typeof a?ka=a.replace(/(^\s*)|(\s*$)/g,""):L.Logger.warning("[tk-sdk]getFalsificationIp resp not is string")}).fail(function(a){L.Logger.error("[tk-sdk]getFalsificationIp fail:",
a)}))}function y(a,b){L.Logger.debug("[tk-sdk]step3Connect");3<=B||(p(3),L.Logger.info("[tk-sdk]socket connect address:"+(window.__TkSdkBuild__?L.Utils.encrypt(T):T)),fa=!1,pa(T,function(a,b){var c=b.roominfo;a=b.msglist;var r=b.userlist,d=0,e,g=[];var f=c.streams||[];h.p2p=c.p2p;var k=c.id;h.iceServers=c.iceServers;E.defaultVideoBW=la;E.maxVideoBW=la;E.defaultScreenBW=1536;E.maxScreenBW=1536;z={};N={};p(6);for(d in f)if(f.hasOwnProperty(d)){c=f[d];var l=e=!1;if(void 0===c.attributes||void 0!==c.attributes&&
"screen"!==c.attributes.type&&"media"!==c.attributes.type)l=!0;ta&&l&&(e=!0);e=TK.Stream({streamID:c.id,local:!1,audio:c.audio,video:c.video,data:c.data,screen:c.screen,attributes:c.attributes,extensionId:c.extensionId},e);g.push(e);h.remoteStreams[c.id]=e;L.Logger.info("[tk-sdk]room-connected --\x3e stream info , stream id:"+e.getID()+" , extensionId is "+e.extensionId+", attrs is "+L.Utils.toJsonStringify(e.getAttributes()));h.subscribe(e)}for(d in r)r.hasOwnProperty(d)&&(f=TK.RoomUser(r[d]),void 0!==
f&&(N[f.role]||(N[f.role]={}),N[f.role][f.id]=f,z[f.id]=f,D&&z[f.id]&&delete z[f.id].playbackLeaved,L.Logger.info("[tk-sdk]room-connected --\x3e user info: "+L.Utils.toJsonStringify(f))));L.Logger.info("[tk-sdk]room-connected --\x3e myself info: "+L.Utils.toJsonStringify(q));r=[];a&&"string"==typeof a&&(a=L.Utils.toJsonParse(a));for(d in a)a.hasOwnProperty(d)&&r.push(a[d]);r.sort(function(a,b){return void 0!==a&&a.hasOwnProperty("seq")&&void 0!==b&&b.hasOwnProperty("seq")?a.seq-b.seq:0});h.roomID=
k;fa=!0;L.Logger.debug("[tk-sdk]Connected to room "+h.roomID);L.Logger.debug("[tk-sdk]connected response:",L.Utils.toJsonStringify(b));L.Logger.info("[tk-sdk]room-connected ,streams length is "+g.length+" , signalling list length "+r.length);b=TK.RoomEvent({type:"room-connected",streams:g,message:r});h.dispatchEvent(b);aa&&(h.stopIntervalRtcStatsrObserver(),h.startIntervalRtcStatsrObserver())},function(a){L.Logger.error("[tk-sdk]Not Connected! Error: "+a);a=TK.RoomEvent({type:"room-error",message:{source:L.Constant.roomError.ROOMCONNECTERROR,
error:a}});h.dispatchEvent(a)}))}function F(a,b){if(!(5<=B))if(void 0==q.id||void 0==W)L.Logger.error("[tk-sdk]Invalid status",q,W);else{p(5);q&&(H&&(q.servername=H),q.udpstate=L.Constant.udpState.ok);var c={},r;for(r in q)"id"!=r&&"watchStatus"!=r&&(c[r]=q[r]);c={userId:q.id,roomId:W,maxVideo:ba,videofps:Q,videowidth:X,videoheight:ha,properties:c,roomtype:Y.roomtype};if(D){if(!ua){L.Logger.error("[tk-sdk]The playback file address does not exist!");return}c.recordfilepath=ua}L.Logger.info("joinRoom params info:"+
(window.__TkSdkBuild__?L.Utils.encrypt(L.Utils.toJsonStringify(c)):L.Utils.toJsonStringify(c)));O("joinRoom",c,a,b)}}function P(a,b,c){L.Logger.debug("[tk-sdk]Going to webInterfaceGetserver");a=M+a+":"+b+"/ClientAPI/getserverarea?ts\x3d"+(new Date).getTime();$.ajax({url:a,type:"post",async:!0}).done(function(a){L.Logger.info("[tk-sdk]webInterfaceGetserver resp \x3d ",window.__TkSdkBuild__?L.Utils.encrypt(L.Utils.toJsonStringify(a)):L.Utils.toJsonStringify(a));a=L.Utils.toJsonParse(a);var b=a.result;
J={};if(0==b&&void 0!==a.serverarealist)for(var r in a.serverarealist){var d=a.serverarealist[r];J[d.serverareaname]=d}else L.Logger.info("[tk-sdk]webInterfaceGetserver resp.serverarealist is not exist , nRet:"+b);c(b,L.Utils.toJsonStringify(a))}).fail(function(a){L.Logger.error("[tk-sdk]webInterfaceGetserver fail[readyState-status]:",a);c(3,void 0)})}function U(a,b,c){var r=M+x+":"+I+"/ClientAPI/uploaddocument?ts\x3d"+(new Date).getTime();if(a)return $.ajax({url:r,dataType:"json",type:"POST",data:a,
async:!0,processData:!1,contentType:!1,xhr:function(){var a=$.ajaxSettings.xhr();if(a.upload)return c&&"function"===typeof c&&(L.Utils.removeEvent(a.upload,"progress",oa.bind(h,c),!1),L.Utils.addEvent(a.upload,"progress",oa.bind(h,c),!1)),a}}).done(function(a){L.Logger.debug("[tk-sdk]uploadFile resp \x3d ",L.Utils.toJsonStringify(a));b&&"function"===typeof b&&b(a.result,a)}).fail(function(a,c,r){L.Logger.error("[tk-sdk]uploadFile fail[ jqXHR , textStatus , errorThrown ]:",a,c,r);b&&"function"===typeof b&&
b(3,void 0)});L.Logger.error("[tk-sdk]uploadFile formData is required!")}function R(a,b){var c=M+x+":"+I+"/ClientAPI/delroomfile?ts\x3d"+(new Date).getTime();void 0===a||null===a?L.Logger.error("[tk-sdk]deleteFile fileid is required!"):$.ajax({url:c,dataType:"json",type:"POST",anync:!1,data:{serial:Y.serial,fileid:a}}).done(function(a){L.Logger.debug("[tk-sdk]deleteFile resp \x3d ",L.Utils.toJsonStringify(a));b&&"function"===typeof b&&b(a.result,a)}).fail(function(a,c,r){L.Logger.error("[tk-sdk]deleteFile fail[ jqXHR , textStatus , errorThrown ]:",
a,c,r);b(3,void 0)})}function K(a){clearTimeout(h._deviceChangeCallbackTimer);h._deviceChangeCallbackTimer=setTimeout(function(){fa&&q&&void 0!=q.id&&z[q.id]&&!D&&TK.AVMgr.enumerateDevices(function(a){a=a.hasdevice;var b={},c=!1;q.hasvideo!==a.videoinput&&(b.hasvideo=a.videoinput,c=!0);q.hasaudio!==a.audioinput&&(b.hasaudio=a.audioinput,c=!0);c&&(L.Logger.info("[tk-sdk]change device:my old device info  [hasvideo , hasaudio] is ["+q.hasvideo+" ,"+q.hasaudio+"] , change device property is "+L.Utils.toJsonStringify(b)),
0===h.changeUserProperty(q.id,"__all",b)&&(void 0!=b.hasvideo&&q.hasvideo!==b.hasvideo&&(q.hasvideo=b.hasvideo),void 0!=b.hasaudio&&q.hasaudio!==b.hasaudio&&(q.hasaudio=b.hasaudio)),v&&(v.hasVideo()!==q.hasvideo&&v.changeVideo(q.hasvideo),v.hasAudio()!==q.hasaudio&&v.changeAudio(q.hasaudio)),TK.AVMgr.getUserMedia(function(a){if(v.stream){for(var b in a)/^customdata_/g.test(b)&&(v.stream[b]=a[b]);var c=v.stream.getTracks();for(b=0;b<c.length;b++){var r=c[b];v.stream.removeTrack(r)}a=a.getTracks();
for(b=0;b<a.length;b++)r=a[b],v.stream.addTrack(r)}else v.stream=a;v.player&&v.player.changeMediaStreamUrl(v.stream);var e=q.publishstate;e>TK.PUBLISH_STATE_NONE&&h.unpublish(v,function(a,b){k(!0);m(!0);void 0!=a&&(d(q.publishstate),e>TK.PUBLISH_STATE_NONE&&h.publish(v))})},void 0,void 0,{isDemotionLocalStream:!0,isNeedCheckChangeLocalStream:!0,isStopLocalStream:!1}))},{isSetlocalStorage:!0});var a=document.getElementsByTagName("audio"),b=document.getElementsByTagName("video"),c=[];if(a&&0<a.length)for(var r=
0;r<a.length;r++)c.push(a[r]);if(b&&0<b.length)for(r=0;r<b.length;r++)c.push(b[r]);0<c.length&&TK.AVMgr.setElementSinkIdToAudioouputDevice(c);h.dispatchEvent({type:"device_change"})},250)}function S(a){if(!sa||!ka)return a;if("offer"===a.type||"candidate"===a.type){var b=L.Utils.toJsonStringify(a),c=/(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))/g;c.test(b)&&(a=L.Utils.toJsonParse(b.replace(c,"254.254.254.254")))}return a}function Ja(a,b){var c=!1,r=!1,
d=0;r=a.getID()!==v.getID();var e=0,g={frameWidth:0,frameHeight:0},f=0,k=0,h=d=0,l=0,m=0,Z=0,n=0,p=0,u=0,t=0,q=0,C=0,A=0,F=0,w=0,y=0,x=0,P=function(a){"ssrc"===a.type&&"video"===a.mediaType&&(/send/g.test(a.id)?(p=a.bytesSent,u=a.packetsSent,h=Number(a.googRtt),y=Number(a.googNacksReceived),l=Number(a.googFrameWidthSent),m=Number(a.googFrameHeightSent),n=Number(a.googFrameRateSent),Z=a.timestamp,r=!1):/recv/g.test(a.id)&&(t=Number(a.bytesReceived),w=Number(a.packetsReceived),x=Number(a.googNacksSent),
q=Number(a.googCurrentDelayMs),C=Number(a.googFrameWidthReceived),A=Number(a.googFrameHeightReceived),F=Number(a.googFrameRateReceived),Z=a.timestamp,r=!0))};if(b&&"object"===typeof b&&b.forEach)b.forEach(function(a,b){P(a)});else for(var z in b)P(b[z]);a.report||(a.report={},c=!0);a.report.timestamp=a.report.timestamp||Z;r?(a.report.bytesReceived=a.report.bytesReceived||t,a.report.packetsReceived=a.report.packetsReceived||w,a.report.googNacksSent=a.report.googNacksSent||x):(a.report.bytesSent=a.report.bytesSent||
p,a.report.packetsSent=a.report.packetsSent||u,a.report.googNacksReceived=a.report.googNacksReceived||y);if(!c)return r?(d=8*(t-a.report.bytesReceived),g.frameWidth=isNaN(l)?0:C,g.frameHeight=isNaN(m)?0:A,f=F,e=q,k=(x-a.report.googNacksSent)/(w-a.report.packetsReceived)*100):(d=8*(p-a.report.bytesSent),g.frameWidth=isNaN(l)?0:l,g.frameHeight=isNaN(m)?0:m,f=n,e=h,k=(y-a.report.googNacksReceived)/(u-a.report.packetsSent)*100),d=d/((Z-a.report.timestamp)/1E3)/1024,r?(a.report.bytesReceived=t,a.report.packetsReceived=
w,a.report.googNacksSent=x):(a.report.bytesSent=p,a.report.packetsSent=u,a.report.googNacksReceived=y),a.report.timestamp=Z,{kbps:isNaN(d)?0:Math.round(d),frameRatio:g,frameRate:isNaN(f)?0:Math.round(f),packetsLost:isNaN(k)?0:100>=Math.round(k)?Math.round(k):100,rtt:isNaN(e)?0:e}}function oa(a,b){var c=Math.floor(100*b.loaded/b.total);a&&"function"===typeof a&&a(b,c)}L.Logger.info("[tk-sdk-version]sdk-version:"+(window.__SDKVERSIONS__||"2.1.0")+" , sdk-time: "+(window.__SDKVERSIONSTIME__||"2017120622"));
var E={},h=TK.EventDispatcher(E),pa=void 0,O=void 0,V=void 0,va=void 0,wa=void 0,ja=void 0,x=void 0,Da=void 0,ia=void 0,Ea=void 0,I=void 0,T=void 0,W=void 0,xa=0,Fa=void 0,Y=void 0,X=320,ha=240,Q=15,la=256,ba=6,za=void 0,qa=void 0,ra=void 0,v=void 0,ea=void 0,q={},J=void 0,H=void 0,ma=void 0,sa=!1,Ca=!0,ka=window.location.hostname,D=!1,Ba=!0,ua=void 0,ya=3E3,aa=!1,ca=!1,Aa=8080,na=0,fa=!1,Ga=!0;TK.default_stream=v;var M="https://",da;h.remoteStreams={};h.localStreams={};h.roomID="";h.socket={};h.p2p=
!1;h.state=0;var z={},N={},Ha=[[176,144],[320,240],[640,480],[1280,720],[1920,1080]],B=0,Ia=function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}}(),Ma=0,G={};h.getNativeCallSeq=function(){return++Ma};var ta=!1;ja=function(a){void 0!==a.stream&&(a.hide(),a.pc&&(a.pc.close(),delete a.pc),a.local&&a.stream.stop(),delete a.stream)};va=function(a,b){a.local?O("sendDataStream",{id:a.getID(),
msg:b}):L.Logger.error("[tk-sdk]You can not send data through a remote stream")};wa=function(a,b){a.local?(a.updateLocalAttributes(b),O("updateStreamAttributes",{id:a.getID(),attrs:b})):L.Logger.error("[tk-sdk]You can not update attributes in a remote stream")};pa=function(a,b,c){var d=function(a,b){a.pc=TK.Connection({callback:function(c){c=S(c);V("signaling_message",{streamId:a.getID(),peerSocket:b,msg:c})},iceServers:h.iceServers,maxAudioBW:E.maxAudioBW,maxVideoBW:E.maxVideoBW,limitMaxAudioBW:E.maxAudioBW,
limitMaxVideoBW:E.maxVideoBW,cnnId:a.extensionId},a.isTkNative);a.pc.onaddstream=function(b){h.remoteStreams[a.getID()]?(L.Logger.debug("[tk-sdk]Stream subscribed"),a.stream=b.stream,aa&&h.rtcStatsrObserver(a),b=TK.StreamEvent({type:"stream-subscribed",stream:a}),L.Logger.info("[tk-sdk]createRemotePc(stream.pc.onaddstream), stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),h.dispatchEvent(b)):L.Logger.info("[tk-sdk]createRemotePc(stream.pc.onaddstream):remoteStreams does not contain streams ,stream  subscribe  information does not need to be passed to the interface layer , stream id:"+
a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()))}};h.state=1;h.socket=io.connect(T,{secure:!0,reconnection:!0,transports:["websocket"]});h.socket.on("connect",function(){L.Logger.debug("[tk-sdk]tk connectd");h.state=2;p(4);if(0===na||h.needReconnectSocket)h.socket.on("onAddStream",function(a){var b=a.extensionId,c=b.indexOf(":screen"),d=!1,e=!1,r=!1;0<c&&(b=b.substring(0,c));b!=q.id&&(d=!0);if(void 0===a.attributes||void 0!==a.attributes&&"screen"!==
a.attributes.type&&"media"!==a.attributes.type)r=!0;ta&&d&&r&&(e=!0);c=TK.Stream({streamID:a.id,local:!1,audio:a.audio,video:a.video,data:a.data,screen:a.screen,attributes:a.attributes,extensionId:a.extensionId},e);c.room=h;h.remoteStreams[a.id]=c;b===q.id&&(h.publishedDefaultStream=c);d&&h.subscribe(c);aa&&a.extensionId===q.id&&h.rtcStatsrObserver(c);a=TK.StreamEvent({type:"stream-added",stream:c});L.Logger.info("[tk-sdk]stream-added , stream id:"+c.getID()+" , extensionId is "+c.extensionId+", attrs is "+
L.Utils.toJsonStringify(c.getAttributes()));h.dispatchEvent(a)}),h.socket.on("signaling_message_mediaserver",function(a){L.Logger.debug("[tk-sdk]signaling_message_mediaserver",a);var b=a.mess;if(sa&&ka&&"answer"===b.type){var c=L.Utils.toJsonStringify(b),d=ka,e=/(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))/g;e.test(c)&&(b=L.Utils.toJsonParse(c.replace(e,d)))}a.mess=b;b=a.peerId?h.remoteStreams[a.peerId]:h.localStreams[a.streamId];a&&a.mess&&"ready"===a.mess.type&&
(b.isCompleted=!0,b.reconnectionNumber=0,q.udpstate!==L.Constant.udpState.ok&&h.changeUserProperty(q.id,"__all",{udpstate:L.Constant.udpState.ok}));b&&!b.failed&&(b.pc&&b.pc.processSignalingMessage?b.pc.processSignalingMessage(a.mess,b):L.Logger.warning("stream.pc is not exist , Can't call processSignalingMessage method!"))}),h.socket.on("signaling_message_peer",function(a){var b=h.localStreams[a.streamId];L.Logger.debug("signaling_message_peer",a);b&&!b.failed?b.pc[a.peerSocket].processSignalingMessage(a.msg):
(b=h.remoteStreams[a.streamId],b.pc||d(b,a.peerSocket),b.pc&&b.pc.processSignalingMessage?b.pc.processSignalingMessage(a.msg):L.Logger.warning("stream.pc is not exist , Can't call processSignalingMessage method!"))}),h.socket.on("publish_me",function(a){var b=h.localStreams[a.streamId];void 0===b.pc&&(b.pc={});b.pc[a.peerSocket]=TK.Connection({callback:function(b){b=S(b);V("signaling_message",{streamId:a.streamId,peerSocket:a.peerSocket,msg:b})},audio:b.hasAudio(),video:b.hasVideo(),media:b.hasMedia(),
iceServers:h.iceServers,cnnId:b.extensionId},TK.isTkNative);b.pc[a.peerSocket].oniceconnectionstatechange=function(c){"failed"===c&&(b.pc[a.peerSocket].close(),delete b.pc[a.peerSocket])};b.pc[a.peerSocket].addStream(b.stream);b.pc[a.peerSocket].createOffer()}),h.socket.on("onBandwidthAlert",function(a){L.Logger.debug("[tk-sdk]Bandwidth Alert on",a.streamID,"message",a.message,"BW:",a.bandwidth);if(a.streamID){var b=h.remoteStreams[a.streamID];b&&!b.failed&&(a=TK.StreamEvent({type:"bandwidth-alert",
stream:b,message:a.message,bandwidth:a.bandwidth}),h.dispatchEvent(a))}}),h.socket.on("onDataStream",function(a){a=TK.StreamEvent({type:"stream-data",message:a.msg,stream:h.remoteStreams[a.id]});h.dispatchEvent(a)}),h.socket.on("onUpdateAttributeStream",function(a){var b=h.remoteStreams[a.id],c=TK.StreamEvent({type:"stream-attributes-update",attrs:a.attrs,stream:b});void 0!==b?(b.updateLocalAttributes(a.attrs),h.dispatchEvent(c)):L.Logger.warning("[tk-sdk]onUpdateAttributeStream stream invalid",a)}),
h.socket.on("onRemoveStream",function(a){var b=h.remoteStreams[a.id];b&&b.failed?L.Logger.debug("[tk-sdk]Received onRemoveStream for a stream that we already marked as failed ",a.id):b?(delete h.remoteStreams[a.id],delete h.localStreams[a.id],ja(b),a=TK.StreamEvent({type:"stream-removed",stream:b}),L.Logger.info("[tk-sdk]stream-removed , stream id:"+b.getID()+" , extensionId is "+b.extensionId+", attrs is "+L.Utils.toJsonStringify(b.getAttributes())),h.dispatchEvent(a)):L.Logger.debug("[tk-sdk]Received a removeStream for",
a.id,"and it has not been registered here, ignoring.")}),h.socket.on("disconnect",function(a){h.needReconnectSocket||(L.Logger.debug("[tk-sdk]Socket disconnected, lost connection to TKController",a),0!==h.state&&(p(8),h.state=0,aa&&h.stopIntervalRtcStatsrObserver(),v.rtcStatsrObserverTimer&&h.stopIntervalRtcStatsrObserverByStream(v),TK.isTkNative&&tknative.postMessage({command:"nativeClear"}),ca=!1,a=TK.RoomEvent({type:"room-disconnected",message:"unexpected-disconnection"}),h.dispatchEvent(a)))}),
h.socket.on("connection_failed",function(a){L.Logger.debug("[tk-sdk]Socket connection_failed , arg is "+L.Utils.toJsonStringify(a))}),h.socket.on("error",function(a){L.Logger.error("[tk-sdk]Cannot connect to Controller");c&&c("Cannot connect to TKController (socket.io error)",a)}),h.socket.on("reconnecting",function(a){L.Logger.debug("[tk-sdk]reconnecting info:",a);a=TK.RoomEvent({type:"room-reconnecting",message:{number:a,info:"room-reconnecting number:"+a}});h.dispatchEvent(a)}),h.socket.on("participantLeft",
function(a){L.Logger.debug("[tk-sdk]participantLeft userid:"+a);var b=z[a];void 0===b?L.Logger.error("[tk-sdk]participantLeft user is not exist , userid is "+a+"!"):(L.Logger.info("[tk-sdk]user leave room  , user info: "+L.Utils.toJsonStringify(b)),N[b.role]||(N[b.role]={}),D?z[a]&&(z[a].playbackLeaved=!0):(delete N[b.role][a],delete z[a]),D&&"object"===typeof a&&(b.leaveTs=a.ts),a=TK.RoomEvent({type:"room-participant_leave",user:b}),h.dispatchEvent(a))}),h.socket.on("participantJoined",function(a){L.Logger.debug("[tk-sdk]participantJoined userinfo:"+
L.Utils.toJsonStringify(a));var b=TK.RoomUser(a);L.Logger.info("[tk-sdk]user join room  , user info: "+L.Utils.toJsonStringify(b));N[b.role]||(N[b.role]={});N[b.role][b.id]=b;z[b.id]=b;D&&z[b.id]&&delete z[b.id].playbackLeaved;D&&"object"===typeof a&&(b.joinTs=a.ts);a=TK.RoomEvent({type:"room-participant_join",user:b});h.dispatchEvent(a)}),h.socket.on("participantEvicted",function(){L.Logger.info("[tk-sdk]user evicted room  , user info: "+L.Utils.toJsonStringify(q));h.leaveroom(!0);var a=TK.RoomEvent({type:"room-participant_evicted"});
h.dispatchEvent(a)}),h.socket.on("sendMessage",function(a){L.Logger.debug("[tk-sdk]room-text-message info:"+(a&&"object"===typeof a?L.Utils.toJsonStringify(a):a));if(a&&a.hasOwnProperty("message")){var b=a.fromID,c=q;if(10===Y.roomtype)c=void 0;else if(void 0!==b&&(c=z[a.fromID]),!c){L.Logger.error("[tk-sdk]user is not exist , user id:"+a.fromID+", message from room-text-message!");return}D&&(b=!1,a&&a.message&&"string"===typeof a.message&&(a.message=L.Utils.toJsonParse(a.message),b=!0),a.message.ts=
a.ts,b&&"object"===typeof a.message&&(a.message=L.Utils.toJsonStringify(a.message)));a=TK.RoomEvent({type:"room-text-message",user:c,message:a.message});h.dispatchEvent(a)}else L.Logger.error("messages or messages.message is not exist!")}),h.socket.on("msgList",function(a){L.Logger.debug("[tk-sdk]msgList info:",L.Utils.toJsonStringify(a));a=TK.RoomEvent({type:"room-msglist",message:a});h.dispatchEvent(a)}),h.socket.on("pubMsg",function(a){L.Logger.debug("[tk-sdk]pubMsg info:",L.Utils.toJsonStringify(a));
a=TK.RoomEvent({type:"room-pubmsg",message:a});h.dispatchEvent(a)}),h.socket.on("delMsg",function(a){L.Logger.debug("[tk-sdk]delMsg info:",L.Utils.toJsonStringify(a));a=TK.RoomEvent({type:"room-delmsg",message:a});h.dispatchEvent(a)}),h.socket.on("setProperty",function(a){L.Logger.debug("[tk-sdk]setProperty info:",L.Utils.toJsonStringify(a));var b=a.id;if(a.hasOwnProperty("properties")){var c=a.properties,d=z[b];if(q.id==b)if(d=q,c.hasOwnProperty("publishstate"))h.onChangeMyPublishState(c.publishstate);
else if(c.hasOwnProperty("disablevideo"))h.onChangeMyDisableVideoState(c.disablevideo);else if(c.hasOwnProperty("disableaudio"))h.onChangeMyDisableAudioState(c.disableaudio);else c.hasOwnProperty("hasaudio")?v.audio=c.hasaudio:c.hasOwnProperty("hasvideo")&&(v.video=c.hasvideo);if(void 0===d)L.Logger.error("[tk-sdk]setProperty user is not exist , userid is "+b+"!");else{var r=d.servername,g;for(g in c)"id"!=g&&"watchStatus"!=g&&(d[g]=c[g]);d=TK.RoomEvent({type:"room-userproperty-changed",user:d,message:c},
{fromID:a.fromID});h.dispatchEvent(d);q.id==b&&c.hasOwnProperty("servername")&&(q.id!==a.fromID?c.servername&&c.servername!==r&&h.switchServerByName(c.servername):c.servername&&c.servername!==r&&(H=c.servername,L.Utils.localStorage.setItem("tkLocalstorageServerName",H),e(J,H)))}}}),h.socket.on("playback_clearAll",function(){if(D){var a=TK.RoomEvent({type:"room-playback-clear_all"});h.dispatchEvent(a)}else L.Logger.warning("[tk-sdk]No playback environment!")}),h.socket.on("duration",function(a){D?
(a=TK.RoomEvent({type:"room-playback-duration",message:a}),h.dispatchEvent(a)):L.Logger.warning("[tk-sdk]No playback environment!")}),h.socket.on("playbackEnd",function(){if(D){var a=TK.RoomEvent({type:"room-playback-playbackEnd"});h.dispatchEvent(a)}else L.Logger.warning("[tk-sdk]No playback environment!")}),h.socket.on("playback_updatetime",function(a){D?(a=TK.RoomEvent({type:"room-playback-playback_updatetime",message:a}),h.dispatchEvent(a)):L.Logger.warning("[tk-sdk]No playback environment!")}),
na++,L.Logger.info("[tk-sdk]connected room  , current connected number is "+na+"! "),h.needReconnectSocket||L.Logger.info("[tk-sdk]Reconnect Socket ,  join room start! "),h.needReconnectSocket=!1,F(b,c);else{L.Logger.info("[tk-sdk]reconnected room! ");var a=TK.RoomEvent({type:"room-reconnected"});h.dispatchEvent(a);f({source:"reconnected room"},b,c)}})};O=function(a,b,c,d){L.Logger.debug("[tk-sdk]sendMessageSocket",a,b);h.socket.emit(a,b,function(a,e){"success"===a?(L.Logger.debug("[tk-sdk]sendMessageSocket success",
b,e),c&&c(e)):"error"===a?d&&d(e):c&&c(a,e)})};V=function(a,b,c,d){0!==h.state?h.socket.emit(a,b,c,function(a,b){d&&d(a,b)}):L.Logger.warning("[tk-sdk]Trying to send a message over a disconnected Socket")};h.setIsGetFileList=function(a){Ba=a};h.getRoomType=function(){return xa};h.getRoomName=function(){return Fa};h.getRoomProperties=function(){return Y};h.getMySelf=function(){return q};h.getUser=function(a){if(void 0!==a)return z[a]};h.getUsers=function(){return z};h.getUsersNumber=function(a){var b=
0,c;for(c in z)void 0!==a&&z[c].role==a||b++;return b};h.getSpecifyRoleList=function(a){return void 0===a?(L.Logger.error("[tk-sdk]getSpecifyRoleList specifyKey is exist!"),{}):N[a]||{}};h.getAllRoleList=function(){return N};h.getConfigInfo=function(){return za};h.getSpecifyUsersByPublishstate=function(a,b,c){var d={},e;for(e in z){var r=z[e];c?r.publishstate!==TK.PUBLISH_STATE_NONE&&(void 0==b||null==b||"number"!=typeof b?("number"!=typeof b&&L.Logger.warning("filterRole must is number!",b),d[e]=
r):r.role==b&&(d[e]=r)):r.publishstate===a&&(void 0==b||null==b||"number"!=typeof b?("number"!=typeof b&&L.Logger.warning("filterRole must is number!",b),d[e]=r):r.role==b&&(d[e]=r))}return d};h.getPublishStreamNumber=function(){var a=0,b;for(b in z)z[b].publishstate!==TK.PUBLISH_STATE_NONE&&a++;return a};h.isBeyondMaxVideo=function(){var a=0,b;for(b in z)if(z[b].publishstate!==TK.PUBLISH_STATE_NONE&&++a>=ba)return!0;return!1};h.changeUserProperty=function(a,b,c){if(6!=B)return 2;if(void 0===c)return L.Logger.error("[tk-mobile-sdk]changeUserProperty properties or id is not exist!"),
4;var d={};d.id=a;d.toID=b||"__all";if(z[a]){if(c&&"object"===typeof c)return d.properties=c,O("setProperty",d),0;L.Logger.error("[tk-sdk]properties must be json , user id: "+a+"!")}else L.Logger.error("[tk-sdk]user is not exist , user id: "+a+"!")};h.onChangeMyPublishState=function(a){L.Logger.debug("[tk-sdk]onChangeMyPublishState "+q.publishstate+" to "+a);q.publishstate!=a&&(a>TK.PUBLISH_STATE_NONE?(d(a),q.publishstate===TK.PUBLISH_STATE_NONE&&h.publish(v)):h.unpublish(v),q.publishstate=a)};h.onChangeMyDisableVideoState=
function(a){L.Logger.debug("[tk-sdk]onChangeMyDisableVideoState "+q.disablevideo+" to "+a);q.disablevideo!=a&&(q.disablevideo=a,q.publishstate>TK.PUBLISH_STATE_NONE&&d())};h.onChangeMyDisableAudioState=function(a){L.Logger.debug("[tk-sdk]onChangeMyDisableAudioState "+q.disableaudio+" to "+a);q.disableaudio!=a&&(q.disableaudio=a,q.publishstate>TK.PUBLISH_STATE_NONE&&d())};h.changeUserPublish=function(a,b){if(6!=B)return 2;if(void 0===a)return 4;h.changeUserProperty(a,"__all",{publishstate:b});return 0};
h.changeMyDisableVideoState=function(a){"boolean"!==typeof a?L.Logger.warning("[tk-sdk]changeMyDisableVideoState:disablevideo must boolean !"):(h.onChangeMyDisableVideoState(a),h.changeUserProperty(q.id,"__all",{disablevideo:a}))};h.changeMyDisableAudioState=function(a){"boolean"!==typeof a?L.Logger.warning("[tk-sdk]changeMyDisableAudioState:disableaudio must boolean !"):(h.onChangeMyDisableAudioState(a),h.changeUserProperty(q.id,"__all",{disableaudio:a}))};h.sendMessage=function(a,b){if(6!=B)return 2;
var c={};c.toID=b;c.message=a;O("sendMessage",c);return 0};h.pubMsg=function(a,b,c,d,e,g,f,k,h,l,m,n){if(6!=B)return 2;var r={};r.name=a;r.id=b;r.toID=c;r.data=d;e||(r.do_not_save="");if(void 0!==h){if("number"!==typeof h){L.Logger.error("[tk-mobile-sdk]pubMsg params expires must is number!");return}r.expires=h}if(void 0!==g){if("number"!==typeof g){L.Logger.error("[tk-mobile-sdk]pubMsg params expiresabs must is number!");return}r.expiresabs=g}void 0!==f&&(r.associatedMsgID=f);void 0!==k&&(r.associatedUserID=
k);r.type=l;void 0!==m&&"boolean"===typeof m&&(r.write2DB=m);if(void 0!==n&&Array.isArray(n)&&void 0!==f)r.actions=n;else if(void 0!==n&&Array.isArray(n)&&void 0===f)return L.Logger.error("[tk-sdk]pubMsg params actions depend on associatedMsgID, but associatedMsgID not defined!");O("pubMsg",r);return 0};h.delMsg=function(a,b,c,d){if(6!=B)return 2;var e={};e.name=a;e.id=b;e.toID=c;e.data=d;O("delMsg",e);return 0};h.evictUser=function(a){L.Logger.debug("[tk-sdk]evictUser",a);if(6!=B)return 2;var b=
{};b.id=a;O("evictParticipant",b);return 0};h.joinroom=function(a,b,c){0!==h.state&&L.Logger.warning("[tk-sdk]Room already connected",this.state);if(1!==B||void 0===x||void 0===I||void 0===q)return L.Logger.warning("[tk-sdk]Status error:",B),-1;v=a;TK.default_stream=v;void 0===a?(q.hasvideo=!1,q.hasaudio=!1):(q.hasvideo=a.video,q.hasaudio=a.audio);L.Logger.info("[tk-sdk]joinroom:my device info  [hasvideo , hasaudio] is ["+q.hasvideo+" ,"+q.hasaudio+"]");qa=b;ra=c;L.Logger.debug("[tk-sdk]joinroom:my room user",
q);z={};N={};w(x,I,function(a,b){0!==a?L.Logger.error("[tk-sdk]step2GetConfig failure --\x3e result and responseText:",a,b):0==a&&2==B?A(x,I,function(a,b){L.Logger.debug("[tk-sdk]step2GetFileList result \x3d "+a+" , message:"+L.Utils.toJsonStringify(b));-1!==a?(void 0!==b?(da=b,a=TK.RoomEvent({type:"room-files",message:da})):(da=[],a=TK.RoomEvent({type:"room-error",message:{source:L.Constant.roomError.GETFILELISTERROR,error:a}})),h.dispatchEvent(a)):L.Logger.info("[tk-sdk]step2GetFileList code is "+
a);y()}):(L.Logger.error("[tk-sdk]step2GetConfig failure --\x3e result and responseText:",a,b," , _status \x3d "+B),a=TK.RoomEvent({type:"room-error",message:{source:L.Constant.roomError.GETCONFIGERROR,error:a}}),h.dispatchEvent(a))})};h.leaveroom=function(a){a=a||!1;L.Logger.debug("[tk-sdk]leaveroom:Disconnection requested");p(8);try{h.socket&&h.socket.disconnect&&h.socket.disconnect()}catch(Z){L.Logger.debug("[tk-sdk]Socket already disconnected , disconnect errorInfo:",Z)}h.socket=void 0;a=TK.RoomEvent({type:"room-leaveroom",
message:a});h.dispatchEvent(a)};h.publish=function(a,b,c){if(6!=B)return L.Logger.warning("[tk-sdk]publish with wrong room status",B),2;L.Logger.info("[tk-sdk]calling publish , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));b=b||{};b.maxVideoBW=b.maxVideoBW||E.defaultVideoBW;b.maxVideoBW>E.maxVideoBW&&(b.maxVideoBW=E.maxVideoBW);void 0===b.minVideoBW&&(b.minVideoBW=0);b.minVideoBW>E.defaultVideoBW&&(b.minVideoBW=E.defaultVideoBW);
b.simulcast=b.simulcast||b._simulcast||!1;if(a&&void 0===h.localStreams[a.getID()]){if(a.hasAudio()||a.hasVideo()||a.hasScreen())return void 0===a.url&&void 0===a.recording&&(a.failed&&delete a.failed,clearTimeout(a._publishTimer),a._publishTimer=setTimeout(function(){h.unpublish(a,function(b){setTimeout(function(){b||L.Logger.warning("[tk-sdk]publish timeout 15s: unpublish in not success , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())+
" !");if(a.extensionId===q.id)if(3>a.timeoutRePublishNumber)void 0===a.timeoutRePublishNumber&&(a.timeoutRePublishNumber=0),q.publishstate>TK.PUBLISH_STATE_NONE?(L.Logger.info("[tk-sdk]publish timeout 15s--\x3epublish , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),a.timeoutRePublishNumber++,h.publish(a,{timeoutPublishReconnection:!0})):L.Logger.warning("[tk-sdk]publish timeout 15s--\x3emy publishstate is 0 , not need afresh publish , stream id:"+
a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));else{L.Logger.info("[tk-sdk]publish timeout 15s--\x3erePublish number \x3e 3 , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));a.extensionId===q.id&&q.publishstate>TK.PUBLISH_STATE_NONE&&h.changeUserProperty(a.extensionId,"__all",{publishstate:TK.PUBLISH_STATE_NONE});var d=TK.StreamEvent({type:"stream-publish-fail",stream:a,message:{code:"publishTimeout",
errorCode:-1,timeoutRePublishNumber:a.timeoutRePublishNumber,timeoutPublishReconnection:!0}});h.dispatchEvent(d);c&&c(void 0,void 0)}else d=TK.StreamEvent({type:"stream-publish-fail",stream:a,message:{code:"publishTimeout",errorCode:-1}}),h.dispatchEvent(d),L.Logger.info("[tk-sdk]publish timeout 15s--\x3e publish stream stream.extensionId !\x3d _myself.id   , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()))},1E3)})},15E3),L.Logger.debug("[tk-sdk]Publishing to ms Normally, is createOffer",
b.createOffer,a.extensionId),V("publish",{state:"ms",data:a.hasData(),audio:a.hasAudio(),video:a.hasVideo(),screen:a.hasScreen(),minVideoBW:b.minVideoBW,attributes:a.getAttributes(),extensionId:a.extensionId,createOffer:b.createOffer,metadata:b.metadata,scheme:b.scheme},void 0,function(d,e){clearTimeout(a._publishTimer);if(0!=d)if(L.Logger.error("[tk-sdk]Error when publishing the stream: ",d,e),L.Logger.info("[tk-sdk]stream-publish-fail , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+
L.Utils.toJsonStringify(a.getAttributes())),a.extensionId===q.id)if(3>a.publishReconnectionNumber)void 0===a.publishReconnectionNumber&&(a.publishReconnectionNumber=0),h.unpublish(a,function(b){setTimeout(function(){q.publishstate>TK.PUBLISH_STATE_NONE?(L.Logger.info("[tk-sdk]stream-publish-fail:publish , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),a.publishReconnectionNumber++,h.publish(a,{publishReconnection:!0})):L.Logger.warning("[tk-sdk]stream-publish-fail:my publishstate is 0 , not need afresh publish , stream id:"+
a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()))},1E3)},{publishReconnection:!0});else{a.extensionId===q.id&&q.publishstate>TK.PUBLISH_STATE_NONE?h.changeUserProperty(a.extensionId,"__all",{publishstate:TK.PUBLISH_STATE_NONE}):h.unpublish(a);var r=TK.StreamEvent({type:"stream-publish-fail",stream:a,message:{code:"publishFail",errorCode:d,publishReconnectionNumber:a.publishReconnectionNumber,publishReconnection:!0,hasdata:!1}});h.dispatchEvent(r);
c&&c(void 0,d)}else L.Logger.info("[tk-sdk]stream-publish-fail:publish stream stream.extensionId !\x3d _myself.id   , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),h.unpublish(a),r=TK.StreamEvent({type:"stream-publish-fail",stream:a,message:{code:"publishFail",errorCode:d,id:e,hasdata:!1}}),h.dispatchEvent(r),c&&c(void 0,d);else L.Logger.debug("[tk-sdk]Stream assigned an Id, starting the publish process , stream id:"+a.getID()+" , extensionId is "+
a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),a.publishReconnectionNumber=0,a.timeoutRePublishNumber=0,b.reconnection||(delete a.isCompleted,a.reconnectionNumber=0),a.getID=function(){return e},a.id=a.getID(),a.hasData()&&(a.sendData=function(b){va(a,b)}),a.setAttributes=function(b){wa(a,b)},a.hasScreen()&&(ca=!0),h.localStreams[e]=a,a.room=h,a.pc=TK.Connection({callback:function(b){L.Logger.debug("[tk-sdk]Sending message",b);b=S(b);V("signaling_message",{streamId:a.getID(),
msg:b},void 0,function(){})},iceServers:h.iceServers,maxAudioBW:b.maxAudioBW,maxVideoBW:a.hasScreen()?E.maxScreenBW:b.maxVideoBW,limitMaxAudioBW:E.maxAudioBW,limitMaxVideoBW:a.hasScreen()?E.maxScreenBW:E.maxVideoBW,simulcast:b.simulcast,audio:a.hasAudio(),video:a.hasVideo(),screen:a.hasScreen(),media:a.hasMedia(),cnnId:q.id},TK.isTkNative),a.pc.addStream(a.stream),a.pc.oniceconnectionstatechange=function(b){L.Logger.info("[tk-sdk]publish ice state:"+b+" , stream id:"+a.getID()+" , extensionId is "+
a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));"failed"===b&&0!==h.state&&a&&!a.failed&&(a.failed=!0,L.Logger.warning("[tk-sdk]Publishing Stream",a.getID(),"has failed after successful ICE checks , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),g(a,b,"publish"))},b.createOffer||a.pc.createOffer(),c&&c(e)})),0;L.Logger.error("[tk-sdk]Either screen or audio or video is at least one true for streaming",a);c&&
c(void 0,"Either screen or audio or video is at least one true for streaming")}else L.Logger.error("[tk-sdk]Trying to publish invalid stream , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),c&&c(void 0,"Trying to publish invalid stream")};h.publishMedia=function(a,b,c){if(6!=B)return L.Logger.warning("[tk-sdk]publish with wrong room status",B),2;L.Logger.info("[tk-sdk]calling mediaPublish stream , stream id:"+a.getID()+" , extensionId is "+
a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));b=b||{};if(a&&void 0===h.remoteStreams[a.getID()]){if(a.hasAudio()||a.hasVideo()){if(void 0!==a.url||void 0!==a.recording){a.failed&&delete a.failed;if(a.url){var d="url";var e=a.url}else d="recording",e=a.recording;L.Logger.debug("[tk-sdk]Checking publish options for",a.getID());a.checkOptions(b);V("publish",{state:d,data:a.hasData(),audio:a.hasAudio(),video:a.hasVideo(),attributes:a.getAttributes(),extensionId:a.extensionId,
metadata:b.metadata,createOffer:b.createOffer},e,function(d,e){if(0==d)L.Logger.debug("[tk-sdk]mediaStream published , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),b.reconnection||(delete a.isCompleted,a.reconnectionNumber=0),a.getID=function(){return e},a.id=a.getID(),a.sendData=function(b){va(a,b)},a.setAttributes=function(b){wa(a,b)},a.room=h,c&&c(e);else{L.Logger.error("[tk-sdk]Error when publishing mediaStream",d,e);var r=
TK.StreamEvent({type:"stream-publish-fail",stream:a,message:{errorCode:d,id:e,hasdata:!1}});L.Logger.info("[tk-sdk]stream-publish-fail , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));h.dispatchEvent(r);c&&c(void 0,d)}})}return 0}L.Logger.error("[tk-sdk]Audio and video in the media file stream at least one is true",a);c&&c(void 0,"Audio and video in the media file stream at least one is true")}else L.Logger.error("[tk-sdk]Trying to publish invalid mediaStream",
a),c&&c(void 0,"Trying to publish invalid mediaStrea")};h.publishScreen=function(a,b,c){if(6!=B)return L.Logger.warning("[tk-sdk]publish with wrong room status",B),2;if(ca)L.Logger.error("[tk-sdk]Screen has been shared already");else if(L.Logger.info("[tk-sdk]calling screenPublish stream , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),a&&!a.failed&&void 0===h.remoteStreams[a.getID()]){if(a.hasScreen())return ea=a,h.publish(ea,b,
c);L.Logger.error("[tk-sdk]Screen Shared streaming screen  must be true",a);c&&c(void 0,"Screen Shared streaming screen must be true")}else L.Logger.error("[tk-sdk]Trying to publish invalid screenStream",a),c&&c(void 0,"Trying to publish invalid screenStream")};h.startRecording=function(a,b){a?(L.Logger.debug("[tk-sdk]Start Recording stream: "+a.getID()),O("startRecorder",{to:a.getID()},function(a,c){null===a?(L.Logger.error("[tk-sdk]Error on start recording",c),b&&b(void 0,c)):(L.Logger.debug("[tk-sdk]Start recording",
a),b&&b(a))})):(L.Logger.error("[tk-sdk]Trying to start recording on an invalid stream",a),b&&b(void 0,"Invalid Stream"))};h.stopRecording=function(a,b){O("stopRecorder",{id:a},function(c,d){null===c?(L.Logger.error("[tk-sdk]Error on stop recording",d),b&&b(void 0,d)):(L.Logger.debug("[tk-sdk]Stop recording",a),b&&b(!0))})};h.unpublish=function(a,b,c){if(6!=B)return 2;c=c||{};L.Logger.info("[tk-sdk]calling unpublish , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));
if(a)return O("unpublish",a.getID(),function(d,e){0!==d?(L.Logger.error("[tk-sdk]Error unpublishing stream, stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()),e),d=TK.StreamEvent({type:"stream-unpublish-fail",stream:a,message:{error:e}}),L.Logger.info("[tk-sdk]stream-unpublish-fail , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),h.dispatchEvent(d),b&&b(void 0,e)):(L.Logger.debug("[tk-sdk]Stream unpublished  , stream id:"+
a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),c.reconnection||(delete a.isCompleted,a.reconnectionNumber=0),a.room=void 0,(a.hasAudio()||a.hasVideo()||a.hasScreen())&&void 0===a.url&&(a.pc&&a.pc.close(),a.pc=void 0),a.hasScreen()&&(ca=!1),a.extensionId===q.id&&(h.publishedDefaultStream||(d=TK.StreamEvent({type:"stream-unpublish-not-belong-remoteStreams",stream:a}),L.Logger.warning("[tk-sdk]stream-unpublish-not-belong-remoteStreams , stream id:"+
a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),h.dispatchEvent(d)),h.publishedDefaultStream=void 0),delete h.localStreams[a.getID()],a.getID=function(){return"local"},a.id=a.getID(),a.sendData=function(){},a.setAttributes=function(){},a.failed&&delete a.failed,b&&b(!0))}),0;L.Logger.error("[tk-sdk]unpublish error:","Cannot unpublish, stream does not exist or is not local");var d=TK.StreamEvent({type:"stream-unpublish-fail",stream:a,message:{error:"Cannot unpublish, stream does not exist or is not local"}});
L.Logger.info("[tk-sdk]stream-unpublish-fail , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));h.dispatchEvent(d);b&&b(void 0,"Cannot unpublish, stream does not exist or is not local")};h.unpublishMedia=function(a,b){if(6!=B)return 2;L.Logger.info("[tk-sdk]calling unpublishMedia , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));O("unpublish",a.getID(),function(c,d){0!==
c?(L.Logger.error("[tk-sdk]Error unpublishing stream",d),c=TK.StreamEvent({type:"stream-unpublish-fail",stream:a,message:{error:d}}),L.Logger.info("[tk-sdk]stream-unpublish-fail , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),h.dispatchEvent(c),b&&b(void 0,d)):(L.Logger.debug("[tk-sdk]meidaStream unpublished , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),a.failed&&
delete a.failed,b&&b(!0))});return 0};h.unpublishScreen=function(a){if(6!=B)return 2;if(ca)return L.Logger.info("[tk-sdk]calling unpublishScreen , stream id:"+ea.getID()+" , extensionId is "+ea.extensionId+", attrs is "+L.Utils.toJsonStringify(ea.getAttributes())),h.unpublish(ea,a)};h.sendControlMessage=function(a,b,c){a&&a.getID()&&(b={type:"control",action:c},V("signaling_message",{streamId:a.getID(),msg:b}))};h.subscribe=function(a,b,c){if(6!=B)return L.Logger.warning("[tk-sdk]subscribe when not ready"),
2;clearTimeout(a._subscribeTimer);a._subscribeTimer=setTimeout(function(){h.unsubscribe(a,function(b){setTimeout(function(){b||L.Logger.warning("[tk-sdk]subscribe timeout 15s: unsubscribe in not success , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())+" !");if(h.remoteStreams[a.getID()])if(3>a.timeoutReSubcribeNumber){L.Logger.info("[tk-sdk]subscribe timeout 15s--\x3esubscribe , stream id:"+a.getID()+" , extensionId is "+a.extensionId+
", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));void 0===a.timeoutReSubcribeNumber&&(a.timeoutReSubcribeNumber=0);a.timeoutReSubcribeNumber++;L.Logger.info("[tk-sdk]subscribe timeout 15s--\x3estream-removed(initiative) , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));var d=TK.StreamEvent({type:"stream-removed",stream:a,message:{timeoutSubscribeReconnection:!0,timeoutReSubcribeNumber:a.timeoutReSubcribeNumber,source:"subscribe",
isNotRemote:!0}});h.dispatchEvent(d);h.subscribe(a,{timeoutSubscribeReconnection:!0})}else L.Logger.info("[tk-sdk]subscribe timeout 15s--\x3ereSubscribe number \x3e 3 , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),d=TK.StreamEvent({type:"stream-subscribe-fail",stream:a,message:{code:"subscribeTimeout",hasdata:!1,timeoutReSubcribeNumber:a.timeoutReSubcribeNumber,hasRemoteStream:void 0!==h.remoteStreams[a.getID()]}}),h.dispatchEvent(d),
c&&c(void 0,void 0);else L.Logger.info("[tk-sdk]subscribe timeout 15s--\x3eremoteStreams does not contain streams , not need afresh subscribe , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()))},1E3)},{timeoutSubscribeReconnection:!0})},15E3);b=b||{};if(!a||a.local||a.failed){var d="Error on subscribe";a?a.local?(L.Logger.warning("[tk-sdk]Cannot subscribe to local stream, you should subscribe to the remote version of your local stream"),
d="Local copy of stream"):a.failed&&(L.Logger.warning("[tk-sdk]Cannot subscribe to failed stream, you should wait a new stream-added event."),d="Failed stream"):(L.Logger.warning("[tk-sdk]Cannot subscribe to invalid stream",a),d="Invalid or undefined stream");c&&c(void 0,d)}else{if(a.hasVideo()||a.hasAudio()||a.hasScreen())a.hasVideo()||a.hasScreen()||(b.video=!1),a.hasAudio()||(b.audio=!1),b.maxVideoBW=b.maxVideoBW||E.defaultVideoBW,b.maxVideoBW>E.maxVideoBW&&(b.maxVideoBW=E.maxVideoBW),L.Logger.debug("[tk-sdk]Checking subscribe options for",
a.getID()),a.checkOptions(b),V("subscribe",{streamId:a.getID(),audio:b.audio,video:b.video,data:b.data,browser:TK.getBrowser(),createOffer:b.createOffer,metadata:b.metadata,slideShowMode:b.slideShowMode},void 0,function(d,e){clearTimeout(a._subscribeTimer);0!==d?(L.Logger.error("[tk-sdk]Error subscribing to stream ",e),L.Logger.info("[tk-sdk]stream-subscribe-fail , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),h.remoteStreams[a.getID()]?
3>a.subscribeReconnectionNumber?(void 0===a.subscribeReconnectionNumber&&(a.subscribeReconnectionNumber=0),h.unsubscribe(a,function(b){setTimeout(function(){if(h.remoteStreams[a.getID()]){a.subscribeReconnectionNumber++;L.Logger.info("[tk-sdk]stream-subscribe-fail--\x3estream-removed(initiative) , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));var b=TK.StreamEvent({type:"stream-removed",stream:a,message:{subscribeReconnection:!0,
subscribeReconnectionNumber:a.subscribeReconnectionNumber,source:"subscribe",isNotRemote:!0}});h.dispatchEvent(b);h.subscribe(a,{subscribeReconnection:!0})}else L.Logger.info("[tk-sdk]stream-subscribe-fail(subscribe-fail):  failed --\x3eremoteStreams does not contain streams , not need afresh subscribe , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()))},1E3)},{subscribeReconnection:!0})):(h.unsubscribe(a),d=TK.StreamEvent({type:"stream-subscribe-fail",
error:e,message:{code:"subscribeFail",stream:a,hasdata:!1,subscribeReconnectionNumber:a.subscribeReconnectionNumber,hasRemoteStream:void 0!==h.remoteStreams[a.getID()]}}),h.dispatchEvent(d),c&&c(void 0,e)):L.Logger.info("[tk-sdk]stream-subscribe-fail:remoteStreams does not contain streams , not need afresh subscribe , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()))):(L.Logger.debug("[tk-sdk]Subscriber added"),a.subscribeReconnectionNumber=
0,a.timeoutReSubcribeNumber=0,b.reconnection||(delete a.isCompleted,a.reconnectionNumber=0),a.pc=TK.Connection({callback:function(b){L.Logger.debug("[tk-sdk]Sending message ",b);b=S(b);var c="chrome-stable";a.pc&&a.pc.browser&&(c=a.pc.browser);V("signaling_message",{streamId:a.getID(),msg:b,browser:c},void 0,function(){})},nop2p:!0,audio:b.audio,video:b.video,screen:!1,maxAudioBW:E.maxAudioBW,maxVideoBW:a.hasScreen()?E.maxScreenBW:E.maxVideoBW,limitMaxAudioBW:E.maxAudioBW,limitMaxVideoBW:a.hasScreen()?
E.maxScreenBW:E.maxVideoBW,iceServers:h.iceServers,cnnId:a.extensionId},a.isTkNative),a.pc.onaddstream=function(b){h.remoteStreams[a.getID()]?(L.Logger.debug("[tk-sdk]Stream subscribed"),a.stream=b.stream,aa&&h.rtcStatsrObserver(a),b=TK.StreamEvent({type:"stream-subscribed",stream:a}),L.Logger.info("[tk-sdk]stream-subscribed , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),h.dispatchEvent(b)):L.Logger.info("[tk-sdk]stream-subscribe:remoteStreams does not contain streams ,stream  subscribe  information does not need to be passed to the interface layer , stream id:"+
a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()))},a.pc.oniceconnectionstatechange=function(b){L.Logger.info("[tk-sdk]subscribe ice state:"+b+" , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));"failed"===b&&0!==h.state&&a&&!a.failed&&(a.failed=!0,L.Logger.warning("[tk-sdk]Subscribing stream",a.getID(),"has failed after successful ICE checks , stream id:"+a.getID()+" , extensionId is "+
a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),g(a,b,"subscribe"))},a.pc.createOffer(!0),c&&c(!0))});else if(a.hasData()&&!1!==b.data)V("subscribe",{streamId:a.getID(),data:b.data,metadata:b.metadata},void 0,function(b,d){0!==b?(L.Logger.error("[tk-sdk]Error subscribing to stream ",d),b=TK.StreamEvent({type:"stream-subscribe-fail",stream:a,message:{error:d,hasdata:!0}}),L.Logger.info("[tk-sdk]stream-subscribe-fail , stream id:"+a.getID()+" , extensionId is "+a.extensionId+
", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),h.dispatchEvent(b),c&&c(void 0,d)):h.remoteStreams[a.getID()]?(L.Logger.debug("[tk-sdk]Stream subscribed"),d=TK.StreamEvent({type:"stream-subscribed",stream:a}),L.Logger.info("[tk-sdk]stream-subscribed , stream id:"+a.getID()+" , hasData is "+a.hasData()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),h.dispatchEvent(d),c&&c(!0)):(L.Logger.info("[tk-sdk]stream-subscribe:remoteStreams does not contain streams ,stream  subscribe  information does not need to be passed to the interface layer , stream id:"+
a.getID()+" , hasData is "+a.hasData()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),c&&c(!1))});else{L.Logger.warning("[tk-sdk]There's nothing to subscribe to");c&&c(void 0,"Nothing to subscribe to");return}L.Logger.debug("[tk-sdk]Subscribing to: "+a.getID());return 0}};h.unsubscribe=function(a,b,c){void 0!==h.socket&&a&&!a.local&&(c=c||{},O("unsubscribe",a.getID(),function(d,e){0!==d?(d=TK.StreamEvent({type:"stream-unsubscribe-fail",stream:a,message:{error:e}}),
L.Logger.info("[tk-sdk]stream-unsubscribe-fail , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),h.dispatchEvent(d),b&&b(void 0,e)):(c.reconnection||(delete a.isCompleted,a.reconnectionNumber=0),a.failed&&delete a.failed,ja(a),b&&b(!0))},function(){L.Logger.error("[tk-sdk]Error calling unsubscribe.")}))};h.getStreamStats=function(a,b){if(!h.socket)return"Error getting stats - no socket";if(!a)return"Error getting stats - no stream";
O("getStreamStats",a.getID(),function(a){a&&b(a)})};h.getStreamsByAttribute=function(a,b){var c=[],d;for(d in h.remoteStreams)if(h.remoteStreams.hasOwnProperty(d)){var e=h.remoteStreams[d];void 0!==e.getAttributes()&&void 0!==e.getAttributes()[a]&&e.getAttributes()[a]===b&&c.push(e)}return c};h.deleteStream=function(a){void 0!==a.stream&&(a.hide(),a.pc&&a.pc.removeStream(a.stream),a.local&&a.stream.stop(),delete a.stream)};h.addStream=function(a){a||L.Logger.warning("[tk-sdk]not stream to addStream");
a.pc.addStream(a)};h.seekPlayback=function(a){if(D)try{a=Number(a),h.socket.emit("seekPlayback",a)}catch(Z){L.Logger.error("[tk-sdk]The seek posttion must be a number, in milliseconds !")}else L.Logger.warning("[tk-sdk]No playback environment!")};h.pausePlayback=function(){D?h.socket.emit("pausePlayback"):L.Logger.warning("[tk-sdk]No playback environment!")};h.playPlayback=function(){D?h.socket.emit("Playback"):L.Logger.warning("[tk-sdk]No playback environment!")};h.playbackClearAll=function(){D?
(void 0!=z&&(u(N),n(z)),null!=q&&(q.publishstate=TK.PUBLISH_STATE_NONE)):L.Logger.error("[tk-sdk]No playback environment, no execution playbackClearAll!")};h.initPlaybackInfo=function(b,c,d,e){d&&"object"===typeof d?d.recordfilepath?(a(b,c),D=!0,ma=TK.AVMgr,ua=d.recordfilepath,h.setIsGetFileList(!1),aa=!1,L.Logger.info("[tk-sdk]initPlaybackInfo to checkroom start!"),h.checkroom(b,c,d,e)):L.Logger.error("[tk-sdk]params.recordfilepath is required !"):L.Logger.error("[tk-sdk]params is required ,params type is json !")};
h.updateProtocol=function(a){M=a;Aa=/http:/g.test(a)?81:8080};h.checkroom=function(d,e,g,f,k,l){TK.isTkNative&&tknative.addEventListener("message",Na,!1);p(1);D||(b(d),a(d,e),c());void 0!==J&&void 0!==H||D||h.requestServerList(x,I,void 0,{checkroom:!0});d=M+x+":"+I+"/ClientAPI/checkroom?ts\x3d"+(new Date).getTime();e=!0;l="";if("string"===typeof g)l=g,D&&(l+="\x26playback\x3dtrue");else{D&&(g.playback=!0);for(var m in g)e?e=!1:l+="\x26",l=l+m+"\x3d"+g[m]}L.Logger.debug("[tk-sdk]Going to checkroom",
l);L.Logger.info("[tk-sdk]call checkroom start!");var r=t("POST",d,!0,l,function(){L.Logger.debug("[tk-sdk]Http status ",r.readyState);if(4==r.readyState)if(200==r.status){var a=L.Utils.toJsonParse(r.responseText);L.Logger.debug("[tk-sdk]checkroom resp \x3d ",a);var b={},c=a.result;if(0==c){D&&(a.nickname="playback",a.roomrole=-1,a.thirdid=Ia()+":playback");var d=a.room;var e=a.pullinfo;if(void 0===d.serial)c=-1;else{d.roomtype=Number(d.roomtype);d.maxvideo=parseInt(d.maxvideo);a.roomrole=Number(a.roomrole);
var g={},l={};if(e&&e.data&&e.data.pullConfigureList){var h=e.data.pullConfigureList;for(n in h){var m=h[n];g[m.pullProtocol]=m.pullUrlList}}if(e&&e.data&&e.data.pushConfigureInfo)for(n in e=e.data.pushConfigureInfo,e)h=e[n],l[h.pushProtocol]=h.pushUrl;d.pullConfigure=g;d.pushConfigure=l;Y=d;D?(W=d.serial+"_"+q.id)&&-1===W.indexOf(":playback")&&(W+=":playback"):W=d.serial;Fa=d.roomname;xa=d.roomtype;ba=d.maxvideo;b.properties={};b.properties.role=a.roomrole;b.properties.nickname=a.nickname;g=a.thirdid;
b.id=void 0!==g&&"0"!=g&&""!=g?g:k?k:Ia();q=TK.RoomUser(b);if(!D){g=xa;l=q.role;var n=d.videotype;d=d.videoframerate;g=Number(g);l=Number(l);n=Number(n);d=Number(d);0<g&&2<=l&&(n=Math.max(0,Math.min(1,n-1)));X=Ha[n][0];ha=Ha[n][1];Q=10>d?10:30<d?30:d;la=176>=X?20>Q?128:192:320>=X?20>Q?256:384:640>=X?20>Q?384:512:1280>=X?15>Q?1024:15<=Q&&20>=Q?1280:1536:15>Q?1280:15<=Q&&20>=Q?1536:2048;d={room_video_width:X,room_video_height:ha,room_video_fps:Q};ma=TK.AVMgr;ma.setAVMgrProperty(d);L.Logger.info("[tk-sdk]video config[_room_video_width * _room_video_height  , _room_video_fps , _room_video_maxbps]:"+
X+"*"+ha+", "+Q+", "+la);TK.isTkNative&&tknative.postMessage({command:"initNative",localId:q.id.toString(),width:Number(X),height:Number(ha),fps:Number(Q),roomInfo:r.responseText,webAddr:x.toString(),webPort:I.toString()});3===a.roomrole&&(Ca=!1)}L.Logger.info("[tk-sdk]"+(D?"initPlaybackInfo to checkroom finshed--\x3e":"")+"_room_max_videocount:"+ba,"my id:"+q.id,"room id:"+W,"room properties chairmancontrol is:"+(Y.chairmancontrol?window.__TkSdkBuild__?L.Utils.encrypt(Y.chairmancontrol):Y.chairmancontrol:
void 0))}}else L.Logger.warning("[tk-sdk]checkroom failure code is "+c);L.Logger.info("[tk-sdk]checkroom finshed!");f(c,b,a)}else L.Logger.error("[tk-sdk]checkroom fail[readyState-status]:",r.readyState,r.status),f(3,r.responseText)})};h.getAVMgr=function(){return ma};h.controlMedia=function(a,b){h.socket.emit("controlmedia",a,b)};h.changeLocalDeviceToLocalstream=function(a,b,c){h.getAVMgr().changeLocalDeviceToLocalstream(function(a){if(v){v.hasVideo()!==q.hasvideo&&v.changeVideo(q.hasvideo);v.hasAudio()!==
q.hasaudio&&v.changeAudio(q.hasaudio);if(v.stream){for(var b in a)/^customdata_/g.test(b)&&(v.stream[b]=a[b]);var c=v.stream.getTracks();for(b=0;b<c.length;b++){var e=c[b];v.stream.removeTrack(e)}a=a.getTracks();for(b=0;b<a.length;b++)e=a[b],v.stream.addTrack(e)}else v.stream=a;v.player&&v.player.changeMediaStreamUrl(v.stream);if(fa&&q&&void 0!=q.id&&z[q.id]){var g=q.publishstate;g>TK.PUBLISH_STATE_NONE&&h.unpublish(v,function(a,b){k(!0);m(!0);d(q.publishstate);g>TK.PUBLISH_STATE_NONE&&h.publish(v)})}}else L.Logger.error("[tk-sdk]changeLocalDeviceToLocalstream _default_stream is not exist!")},
a,b,c)};h.getLottyerDraw=function(a,b){var c=M+x+":"+I+"/ClientAPI/lotterydraw?ts\x3d"+(new Date).getTime();return $.ajax({url:c,dataType:"json",type:"POST",data:a,async:!1}).done(function(a){L.Logger.debug("[tk-sdk]getLottyerDraw resp \x3d ",L.Utils.toJsonStringify(a));b&&"function"===typeof b&&b(a.result,a)}).fail(function(a,c,d){L.Logger.error("[tk-sdk]getLottyerDraw fail[ jqXHR , textStatus , errorThrown ]:",a,c,d);b(3,void 0)})};h.getLottyerDrawNum=function(a,b){var c=M+x+":"+I+"/ClientAPI/lotterydrawnum?ts\x3d"+
(new Date).getTime();return $.ajax({url:c,dataType:"json",type:"POST",data:{serial:a},async:!1}).done(function(a){L.Logger.debug("[tk-sdk]getLottyerDrawNum resp \x3d ",L.Utils.toJsonStringify(a));b&&"function"===typeof b&&b(a.result,a)}).fail(function(a,c,d){L.Logger.error("[tk-sdk]getLottyerDrawNum fail[ jqXHR , textStatus , errorThrown ]:",a,c,d);b(3,void 0)})};h.getLottyerDrawAll=function(a,b){var c=M+x+":"+I+"/ClientAPI/lotterydrawall?ts\x3d"+(new Date).getTime();if(a)return $.ajax({url:c,dataType:"json",
type:"POST",data:{serial:a},async:!1}).done(function(a){L.Logger.debug("[tk-sdk]getLottyerDrawAll resp \x3d ",L.Utils.toJsonStringify(a));b&&"function"===typeof b&&b(a.result,a)}).fail(function(a,c,d){L.Logger.error("[tk-sdk]getLottyerDrawAll fail[ jqXHR , textStatus , errorThrown ]:",a,c,d);b(3,void 0)});L.Logger.error("[tk-sdk]getLottyerDrawAll serial is required!")};h.rollCallAdd=function(a,b){var c=M+x+":"+I+"/ClientAPI/rollcalladd?ts\x3d"+(new Date).getTime();return $.ajax({url:c,dataType:"json",
type:"POST",data:a,async:!1}).done(function(a){L.Logger.debug("[tk-sdk]getRollCallAdd resp \x3d ",L.Utils.toJsonStringify(a));b&&"function"===typeof b&&b(a.result,a)}).fail(function(a,c,d){L.Logger.error("[tk-sdk]getRollCallAdd fail[ jqXHR , textStatus , errorThrown ]:",a,c,d);b(3,void 0)})};h.getRollCallAll=function(a,b){var c=M+x+":"+I+"/ClientAPI/rollcallall?ts\x3d"+(new Date).getTime();if(a)return $.ajax({url:c,dataType:"json",type:"POST",data:{serial:a},async:!1}).done(function(a){L.Logger.debug("[tk-sdk]getRollCallAll resp \x3d ",
L.Utils.toJsonStringify(a));b&&"function"===typeof b&&b(a.result,a)}).fail(function(a,c,d){L.Logger.error("[tk-sdk]getRollCallAll fail[ jqXHR , textStatus , errorThrown ]:",a,c,d);b(3,void 0)});L.Logger.error("[tk-sdk]getRollCallAll serial is required!")};h.vote=function(a,b,c){b=M+x+":"+I+("list"===b?"/ClientAPI/voteall":"create"===b?"/ClientAPI/voteadd":"result"===b?"/ClientAPI/voteresultadd":"/ClientAPI/voteup ")+"?ts\x3d"+(new Date).getTime();return $.ajax({url:b,dataType:"json",type:"POST",data:a,
async:!1}).done(function(a){L.Logger.debug("[tk-sdk]getVoteList resp \x3d ",L.Utils.toJsonStringify(a));c&&"function"===typeof c&&c(a.result,a)}).fail(function(a,b,d){L.Logger.error("[tk-sdk]getVoteList fail[ jqXHR , textStatus , errorThrown ]:",a,b,d);c(3,void 0)})};h.getOnlineNum=function(a,b,c){var d=M+x+":"+I+"/ClientAPI/getonlinenum?ts\x3d"+(new Date).getTime();if(a){if(b)return $.ajax({url:d,dataType:"json",type:"POST",data:{companyid:a,serial:b},async:!1}).done(function(a){L.Logger.debug("[tk-sdk]getOnlineNum resp \x3d ",
L.Utils.toJsonStringify(a));c&&"function"===typeof c&&c(a.result,a)}).fail(function(a,b,d){L.Logger.error("[tk-sdk]getOnlineNum fail[ jqXHR , textStatus , errorThrown ]:",a,b,d);c(3,void 0)});L.Logger.error("[tk-sdk]getOnlineNum serial is required!")}else L.Logger.error("[tk-sdk]getOnlineNum companyid is required!")};h.getUploadFileParams=function(a,b,c){return{serial:Y.serial,userid:q.id,sender:q.nickname,conversion:1,isconversiondone:0,writedb:(void 0!==c?c:1)?1:0,fileoldname:a,fieltype:b,alluser:1}};
h.docUploadFileDataInfo=function(a,b){var c=M+x+":"+I+"/ClientAPI/docupdateinfo?ts\x3d"+(new Date).getTime();if(a)return $.ajax({url:c,dataType:"json",type:"POST",data:{fileid:a},async:!1}).done(function(a){L.Logger.debug("[tk-sdk]docUploadFileDataInfo resp \x3d ",L.Utils.toJsonStringify(a));b&&"function"===typeof b&&b(a.status,a)}).fail(function(a,c,d){L.Logger.error("[tk-sdk]docUploadFileDataInfo fail[ jqXHR , textStatus , errorThrown ]:",a,c,d);b(3,void 0)});L.Logger.error("[tk-sdk]docUploadFileDataInfo fileId is required!")};
h.uploadFile=function(a,b,c){return U(a,b,c)};h.deleteFile=function(a,b){R(a,b)};h.setIsGetRtcStatsrObserver=function(a){aa=a};h.setRtcStatsrObserverTimer=function(a){ya=a};h.stopIntervalRtcStatsrObserver=function(){clearInterval(h._rtcStatsrObserverTimer);h._rtcStatsrObserverTimer=null};h.startIntervalRtcStatsrObserver=function(){clearInterval(h._rtcStatsrObserverTimer);h._rtcStatsrObserverTimer=setInterval(function(){for(var a in h.remoteStreams){var b=h.remoteStreams[a];b.extensionId===q.id&&h.localStreams[b.getID()]&&
(b=v);b&&b.pc&&h.rtcStatsrObserver(b)}},ya)};h.stopIntervalRtcStatsrObserverByStream=function(a){a?(clearInterval(a.rtcStatsrObserverTimer),a.rtcStatsrObserverTimer=null):L.Logger.error("[tk-sdk]stream is not exist!")};h.startIntervalRtcStatsrObserverByStream=function(a,b){b=b||ya;a?(clearInterval(a.rtcStatsrObserverTimer),a.rtcStatsrObserverTimer=setInterval(function(){a&&a.pc&&h.rtcStatsrObserver(a)},b)):L.Logger.error("[tk-sdk]stream is not exist!")};h.rtcStatsrObserver=function(a){if(a)if(a.extensionId===
q.id&&h.localStreams[a.getID()]&&(a=v),!a.pc)L.Logger.error("[tk-sdk]stream.pc is not exist , stream id and extensionId:"+a.getID()+","+a.extensionId+"!");else{if(a&&a.pc)if(!0===a.pc.isNative){L.Logger.debug("[tk-sdk]pc.getStats has not been implemented currently!");clearTimeout(h._rtcStatsrObserverTimer);clearTimeout(a.rtcStatsrObserverTimer);h._rtcStatsrObserverTimer=null;a.rtcStatsrObserverTimer=null;var b=TK.StreamEvent({type:"stream-rtcStats-failed",stream:a,message:{error:"[tk_client]pc.getStats has not been implemented currently!",
code:L.Constant.getStats.nativeFailure,isNative:a.pc.isNative}});h.dispatchEvent(b)}else if(a.pc.getStats)try{a.pc.getStats(function(b,c){void 0===c||-1!==c&&-2!==c&&-3!==c?(b=Ja(a,b))?(a.networkStatus=b,b=TK.StreamEvent({type:"stream-rtcStats",stream:a,message:{networkStatus:b}},!1),h.dispatchEvent(b,!1)):h.rtcStatsrObserver(a):(L.Logger.error("[tk-sdk]pc.getStats -\x3e getStats not exist!"),clearTimeout(a.rtcStatsrObserverTimer),a.rtcStatsrObserverTimer=null,b=TK.StreamEvent({type:"stream-rtcStats-failed",
stream:a,message:{error:"pc.getStats -\x3e getStats not exist!",code:-1===c?L.Constant.getStats.peerConnectionNotGetStats:-2===c?L.Constant.getStats.getStatsFailure:L.Constant.getStats.getStatsError,isNative:a.pc.isNative}}),h.dispatchEvent(b))})}catch(Ka){L.Logger.error("[tk-sdk]pc.getStats error:",Ka)}else L.Logger.error("[tk-sdk]pc.getStats is not exist!"),clearTimeout(a.rtcStatsrObserverTimer),a.rtcStatsrObserverTimer=null,b=TK.StreamEvent({type:"stream-rtcStats-failed",stream:a,message:{error:"pc.getStats is not exist!",
code:L.Constant.getStats.pcNotGetStats,isNative:a.pc.isNative}}),h.dispatchEvent(b)}else L.Logger.error("[tk-sdk]stream is not exist!")};h.initBroadcast=function(a,b,c,d,e){a?(b||(b=10),c||(c=3),d&&e?tknative.postMessage({command:"initBroadcast",url:a.toString(),fps:Number(b),key_sec:Number(c),width:Number(d),height:Number(e)}):L.Logger.error("[tk-sdk]argument width or height of initBroadcast function not exist!")):L.Logger.error("[tk-sdk]argument url of initBroadcast function not exist!")};h.uninitBroadcast=
function(){tknative.postMessage({command:"uninitBroadcast"})};h.startBroadcast=function(a){a?tknative.postMessage({command:"startBroadcast",streamId:a}):L.Logger.error("[tk-sdk]argument extensionId of startBroadcast function not exist!")};h.stopBroadcast=function(){tknative.postMessage({command:"stopBroadcast"})};h.addOndevicechange=function(){if(!D){var a=function(a){var b=[],c;for(c in arguments)b.push(arguments[c]);K(a)};TK&&TK.AVMgr&&TK.AVMgr.addOndevicechange?TK.AVMgr.addOndevicechange(a)&&h.dispatchEvent({type:"add_device_change_listener"}):
L.Logger.error("TK.AVMgr no initialization is done!")}};h.removeOndevicechange=function(){TK&&TK.AVMgr&&TK.AVMgr.removeOndevicechange?TK.AVMgr.removeOndevicechange()&&h.dispatchEvent({type:"remove_device_change_listener"}):L.Logger.error("TK.AVMgr no initialization is done!")};h.startRecordStream=function(a,b,c){if(6!=B)return 2;if(void 0===a||void 0===a.getID())return 4;var d={};d.streamId=a.getID();d.convert=b.convert||0;O("startRecordStream",d,function(a,b){L.Logger.debug("startRecordStream",a,
b);c(a,b)});return 0};h.stopRecordStream=function(a,b){if(6!=B)return 2;if(void 0===a||void 0===a.getID())return 4;var c={};c.streamId=a.id;O("stopRecordStream",c,function(a){L.Logger.debug("stopRecordStream",a);b(a)});return 0};h.getRoomMaxVideocount=function(){return ba};h.updateRoomMaxVideocount=function(a){ba=a;L.Logger.info("[tk-sdk]updateRoomMaxVideocount --\x3e update room_max_videocount to "+ba)};h.requestServerList=function(a,c,d,g){if(Ga)if(h.webInterfaceGetservering||h.webInterfaceGetserverNameing)L.Logger.info("[tk-sdk]requestServerList  interface is being requested and cannot be executed again requestServerList"),
d&&"function"===typeof d&&d(J,-2);else{if(void 0!==J&&void 0!==H)return d&&"function"===typeof d&&d(J,-1),J;if(void 0===a||null===a||void 0===c||null===c)L.Logger.error("[tk-sdk]first requestServerList web_host or web_port is not exist!");else{Da=a;Ea=c;L.Logger.debug("[tk-sdk]Going to requestServerList");var f=!1,k=!1,l=function(){if(f&&k){e(J,H);L.Logger.info("[tk-sdk]requestServerList finshed , serverName is "+H+" , serverlist info : ",window.__TkSdkBuild__?L.Utils.encrypt(L.Utils.toJsonStringify(J)):
L.Utils.toJsonStringify(J));var a=TK.RoomEvent({type:"room-serverlist",message:{serverList:J,serverName:H}});h.dispatchEvent(a);d&&"function"===typeof d&&d(J,0)}};h.webInterfaceGetservering=!0;h.webInterfaceGetserverNameing=!0;P(a,c,function(a,b){h.webInterfaceGetservering=!1;f=!0;l()});(function(a,c){b(a);c&&"function"===typeof c&&c()})(a,function(){h.webInterfaceGetserverNameing=!1;k=!0;l()})}}else d&&"function"===typeof d&&d(void 0,-2)};h.getServerName=function(){return H};h.switchServerByName=
function(a){if(void 0===J)return L.Logger.error("[tk-sdk]selectServerByName --\x3e service list not request  , list is not exist!"),!1;if(!J[a])return L.Logger.error("[tk-sdk]selectServerByName --\x3e the service list  has no option name  "+a+"!"),!1;void 0!==x&&void 0!==I?0<na?(H=a,L.Utils.localStorage.setItem("tkLocalstorageServerName",H),e(J,H),c(),ia!==x?f({source:"select service reconnect"}):L.Logger.info("[tk-sdk]web request host is not change , not need reconnect service!")):L.Logger.error("[tk-sdk]selectServerByName--\x3eThe room has no connection success and cannot perform a reswitch server! "):
L.Logger.error("[tk-sdk]selectServerByName--\x3eweb request host and port is not exist , cannot perform a reswitch server! ");return!0};h.selectServerToCheckroom=function(b,d,g,f,k){b=b||H;void 0===J?(L.Logger.error("[tk-sdk]selectServerToCheckroom --\x3eservice list not request  , list is not exist!"),g&&"function"===typeof g&&g(-2,void 0,void 0)):J[b]?(H=b,L.Utils.localStorage.setItem("tkLocalstorageServerName",H),e(J,H),a(Da,Ea),void 0!==x&&void 0!==I?(c(),h.checkroom(x,I,d,g,f,k)):L.Logger.error("[tk-sdk]web request host and port is not exist , cannot call checkroom ! ")):
(L.Logger.error("[tk-sdk]selectServerToCheckroom --\x3ethe service list  has no option name  "+b+"!"),g&&"function"===typeof g&&g(-2,void 0,void 0))};h.getWebAddressInfo=function(){return{host:x,port:I,protocol:M}};h.updateRequestServerListPermission=function(a){Ga=a};h.stopStreamTracksFromDefaultStream=function(){v&&v.stream?TK.AVMgr.stopStreamTracks?TK.AVMgr.stopStreamTracks(v.stream):L.Logger.warning("[tk-sdk] TK.AVMgr.stopStreamTracks is not exist , inexecutable stopStreamTracksFromDefaultStream"):
L.Logger.warning("[tk-sdk] defaultstream.stream is not exist , inexecutable stopStreamTracksFromDefaultStream")};h.getValidWindowList=function(a,b){if(void 0===a||null===a||"function"!==typeof b)L.Logger.error("[tk-sdk] getValidWindowList function got wrong arguments");else{var c=h.getNativeCallSeq();G[c]=b;tknative.postMessage({command:"getValidWindowList",type:Number(a),seq:c})}};h.updateWindowSource=function(a){a.id||(a.id=0);a.x||(a.x=0);a.y||(a.y=0);a.width||(a.width=0);a.height||(a.height=0);
a.mixMic||(a.mixMic=!1);a.mixSpk||(a.mixSpk=!1);a.type||(a.type=0);tknative.postMessage({command:"updateWindowSource",id:Number(a.id),left:Number(a.x),top:Number(a.y),width:Number(a.width),height:Number(a.height),mixMic:a.mixMic,mixSpk:a.mixSpk,type:Number(a.type)})};h.getMonitorCount=function(a){if(TK.isTkNative)if("function"!==typeof a)L.Logger.error("[tk-sdk] getMonitorCount function got wrong arguments");else{var b=h.getNativeCallSeq();G[b]=a;tknative.postMessage({command:"getMonitorCount",seq:b})}};
h.enableViceMonitor=function(){TK.isTkNative&&(ta=!0,tknative.postMessage({command:"enableViceMonitor"}))};h.takeSnapshot=function(a,b,c,d){TK.isTkNative&&(b&&c?"function"!==typeof d?L.Logger.error("[tk-sdk] takeSnapshot function got wrong arguments"):(G[c]=d,tknative.postMessage({command:"takeSnapshot",needMin:a,fileName:b,requestId:c})):L.Logger.error("[tk-sdk] takeSnapshot function got wrong arguments"))};h.startLocalRecord=function(a,b){if(TK.isTkNative)if(a&&"function"===typeof b){var c=h.getNativeCallSeq();
G[c]=b;tknative.postMessage({command:"startLocalRecord",args:a,seq:c})}else L.Logger.error("[tk-sdk] startRecordScreen function got wrong arguments")};h.stopLocalRecord=function(a){TK.isTkNative&&tknative.postMessage({command:"stopLocalRecord",args:a})};h.pauseLocalRecord=function(a,b){if(TK.isTkNative)if(a&&"function"===typeof b){var c=h.getNativeCallSeq();G[c]=b;tknative.postMessage({command:"pauseLocalRecord",args:a,seq:c})}else L.Logger.error("[tk-sdk] pauseLocalRecord function got wrong arguments")};
h.shutdownNativeClient=function(){TK.isTkNative&&tknative.postMessage({command:"shutdownNativeClient"})};h.getOpenFileName=function(a,b){if(TK.isTkNative)if(a&&"function"===typeof b){var c=h.getNativeCallSeq();G[c]=b;tknative.postMessage({command:"getOpenFileName",args:a,seq:c})}else L.Logger.error("[tk-sdk] getOpenFileName function got wrong arguments")};h.getSaveFileName=function(a,b){if(TK.isTkNative)if(a&&"function"===typeof b){var c=h.getNativeCallSeq();G[c]=b;tknative.postMessage({command:"getSaveFileName",
args:a,seq:c})}else L.Logger.error("[tk-sdk] getSaveFileName function got wrong arguments")};h.getMediaPlayPos=function(a){if(TK.isTkNative)if("function"!==typeof a)L.Logger.error("[tk-sdk] getMediaPlayPos function got wrong arguments");else{var b=h.getNativeCallSeq();G[b]=a;tknative.postMessage({command:"getMediaPlayPos",seq:b})}};h.pauseMediaFile=function(a){TK.isTkNative&&(pause?tknative.postMessage({command:"pauseMediaFile",pause:a}):L.Logger.error("[tk-sdk] pauseMediaFile function got wrong arguments"))};
h.seekMediaFile=function(a){TK.isTkNative&&(a?tknative.postMessage({command:"seekMediaFile",pos:a}):L.Logger.error("[tk-sdk] seekMediaFile function got wrong arguments"))};TK&&TK.coreEventController&&(TK.coreEventController.addEventListener("getUserMedia_success",function(a){h.dispatchEvent(a)}),TK.coreEventController.addEventListener("getUserMedia_failure",function(a){h.dispatchEvent(a)}),TK.coreEventController.addEventListener("getUserMedia_failure_reGetOnlyAudioStream",function(a){h.dispatchEvent(a)}));
var Na=function(a){var b=a.data.name;if("onValidWindowList"===b)b=a.data.seq,void 0!==b&&"function"===typeof G[b]&&(G[b](a.data.validWindows),delete G[b]);else if("onLog"===b)b=a.data.level,a=a.data.log,0===b&&L.Logger.debug(a),1===b&&L.Logger.info(a),2===b&&L.Logger.warning(a),3===b&&L.Logger.error(a);else if("onMonitorCount"===b){var c=a.data.count;b=a.data.seq;void 0!==b&&"function"===typeof G[b]&&(G[b](c),delete G[b])}else if("onTakSnapshot"===b){b=a.data.action;c=a.data.requestId;var d=a.data.total,
e=a.data.now,g=a.data.code;"function"===typeof G[c]&&(a=L.Utils.toJsonParse(a.data.result),G[c](b,c,d,e,g,a),"result"===b&&delete G[c])}else"onLocalRecord"===b?(c=a.data.arg,b=a.data.seq,"function"===typeof G[b]&&(G[b](c),delete G[b])):"onGetOpenOrSaveFileName"===b?(c=a.data.arg,b=a.data.seq,"function"===typeof G[b]&&(G[b](c),delete G[b])):"onGetMediaPlayPos"===b&&(c=a.data.arg,b=a.data.seq,"function"===typeof G[b]&&(G[b](c),delete G[b]))};return h};TK=TK||{};TK.PUBLISH_STATE_NONE=0;TK.PUBLISH_STATE_AUDIOONLY=1;TK.PUBLISH_STATE_VIDEOONLY=2;TK.PUBLISH_STATE_BOTH=3;TK.PUBLISH_STATE_MUTEALL=4;TK.RoomUser=function(b){if(void 0==b||void 0===b.properties)L.Logger.warning("[tk-sdk]Invalidate user info",a,f);else{var a=b.id,f=b.properties;L.Logger.debug("[tk-sdk]RoomUser",a,f);b={};b.id=a;b.watchStatus=0;for(var e in f)"id"!=e&&"watchStatus"!=e&&(b[e]=f[e]);b.publishstate=b.publishstate||TK.PUBLISH_STATE_NONE;return b}};var L=L||{};TK=TK||{};
L.Logger=function(b){var a="",f=!1;var e=function(a,d){try{switch(d){case b.Logger.DEBUG:f?console.warn.apply(console,a):console.debug.apply(console,a);break;case b.Logger.TRACE:console.trace.apply(console,a);break;case b.Logger.INFO:f?console.warn.apply(console,a):console.info.apply(console,a);break;case b.Logger.WARNING:console.warn.apply(console,a);break;case b.Logger.ERROR:console.error.apply(console,a);break;case b.Logger.NONE:console.warn("log level is none!");break;default:f?console.warn.apply(console,
a):console.log.apply(console,a)}}catch(k){console.log.apply(console,a)}};return{DEBUG:0,TRACE:1,INFO:2,WARNING:3,ERROR:4,NONE:5,setLogDevelopment:function(a){f=a},enableLogPanel:function(){b.Logger.panel=document.createElement("textarea");b.Logger.panel.setAttribute("id","licode-logs");b.Logger.panel.setAttribute("style","width: 100%; height: 100%; display: none");b.Logger.panel.setAttribute("rows",20);b.Logger.panel.setAttribute("cols",20);b.Logger.panel.setAttribute("readOnly",!0);document.body.appendChild(b.Logger.panel)},
setLogLevel:function(a){a>b.Logger.NONE?a=b.Logger.NONE:a<b.Logger.DEBUG&&(a=b.Logger.DEBUG);b.Logger.logLevel=a},setOutputFunction:function(a){e=a},setLogPrefix:function(b){a=b},print:function(c){var d=a;if(!(c<b.Logger.logLevel)){c===b.Logger.DEBUG?d=d+"DEBUG("+(new Date).toLocaleString()+")":c===b.Logger.TRACE?d=d+"TRACE("+(new Date).toLocaleString()+")":c===b.Logger.INFO?d=d+"INFO("+(new Date).toLocaleString()+")":c===b.Logger.WARNING?d=d+"WARNING("+(new Date).toLocaleString()+")":c===b.Logger.ERROR&&
(d=d+"ERROR("+(new Date).toLocaleString()+")");d+=":";for(var f=[],m=0;m<arguments.length;m++)f[m]=arguments[m];f=f.slice(1);f=[d].concat(f);if(void 0!==b.Logger.panel){d="";for(m=0;m<f.length;m++)d+=f[m];b.Logger.panel.value=b.Logger.panel.value+"\n"+d}else e.apply(b.Logger,[f,c])}},debug:function(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];b.Logger.print.apply(b.Logger,[b.Logger.DEBUG].concat(a))},trace:function(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];b.Logger.print.apply(b.Logger,
[b.Logger.TRACE].concat(a))},info:function(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];b.Logger.print.apply(b.Logger,[b.Logger.INFO].concat(a))},warning:function(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];b.Logger.print.apply(b.Logger,[b.Logger.WARNING].concat(a))},error:function(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];b.Logger.print.apply(b.Logger,[b.Logger.ERROR].concat(a))}}}(L);
TK.tkLogPrintConfig=function(b,a,f){a=a||{};b=b||{};f=f||{};var e=void 0!=a.logLevel?a.logLevel:0;b=void 0!=b.debug?b.debug:!0;f=void 0!=f.webrtcLogDebug?f.webrtcLogDebug:!0;L.Logger.setLogDevelopment(void 0!=a.development?a.development:!0);L.Logger.setLogLevel(e);L.Utils.localStorage&&L.Utils.localStorage.setItem("debug",b?"*":"none");window.webrtcLogDebug=f};L=L||{};
L.Base64=function(){var b,a,f;var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");var c=[];for(f=0;f<e.length;f+=1)c[e[f]]=f;var d=function(c){b=c;a=0};var k=function(){if(!b||a>=b.length)return-1;var c=b.charCodeAt(a)&255;a+=1;return c};var m=function(){if(!b)return-1;for(;;){if(a>=b.length)return-1;var d=b.charAt(a);a+=1;if(c[d])return c[d];if("A"===d)return 0}};var g=function(a){a=a.toString(16);1===a.length&&(a="0"+a);return unescape("%"+a)};return{encodeBase64:function(a){var b;d(a);
a="";var c=Array(3);var g=0;for(b=!1;!b&&-1!==(c[0]=k());)c[1]=k(),c[2]=k(),a+=e[c[0]>>2],-1!==c[1]?(a+=e[c[0]<<4&48|c[1]>>4],-1!==c[2]?(a+=e[c[1]<<2&60|c[2]>>6],a+=e[c[2]&63]):(a+=e[c[1]<<2&60],a+="\x3d",b=!0)):(a+=e[c[0]<<4&48],a+="\x3d",a+="\x3d",b=!0),g+=4,76<=g&&(a+="\n",g=0);return a},decodeBase64:function(a){var b;d(a);a="";var c=Array(4);for(b=!1;!b&&-1!==(c[0]=m())&&-1!==(c[1]=m());)c[2]=m(),c[3]=m(),a+=g(c[0]<<2&255|c[1]>>4),-1!==c[2]?(a+=g(c[1]<<4&255|c[2]>>2),-1!==c[3]?a+=g(c[2]<<6&255|
c[3]):b=!0):b=!0;return a}}}(L);/*
 https://github.com/Mr0grog/element-query/blob/master/LICENSE

 @param element
 @param value
 @param units
 @returns {*}
*/
(function(){function b(){(new f.ElementQueries).init()}function a(a,b){var c=Object.prototype.toString.call(a),d=0,e=a.length;if("[object Array]"===c||"[object NodeList]"===c||"[object HTMLCollection]"===c||"undefined"!==typeof jQuery&&a instanceof jQuery||"undefined"!==typeof Elements&&a instanceof Elements)for(;d<e;d++)b(a[d]);else b(a)}var f=this.L=this.L||{};f.ElementQueries=function(){function a(a){a||(a=document.documentElement);a=getComputedStyle(a,"fontSize");return parseFloat(a)||16}function b(b,
c){var d=c.replace(/[0-9]*/,"");c=parseFloat(c);switch(d){case "px":return c;case "em":return c*a(b);case "rem":return c*a();case "vw":return c*document.documentElement.clientWidth/100;case "vh":return c*document.documentElement.clientHeight/100;case "vmin":case "vmax":return c*(0,Math["vmin"===d?"min":"max"])(document.documentElement.clientWidth/100,document.documentElement.clientHeight/100);default:return c}}function e(a){this.element=a;this.options=[];var c,d,e,g=0,f=0,k,l,m,n,p;this.addOption=
function(a){this.options.push(a)};var K=["min-width","min-height","max-width","max-height"];this.call=function(){g=this.element.offsetWidth;f=this.element.offsetHeight;m={};c=0;for(d=this.options.length;c<d;c++)e=this.options[c],k=b(this.element,e.value),l="width"===e.property?g:f,p=e.mode+"-"+e.property,n="","min"===e.mode&&l>=k&&(n+=e.value),"max"===e.mode&&l<=k&&(n+=e.value),m[p]||(m[p]=""),n&&-1===(" "+m[p]+" ").indexOf(" "+n+" ")&&(m[p]+=" "+n);for(var a in K)m[K[a]]?this.element.setAttribute(K[a],
m[K[a]].substr(1)):this.element.removeAttribute(K[a])}}function m(a,b){a.elementQueriesSetupInformation?a.elementQueriesSetupInformation.addOption(b):(a.elementQueriesSetupInformation=new e(a),a.elementQueriesSetupInformation.addOption(b),new f.ResizeSensor(a,function(){a.elementQueriesSetupInformation.call()}));a.elementQueriesSetupInformation.call()}function g(a){var b;for(a=a.replace(/'/g,'"');null!==(b=p.exec(a));)if(5<b.length){var c=void 0,d=b[1]||b[5],e=b[2],g=b[3];b=b[4];document.querySelectorAll&&
(c=document.querySelectorAll.bind(document));c||"undefined"===typeof $$||(c=$$);c||"undefined"===typeof jQuery||(c=jQuery);if(!c)throw"No document.querySelectorAll, jQuery or Mootools's $$ found.";c=c(d);d=0;for(var f=c.length;d<f;d++)m(c[d],{mode:e,property:g,value:b})}}function l(a){if(a)if("string"===typeof a)a=a.toLowerCase(),-1===a.indexOf("min-width")&&-1===a.indexOf("max-width")||g(a);else for(var b=0,c=a.length;b<c;b++)if(1===a[b].type){var d=a[b].selectorText||a[b].cssText;-1!==d.indexOf("min-height")||
-1!==d.indexOf("max-height")?g(d):(-1!==d.indexOf("min-width")||-1!==d.indexOf("max-width"))&&g(d)}else 4===a[b].type&&l(a[b].cssRules||a[b].rules)}var p=/,?([^,\n]*)\[[\s\t]*(min|max)-(width|height)[\s\t]*[~$\^]?=[\s\t]*"([^"]*)"[\s\t]*]([^\n\s\{]*)/mgi;this.init=function(){for(var a=0,b=document.styleSheets.length;a<b;a++)l(document.styleSheets[a].cssText||document.styleSheets[a].cssRules||document.styleSheets[a].rules)}};window.addEventListener?window.addEventListener("load",b,!1):window.attachEvent("onload",
b);var e=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(a){return window.setTimeout(a,20)};f.ResizeSensor=function(b,d){function c(){var a=[];this.add=function(b){a.push(b)};var b,c;this.call=function(){b=0;for(c=a.length;b<c;b++)a[b].call()};this.remove=function(d){var e=[];b=0;for(c=a.length;b<c;b++)a[b]!==d&&e.push(a[b]);a=e};this.length=function(){return a.length}}function m(a,b){return a.currentStyle?a.currentStyle[b]:window.getComputedStyle?
window.getComputedStyle(a,null).getPropertyValue(b):a.style[b]}function g(a,b){if(!a.resizedAttached)a.resizedAttached=new c,a.resizedAttached.add(b);else if(a.resizedAttached){a.resizedAttached.add(b);return}a.resizeSensor=document.createElement("div");a.resizeSensor.className="resize-sensor";a.resizeSensor.style.cssText="position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;";a.resizeSensor.innerHTML='\x3cdiv class\x3d"resize-sensor-expand" style\x3d"position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;"\x3e\x3cdiv style\x3d"position: absolute; left: 0; top: 0; transition: 0s;"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"resize-sensor-shrink" style\x3d"position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;"\x3e\x3cdiv style\x3d"position: absolute; left: 0; top: 0; transition: 0s; width: 200%; height: 200%"\x3e\x3c/div\x3e\x3c/div\x3e';
a.appendChild(a.resizeSensor);"static"===m(a,"position")&&(a.style.position="relative");var d=a.resizeSensor.childNodes[0],g=d.childNodes[0],f=a.resizeSensor.childNodes[1],k=function(){g.style.width="100000px";g.style.height="100000px";d.scrollLeft=1E5;d.scrollTop=1E5;f.scrollLeft=1E5;f.scrollTop=1E5};k();var l=!1,p=function(){a.resizedAttached&&(l&&(a.resizedAttached.call(),l=!1),e(p))};e(p);var y,F,P,U;b=function(){if((P=a.offsetWidth)!==y||(U=a.offsetHeight)!==F)l=!0,y=P,F=U;k()};var R=function(a,
b,c){a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener(b,c)};R(d,"scroll",b);R(f,"scroll",b)}a(b,function(a){g(a,d)});this.detach=function(a){f.ResizeSensor.detach(b,a)}};f.ResizeSensor.detach=function(b,d){a(b,function(a){if(a.resizedAttached&&"function"===typeof d&&(a.resizedAttached.remove(d),a.resizedAttached.length()))return;a.resizeSensor&&(a.contains(a.resizeSensor)&&a.removeChild(a.resizeSensor),delete a.resizeSensor,delete a.resizedAttached)})}})();TK=TK||{};TK.View=function(){var b=TK.EventDispatcher({});b.url="";return b};TK=TK||{};
TK.VideoPlayer=function(b){b.options.bar=void 0!=b.options.bar?b.options.bar:!1;var a=TK.View({});a.id=b.id;a.local=b.stream.local;a.stream=b.stream.stream;a.elementID=b.elementID;var f=function(){a.bar.display()};var e=function(){a.bar.hide()};a.destroy=function(){L.Utils.mediaPause(a.video);delete a.resizer;try{a.div&&a.container.removeChild(a.div)}catch(k){L.Logger.error("[tk-sdk]videoplayer destroy error , removeChild method error info:",k)}};a.resize=function(){var c=a.container.offsetWidth,d=
a.container.offsetHeight;if(b.stream.screen||!1===b.options.crop)9/16*c<d?(a.video.style.width=c+"px",a.video.style.height=9/16*c+"px",a.video.style.top=-(9/16*c/2-d/2)+"px",a.video.style.left="0px"):(a.video.style.height=d+"px",a.video.style.width=16/9*d+"px",a.video.style.left=-(16/9*d/2-c/2)+"px",a.video.style.top="0px");else if(c!==a.containerWidth||d!==a.containerHeight)3/4*c>d?(a.video.style.width=c+"px",a.video.style.height=3/4*c+"px",a.video.style.top=-(3/4*c/2-d/2)+"px",a.video.style.left=
"0px"):(a.video.style.height=d+"px",a.video.style.width=4/3*d+"px",a.video.style.left=-(4/3*d/2-c/2)+"px",a.video.style.top="0px");a.containerWidth=c;a.containerHeight=d};a.stream&&"object"===typeof a.stream&&a.stream.playbackquUrl?(L.Logger.debug("[tk-sdk]Creating palyback URL from stream "+a.stream),a.streamUrl=a.stream.playbackquUrl):a.stream&&(L.Logger.debug("[tk-sdk]Creating URL from stream "+a.stream),a.streamUrl=(window.URL||webkitURL).createObjectURL(a.stream));a.div=document.createElement("div");
a.div.setAttribute("id","player_"+a.id);a.div.setAttribute("class","Talk_player");a.div.setAttribute("style","width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;");!1!==b.options.loader&&(a.loader=document.createElement("div"),a.loader.setAttribute("id","back_"+a.id),a.loader.setAttribute("class","Talk_loader"));a.video=document.createElement("video");a.video.setAttribute("id","stream"+a.id);a.video.setAttribute("class","Talk_stream");a.video.setAttribute("style",
"width: 100%; height: 100%; position: absolute;background-color:#000;");a.video.setAttribute("autoplay","autoplay");a.videoSupernatant=document.createElement("div");a.videoSupernatant.setAttribute("class","Talk_stream_videoSupernatant");a.videoSupernatant.setAttribute("style","width: 100%; height: 100%; position: absolute;background-color:transparent;left:0;top:0;");a.showVideoContainer=function(){a.container&&(a.container.style.display="block")};a.hideVideoContainer=function(){a.container&&(a.container.style.display=
"none")};a.showVideo=function(){a.video&&(a.video.style.display="block")};a.hideVideo=function(){a.video&&(a.video.style.display="none")};a.local&&(a.video.volume=0,a.video.muted=!0);a.container=void 0!==a.elementID?"object"===typeof a.elementID&&"function"===typeof a.elementID.appendChild?a.elementID:document.getElementById(a.elementID):document.body;a.container.appendChild(a.div);a.loader&&a.div.appendChild(a.loader);a.div.appendChild(a.video);a.div.appendChild(a.videoSupernatant);a.containerWidth=
0;a.containerHeight=0;!1!==b.options.bar?(a.bar=new TK.Bar({elementID:"player_"+a.id,id:a.id,stream:b.stream,media:a.video,options:b.options}),a.div.onmouseover=f,a.div.onmouseout=e):a.media=a.video;a.streamUrl&&(a.video.src=a.streamUrl,a.video.load());var c=function(){a.video&&0!==a.video.readyState&&a.audio&&(a.div&&a.div.removeChild&&a.audio&&(a.audio.src="",a.div.removeChild(a.audio)),a.audio=void 0)};a.video.oncanplay=function(b){a.loader.style.display="none";a.div.style.backgroundColor="transparent";
a.video.oncanplay=void 0;a.video.onloadeddata=void 0;a.video.onloadedmetadata=void 0;c()};a.video.onloadeddata=function(b){a.loader.style.display="none";a.div.style.backgroundColor="transparent";a.video.oncanplay=void 0;a.video.onloadeddata=void 0;a.video.onloadedmetadata=void 0;c()};a.video.onloadedmetadata=function(b){a.loader.style.display="none";a.div.style.backgroundColor="transparent";a.video.oncanplay=void 0;a.video.onloadeddata=void 0;a.video.onloadedmetadata=void 0;c()};a.video.onreadystatechange=
function(a){c()};a.changeMediaStreamUrl=function(b){a.video&&b&&(a.stream=b,a.stream&&"object"===typeof a.stream&&a.stream.playbackquUrl?(L.Logger.debug("[tk-sdk]Creating palyback URL from stream:",a.stream),a.streamUrl=a.stream.playbackquUrl):a.stream&&(L.Logger.debug("[tk-sdk]Creating URL from stream: ",a.stream),a.streamUrl=(window.URL||webkitURL).createObjectURL(a.stream)),a.streamUrl&&(a.video.src=a.streamUrl,a.video.load()))};a.stream?"object"===typeof a.stream&&a.stream.playbackquUrl||(f=a.stream.getVideoTracks?
a.stream.getVideoTracks():void 0,f&&0<f.length||(L.Logger.warning("[tk-sdk]TK.VideoPlayer stream is not videoTracks , hide video element , VideoPlayer id is "+a.id+"!"),a.hideVideo())):(L.Logger.warning("[tk-sdk]TK.VideoPlayer stream is not exist , hide video element , VideoPlayer id is "+a.id+"!"),a.hideVideo());var d=function(){try{if(a.video&&0===a.video.readyState&&!a.local&&setTimeout(function(){if(a&&a.video&&0===a.video.readyState&&a.streamUrl&&a.div){a.audio=document.createElement("audio");
a.audio.setAttribute("id","stream_temp_audio_"+a.id);a.audio.setAttribute("autoplay","autoplay");a.audio.style.display="none";a.div.appendChild(a.audio);a.audio.src=a.streamUrl;a.audio.load();a.local&&(a.audio.volume=0,a.audio.muted=!0);var b=function(){if(a.audio&&a.audio.play){var b=L.Utils.mediaPlay(a.audio);b&&b.catch&&b.catch(function(b){L.Logger.warning("[tk-sdk]audio.play method catch error , videoPlayer id is "+a.id+" , error info:"+b)})}},c=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput);
c?TK.AVMgr.setElementSinkIdToAudioouputDevice(a.audio,c,function(){b()}):b()}},250),a.video&&a.video.play){var b=L.Utils.mediaPlay(a.video);b&&b.catch&&b.catch(function(b){L.Logger.warning("[tk-sdk]video.play method catch error , videoPlayer id is "+a.id+" , error info:"+b)})}}catch(m){L.Logger.warning("[tk-sdk]video.play method error , videoPlayer id is "+a.id+" !")}};f=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput);a.video&&f?TK.AVMgr.setElementSinkIdToAudioouputDevice(a.video,
f,function(){d()}):d();return a};TK=TK||{};
TK.NativeVideoPlayer=function(b){b.options.bar=void 0!=b.options.bar?b.options.bar:!1;b.stream.stream||L.Logger.warning("[tk-sdk]VideoPlayer: media stream  is not exist!");var a=TK.View({});a.id=b.id;a.stream=b.stream.stream;a.elementID=b.elementID;var f=function(){a.bar.display()};var e=function(){a.bar.hide()};a.destroy=function(){a.parentNode.removeChild(a.div)};a.resize=function(){var c=a.container.offsetWidth,d=a.container.offsetHeight;if(b.stream.screen||!1===b.options.crop)9/16*c<d?(a.video.style.width=
c+"px",a.video.style.height=9/16*c+"px",a.video.style.top=-(9/16*c/2-d/2)+"px",a.video.style.left="0px"):(a.video.style.height=d+"px",a.video.style.width=16/9*d+"px",a.video.style.left=-(16/9*d/2-c/2)+"px",a.video.style.top="0px");else if(c!==a.containerWidth||d!==a.containerHeight)3/4*c>d?(a.video.style.width=c+"px",a.video.style.height=3/4*c+"px",a.video.style.top=-(3/4*c/2-d/2)+"px",a.video.style.left="0px"):(a.video.style.height=d+"px",a.video.style.width=4/3*d+"px",a.video.style.left=-(4/3*d/
2-c/2)+"px",a.video.style.top="0px");a.containerWidth=c;a.containerHeight=d};a.div=document.createElement("div");a.div.setAttribute("id","player_"+a.id);a.div.setAttribute("class","Talk_player");a.div.setAttribute("style","width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;");!1!==b.options.loader&&(a.loader=document.createElement("div"),a.loader.setAttribute("id","back_"+a.id),a.loader.setAttribute("class","Talk_loader"));a.video=document.createElement("embed");
a.video.setAttribute("id",a.id);a.video.setAttribute("class","Talk_stream");a.video.setAttribute("style","width: 100%; height: 100%; position: absolute;background-color:#000;");a.video.setAttribute("type","application/x-ppapi-proxy");a.videoSupernatant=document.createElement("div");a.videoSupernatant.setAttribute("class","Talk_stream_videoSupernatant");a.videoSupernatant.setAttribute("style","width: 100%; height: 100%; position: absolute;background-color:transparent;left:0;top:0;");a.showVideo=function(){a.video&&
(a.video.style.opacity=1)};a.hideVideo=function(){a.video&&(a.video.style.opacity=0)};a.container=void 0!==a.elementID?"object"===typeof a.elementID&&"function"===typeof a.elementID.appendChild?a.elementID:document.getElementById(a.elementID):document.body;a.container.appendChild(a.div);a.parentNode=a.div.parentNode;a.loader&&a.div.appendChild(a.loader);a.div.appendChild(a.video);a.div.appendChild(a.videoSupernatant);a.containerWidth=0;a.containerHeight=0;!1!==b.options.bar?(a.bar=new TK.Bar({elementID:"player_"+
a.id,id:a.id,stream:b.stream,media:a.video,options:b.options}),a.div.onmouseover=f,a.div.onmouseout=e):a.media=a.video;a.video.onloadedmetadata=function(b){a.loader.style.display="none";a.div.style.backgroundColor="transparent"};a.changeMediaStreamUrl=function(a){};return a};TK=TK||{};TK.ChromeStableStack=10;
TK.AudioPlayer=function(b){var a=TK.View({});a.id=b.id;a.stream=b.stream.stream;a.elementID=b.elementID;L.Logger.debug("[tk-sdk]Creating URL from stream "+a.stream);a.streamUrl=(window.URL||webkitURL).createObjectURL(a.stream);a.audio=document.createElement("audio");a.audio.setAttribute("id","stream"+a.id);a.audio.setAttribute("class","Talk_stream");a.audio.setAttribute("style","width: 100%; height: 100%; position: absolute");a.audio.setAttribute("autoplay","autoplay");b.stream.local&&(a.audio.volume=
0);b.stream.local&&(a.audio.volume=0);if(void 0!==a.elementID){a.destroy=function(){L.Utils.mediaPause(a.audio);a.parentNode.removeChild(a.div)};var f=function(){a.bar.display()};var e=function(){a.bar.hide()};a.div=document.createElement("div");a.div.setAttribute("id","player_"+a.id);a.div.setAttribute("class","Talk_player");a.div.setAttribute("style","width: 100%; height: 100%; position: relative; overflow: hidden;");a.container="object"===typeof a.elementID&&"function"===typeof a.elementID.appendChild?
a.elementID:document.getElementById(a.elementID);a.container.appendChild(a.div);a.parentNode=a.div.parentNode;a.div.appendChild(a.audio);!1!==b.options.bar?(a.bar=new TK.Bar({elementID:"player_"+a.id,id:a.id,stream:b.stream,media:a.audio,options:b.options}),a.div.onmouseover=f,a.div.onmouseout=e):a.media=a.audio}else a.destroy=function(){L.Utils.mediaPause(a.audio);a.parentNode.removeChild(a.audio)},document.body.appendChild(a.audio),a.parentNode=document.body;a.audio.src=a.streamUrl;return a};TK=TK||{};
TK.Bar=function(b){var a=TK.View({}),f;a.elementID=b.elementID;a.id=b.id;a.div=document.createElement("div");a.div.setAttribute("id","bar_"+a.id);a.div.setAttribute("class","Talk_bar");a.bar=document.createElement("div");a.bar.setAttribute("style","width: 100%; height: 15%; max-height: 30px; position: absolute; bottom: 0; right: 0; background-color: rgba(255,255,255,0.62)");a.bar.setAttribute("id","subbar_"+a.id);a.bar.setAttribute("class","Talk_subbar");a.link=document.createElement("a");a.link.setAttribute("href",
b&&b.options&&b.options.link?b.options.link:"http://www.talk-cloud.com/");a.link.setAttribute("class","Talk_link");a.link.setAttribute("target","_blank");a.logo=document.createElement("div");a.logo.setAttribute("style","width: 100%; height: 100%; max-width: 30px; position: absolute; top: 0; left: 2px;");a.logo.setAttribute("class","Talk_logo");a.logo.setAttribute("alt","Lynckia");var e=function(b){"block"!==b?b="none":clearTimeout(f);a.div.setAttribute("style","width: 100%; height: 100%; position: relative; bottom: 0; right: 0; display:"+
b)};a.display=function(){e("block")};a.hide=function(){f=setTimeout(e,1E3)};document.getElementById(a.elementID).appendChild(a.div);a.div.appendChild(a.bar);a.bar.appendChild(a.link);a.link.appendChild(a.logo);b.stream.screen||void 0!==b.options&&void 0!==b.options.speaker&&!0!==b.options.speaker||(a.speaker=new TK.Speaker({elementID:"subbar_"+a.id,id:a.id,stream:b.stream,media:b.media}));a.display();a.hide();return a};TK=TK||{};
TK.Speaker=function(b){function a(a,b){if(e(a,b)){for(var c=" "+a.className.replace(/[\t\r\n]/g,"")+" ";0<=c.indexOf(" "+b+" ");)c=c.replace(" "+b+" "," ");a.className=c.replace(/^\s+|\s+$/g,"")}}function f(a,b){e(a,b)||(a.className+=" "+b)}function e(a,b){b=b||"";return 0==b.replace(/\s/g,"").length?!1:(new RegExp(" "+b+" ")).test(" "+a.className+" ")}var c=TK.View({}),d=50;c.elementID=b.elementID;c.media=b.media;c.id=b.id;c.stream=b.stream;c.div=document.createElement("div");c.div.setAttribute("style","width: 40%; height: 100%; max-width: 32px; position: absolute; right: 0;z-index:0;");
c.icon=document.createElement("div");c.icon.setAttribute("id","volume_"+c.id);c.icon.setAttribute("class","Talk_Volume_icon");c.icon.setAttribute("style","width: 80%; height: 100%; position: absolute;");c.div.appendChild(c.icon);if(c.stream.local){var k=function(){c.media.muted=!0;a(c.icon,"sound");f(c.icon,"mute");c.stream.stream.getAudioTracks()[0].enabled=!1};var m=function(){c.media.muted=!1;a(c.icon,"mute");f(c.icon,"sound");c.stream.stream.getAudioTracks()[0].enabled=!0};c.icon.onclick=function(){c.media.muted?
m():k()}}else{c.picker=document.createElement("input");c.picker.setAttribute("id","picker_"+c.id);c.picker.type="range";c.picker.min=0;c.picker.max=100;c.picker.step=10;c.picker.value=d;c.picker.setAttribute("orient","vertical");c.div.appendChild(c.picker);c.media.volume=c.picker.value/100;c.media.muted=!1;c.picker.oninput=function(){c.media.muted=0<c.picker.value?!1:!0;a(c.icon,"sound");f(c.icon,"mute");c.media.volume=c.picker.value/100};var g=function(a){c.picker.setAttribute("style","background: transparent; width: 32px; height: 100px; position: absolute; bottom: 90%; z-index: 1;"+
c.div.offsetHeight+"px; right: 0px; -webkit-appearance: slider-vertical; display: "+a)};k=function(){a(c.icon,"sound");f(c.icon,"mute");d=c.picker.value;c.picker.value=0;c.media.volume=0;c.media.muted=!0};m=function(){a(c.icon,"mute");f(c.icon,"sound");c.picker.value=d;c.media.volume=c.picker.value/100;c.media.muted=!1};c.icon.onclick=function(){c.media.muted?m():k()};c.div.onmouseover=function(){g("block")};c.div.onmouseout=function(){g("none")};g("none")}document.getElementById(c.elementID).appendChild(c.div);
return c};L=L||{};
L.Constant=function(){return{roomError:{ROOMCONNECTERROR:0,GETCONFIGERROR:1,GETFILELISTERROR:2},getUserMedia:{SUCCESS_ONLY_VIDEO:1,SUCCESS_ONLY_AUDIO:2,SUCCESS_ALL:3,SUCCESS_NOT_ALL:4,FAILURE_ONLY_VIDEO:-1,FAILURE_ONLY_AUDIO:-2,FAILURE_ALL:-3,FAILURE_USERMEDIA_AGAIN_ONLY_GET_AUDIO:0,FAILURE_USERMEDIA_AGAIN_ONLY_GET_VIDEO:0},accessDenied:{streamFail:0,notAudioAndVideo:1,notAudioAndVideoAndScreenOrUrlNotUndefined:2,ohterError:-1},deviceStorage:{audioinput:"audioinputDeviceId",audiooutput:"audiooutputDeviceId",videoinput:"videoinputDeviceId"},
streamReconnection:{notOnceSuccess:1,midwayReconnectionNotSuccess:2},getStats:{nativeFailure:1,pcNotGetStats:2,peerConnectionNotGetStats:3,getStatsFailure:4,getStatsError:5},udpState:{ok:1,notOnceSuccess:2},localRecord:{onlyRecordAudio:0,recordAudioAndVideo:1}}}(L);L=L||{};L.hex64Instance=void 0;
(function(){var b=function(a){this._key=[];this._tbl={};for(var b=0;64>b;++b)this._key[b]="JKijklmnoz$_01234ABCDEFGHI56789LMNOPQRpqrstuvwxySTUVWXYZabcdefgh~".charAt(a[b]),this._tbl[this._key[b]]=b;this._pad="~"};b.prototype.enc=function(a){for(var e="",c,d,f,m,g=0,l=b._2to1(a),p=l.length%3,n=l.length-p;g<n;)c=l[g++],d=l[g++],f=l[g++],a=c>>2,c=(c&3)<<4|d>>4,m=(d&15)<<2|f>>6,d=f&63,e+=this._key[a]+this._key[c]+this._key[m]+this._key[d];0<p&&(c=l[g++],d=1<p?l[g]:0,m=(d&15)<<2,e+=this._key[c>>2]+this._key[(c&
3)<<4|d>>4]+(m?this._key[m]:this._pad)+this._pad);return e.replace(/.{76}/g,function(a){return a+"\n"})};b.prototype.dec=function(a){var e=[],c=0,d=0;for(a=a.replace(/[^0-9A-Za-z$_~]/g,"");c<a.length;){var f=this._tbl[a.charAt(c++)];var m=this._tbl[a.charAt(c++)];var g=this._tbl[a.charAt(c++)];var l=this._tbl[a.charAt(c++)];e[d++]=f<<2|m>>4;e[d++]=(m&15)<<4|g>>2;e[d++]=(g&3)<<6|l}a=a.slice(-2);a.charAt(0)==this._pad?e.length-=2:a.charAt(1)==this._pad&&--e.length;return b._1to2(e)};b._2to1=function(a){var b=
!1,c=0,d=[];255<a.charCodeAt(0)&&(b=!0,d[c++]=29);for(var f=0;f<a.length;++f){var m=a.charCodeAt(f);29!=m&&(255>=m?(b&&(d[c++]=29,b=!1),d[c++]=m):(b||(d[c++]=29,b=!0),d[c++]=m>>8,d[c++]=m&255))}return d};b._1to2=function(a){for(var b=!1,c="",d=0;d<a.length;++d){var f=a[d];29==f?b=!b:c=b?c+String.fromCharCode(256*f+a[++d]):c+String.fromCharCode(f)}return c};var a=[15,40,46,43,13,0,51,35,63,36,50,6,32,4,31,62,5,24,8,53,59,41,20,7,37,38,48,18,11,26,19,55,58,10,33,34,49,14,25,44,52,61,16,2,56,23,29,45,
9,3,12,39,30,42,47,22,21,60,1,54,28,57,17,27];64!==a.length?L.Logger.error("\u4e92\u65a5\u503c\u6570\u7ec4\u957f\u5ea6\u5fc5\u987b\u662f65\u4f4d\uff0c\u5f53\u524d\u957f\u5ea6\u4e3a:"+a.length):L.hex64Instance=new b(a)})();
L.Utils=function(){var b=void 0,a=!1,f=!1;b={handleMediaPlayOnEvent:function(a,c){try{if(L.Utils.removeEvent(a,"canplay",b.handleMediaPlayOnEvent.bind(null,a,c)),L.Utils.removeEvent(a,"loadedmetadata",b.handleMediaPlayOnEvent.bind(null,a,c)),L.Utils.removeEvent(a,"loadeddata",b.handleMediaPlayOnEvent.bind(null,a,c)),a&&a.play&&"function"===typeof a.play){var d=a.play();d&&d.catch&&"function"===typeof d.catch&&d.catch(function(b){L.Logger.error("[tk-sdk]media play err:",L.Utils.toJsonStringify(b),
c?" , media element id is "+c:" media element:",c?"":a)})}}catch(k){L.Logger.error("[tk-sdk]media play error:",L.Utils.toJsonStringify(k),c?" , media element id is "+c:" media element:",c?"":a)}},handleMediaPauseOnEvent:function(a,c){try{if(L.Utils.removeEvent(a,"canplay",b.handleMediaPauseOnEvent.bind(null,a,c)),L.Utils.removeEvent(a,"loadedmetadata",b.handleMediaPauseOnEvent.bind(null,a,c)),L.Utils.removeEvent(a,"loadeddata",b.handleMediaPauseOnEvent.bind(null,a,c)),a&&a.pause&&"function"===typeof a.pause){var d=
a.pause();d&&d.catch&&"function"===typeof d.catch&&d.catch(function(b){L.Logger.error("[tk-sdk]media pause err:",L.Utils.toJsonStringify(b),c?" , media element id is "+c:" media element:",c?"":a)})}}catch(k){L.Logger.error("[tk-sdk]media pause error:",L.Utils.toJsonStringify(k),c?" , media element id is "+c:" media element:",c?"":a)}}};return{addEvent:function(a,b,d,f){a.addEventListener?a.addEventListener(b,d,void 0!=f&&null!=f?f:!1):a.attachEvent?a.attachEvent("on"+b,d):a["on"+b]=d},removeEvent:function(a,
b,d,f){a.removeEventListener?a.removeEventListener(b,d,void 0!=f&&null!=f?f:!1):a.detachEvent?a.detachEvent("on"+b,d):a["on"+b]=null},toJsonStringify:function(a,b){if(void 0!=b&&!b||!a)return a;try{if("object"!==typeof a)return a;var c=JSON.stringify(a);c?a=c:L.Logger.debug("[tk-sdk]toJsonStringify:data is not json!")}catch(k){L.Logger.debug("[tk-sdk]toJsonStringify:data is not json!")}return a},toJsonParse:function(a,b){if(void 0!=b&&!b||!a)return a;try{if("string"!==typeof a)return a;var c=JSON.parse(a);
c?a=c:L.Logger.debug("[tk-sdk]toJsonParse:data is not json string!")}catch(k){L.Logger.debug("[tk-sdk]toJsonParse:data is not json string!")}return a},encrypt:function(a,b){if(!a)return a;b=void 0!=b?b:"talk_2017_@beijing";a=L.hex64Instance.enc(a);return b+a+b},decrypt:function(a,b){if(!a)return a;a=a.replace(new RegExp(void 0!=b?b:"talk_2017_@beijing","gm"),"");return L.hex64Instance.dec(a)},mediaPlay:function(a){var c=void 0;a&&"string"===typeof a?a=document.getElementById(a):a&&/(audio|video)/g.test(a.nodeName.toLowerCase())&&
a.getAttribute&&"function"===typeof a.getAttribute&&(c=a.getAttribute("id"));a&&/(audio|video)/g.test(a.nodeName.toLowerCase())&&(0!==a.readyState?b.handleMediaPlayOnEvent(a,c):(L.Utils.removeEvent(a,"canplay",b.handleMediaPlayOnEvent.bind(null,a,c)),L.Utils.removeEvent(a,"loadedmetadata",b.handleMediaPlayOnEvent.bind(null,a,c)),L.Utils.removeEvent(a,"loadeddata",b.handleMediaPlayOnEvent.bind(null,a,c)),L.Utils.addEvent(a,"canplay",b.handleMediaPlayOnEvent.bind(null,a,c)),L.Utils.addEvent(a,"loadedmetadata",
b.handleMediaPlayOnEvent.bind(null,a,c)),L.Utils.addEvent(a,"loadeddata",b.handleMediaPlayOnEvent.bind(null,a,c))))},mediaPause:function(a){var c=void 0;a&&"string"===typeof a?a=document.getElementById(a):a&&/(audio|video)/g.test(a.nodeName.toLowerCase())&&a.getAttribute&&"function"===typeof a.getAttribute&&(c=a.getAttribute("id"));a&&/(audio|video)/g.test(a.nodeName.toLowerCase())&&(0!==a.readyState?b.handleMediaPauseOnEvent(a,c):(L.Utils.removeEvent(a,"canplay",b.handleMediaPauseOnEvent.bind(null,
a,c)),L.Utils.removeEvent(a,"loadedmetadata",b.handleMediaPauseOnEvent.bind(null,a,c)),L.Utils.removeEvent(a,"loadeddata",b.handleMediaPauseOnEvent.bind(null,a,c)),L.Utils.addEvent(a,"canplay",b.handleMediaPauseOnEvent.bind(null,a,c)),L.Utils.addEvent(a,"loadedmetadata",b.handleMediaPauseOnEvent.bind(null,a,c)),L.Utils.addEvent(a,"loadeddata",b.handleMediaPauseOnEvent.bind(null,a,c))))},localStorage:{setItem:function(b,c){try{window.localStorage?window.localStorage.setItem?window.localStorage.setItem(b,
c):L.Logger.warning("[tk-sdk]Browser does not support localStorage.setItem , key is "+b+" , value is "+c+"!"):a||(a=!0,L.Logger.warning("[tk-sdk]Browser does not support localStorage!"))}catch(d){a||(a=!0,L.Logger.warning("[tk-sdk]Browser does not support localStorage , error info:",L.Utils.toJsonStringify(d)))}},getItem:function(b){try{if(window.localStorage){if(window.localStorage.getItem)return window.localStorage.getItem(b);L.Logger.warning("[tk-sdk]Browser does not support localStorage.getItem , key is "+
b+" !");return""}a||(a=!0,L.Logger.warning("[tk-sdk]Browser does not support localStorage!"));return""}catch(c){return a||(a=!0,L.Logger.warning("[tk-sdk]Browser does not support localStorage , error info:",L.Utils.toJsonStringify(c))),""}}},sessionStorage:{setItem:function(a,b){try{window.sessionStorage?window.sessionStorage.setItem?window.sessionStorage.setItem(a,b):L.Logger.warning("[tk-sdk]Browser does not support sessionStorage.setItem , key is "+a+" , value is "+b+"!"):f||(f=!0,L.Logger.warning("[tk-sdk]Browser does not support sessionStorage!"))}catch(d){f||
(f=!0,L.Logger.warning("[tk-sdk]Browser does not support sessionStorage , error info:",L.Utils.toJsonStringify(d)))}},getItem:function(a){try{if(window.sessionStorage){if(window.sessionStorage.getItem)return window.sessionStorage.getItem(a);L.Logger.warning("[tk-sdk]Browser does not support sessionStorage.getItem , key is "+a+" !");return""}f||(f=!0,L.Logger.warning("[tk-sdk]Browser does not support sessionStorage!"));return""}catch(c){return f||(f=!0,L.Logger.warning("[tk-sdk]Browser does not support sessionStorage , error info:",
L.Utils.toJsonStringify(c))),""}}}}}(L);TK=TK||{};TK.mediaStream=void 0;
TK.AVMgr=function(){function b(a,b,c){b=void 0!==b?b:!0;c=void 0!==c?c:!0;if(b&&c&&a&&a.getTracks&&"function"===typeof a.getTracks){if((a=a.getTracks())&&0<a.length)for(c=0;c<a.length;c++)a[c]&&a[c].stop&&"function"===typeof a[c].stop&&a[c].stop()}else{if(b&&a&&a.getVideoTracks&&"function"===typeof a.getVideoTracks&&(b=a.getVideoTracks())&&0<b.length)for(var d=0;d<b.length;d++)b[d]&&b[d].stop&&"function"===typeof b[d].stop&&b[d].stop();if(c&&a&&a.getAudioTracks&&"function"===typeof a.getAudioTracks&&
(a=a.getAudioTracks())&&0<a.length)for(c=0;c<a.length;c++)a[c]&&a[c].stop&&"function"===typeof a[c].stop&&a[c].stop()}}var a={room_video_width:320,room_video_height:240,room_video_fps:10,streamJson:{selectStream:void 0},setAVMgrProperty:function(b){for(var c in b)a.hasOwnProperty(c)&&(a[c]=b[c])}},f=function(a,b,c){navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(a).then(b).catch(c):(navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||
navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getMedia(a,b,c))},e=function(c,d,e){L.Logger.debug("[tk-sdk]checkGetUserMediaing , videoinputDeviceId:"+d+" , audioinputDeviceId:"+e);c&&"function"===typeof c||L.Logger.error("[tk-sdk]checkGetUserMedia callback must function");var g=!1,k=!1,m,u,t=function(){g&&k&&c({videoinput:{old:d,now:m},audioinput:{old:e,now:u}})},w=function(a){L.Logger.debug("[tk-sdk]checkGetUserMedia video finshed , videoinputDeviceId:"+d+" , successVideoinputId:"+
a);g=!0;m=a;t()},A=function(a){L.Logger.debug("[tk-sdk]checkGetUserMedia audio finshed , audioinputDeviceId:"+e+" , successAudioinputId:"+a);k=!0;u=a;t()};d?f({audio:!1,video:{deviceId:{exact:d}}},function(a){b(a,!0,!1);w(d)},function(c){a.enumerateDevices(function(a){if(a&&a.devices&&a.devices.videoinput){var c=a.devices.videoinput;if(c&&0<c.length){var d=c[0],e=function(a){f({audio:!1,video:{deviceId:{exact:a}}},function(d){c.shift();b(d,!0,!1);w(a)},function(a){c.shift();(d=c[0])?e(d.deviceId):
w()})};d?e(d.deviceId):w()}else w()}else w()})}):w();e?f({video:!1,audio:{deviceId:{exact:e}}},function(a){b(a,!1,!0);A(e)},function(c){a.enumerateDevices(function(a){if(a&&a.devices&&a.devices.audioinput){var c=a.devices.audioinput;if(c&&0<c.length){var d=c[0],e=function(a){f({video:!1,audio:{deviceId:{exact:a}}},function(d){c.shift();b(d,!1,!0);A(a)},function(a){c.shift();(d=c[0])?e(d.deviceId):A()})};d?e(d.deviceId):A()}else A()}else A()})}):A()},c=function(c,d,e,l){var g=void 0,k;var m=function(b){var d=
g&&"string"===typeof g?L.Utils.toJsonParse(g):g;b.customdata_createID=(new Date).getTime();b.customdata_deviceJsonId={};d&&(d.video&&"object"===typeof d.video&&(b.customdata_deviceJsonId.videoinput="object"===typeof d.video.deviceId?d.video.deviceId.exact:d.video.deviceId),d.audio&&"object"===typeof d.audio&&(b.customdata_deviceJsonId.audioinput="object"===typeof d.audio.deviceId?d.audio.deviceId.exact:d.audio.deviceId));a.streamJson.selectStream=b;d={videoTracks:!0,audioTracks:!0};if(b){var e=b.getVideoTracks?
b.getVideoTracks():void 0,f=b.getAudioTracks?b.getAudioTracks():void 0;e&&0<e.length||(d.videoTracks=!1,L.Logger.warning("[tk-sdk]getUserMedia stream is  not videoTracks  , currUserMediaConfig info:"+g+"!"));f&&0<f.length||(d.audioTracks=!1,L.Logger.warning("[tk-sdk]getUserMedia stream is  not audioTracks  , currUserMediaConfig info:"+g+"!"))}else L.Logger.error("[tk-sdk]getUserMedia stream is not exist!"),d.videoTracks=!1,d.audioTracks=!1;e=[];e.push(b);e.push(d);b.customdata_tracksInfo=d;l&&l.externalJson&&
void 0!==l.externalJson.getUserMediaFailureCode&&(b.getUserMediaFailureCode=l.externalJson.getUserMediaFailureCode);l.isNeedCheckChangeLocalStream&&l.deviceInfo.initDeviceId.audioinput!==b.customdata_deviceJsonId.audioinput&&(L.Logger.info("[tk-sdk]getUserMedia changed audioinput device , old device id is "+l.deviceInfo.initDeviceId.audioinput+" , now device id is "+b.customdata_deviceJsonId.audioinput),L.Utils.localStorage.setItem(L.Constant.deviceStorage.audioinput,b.customdata_deviceJsonId.audioinput||
""));l.isNeedCheckChangeLocalStream&&l.deviceInfo.initDeviceId.videoinput!==b.customdata_deviceJsonId.videoinput&&(L.Logger.info("[tk-sdk]getUserMedia changed videoinput device , old device id is "+l.deviceInfo.initDeviceId.videoinput+" , now device id is "+b.customdata_deviceJsonId.videoinput),L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,b.customdata_deviceJsonId.videoinput||""));l&&l.dispatchEvent&&(f=L.Constant.getUserMedia.SUCCESS_ALL,d.videoTracks||d.audioTracks?d.videoTracks?
d.audioTracks||(f=L.Constant.getUserMedia.SUCCESS_ONLY_VIDEO):f=L.Constant.getUserMedia.SUCCESS_ONLY_AUDIO:f=L.Constant.getUserMedia.SUCCESS_NOT_ALL,TK&&TK.coreEventController&&TK.coreEventController.dispatchEvent({type:"getUserMedia_success",message:{mediaStream:b,customdata_tracksInfo:d,code:f,externalJson:l.externalJson}},!1));c.apply(c,e)};var t=function(a){L.Logger.error("[tk-sdk]getUserMedia error info: name is "+a.name+" , message is "+a.message+" , constraintName is "+a.constraintName);var b=
g&&"string"===typeof g?L.Utils.toJsonParse(g):g,c=k&&"string"===typeof k?L.Utils.toJsonParse(k):k;if(l.isDemotionLocalStream){if(b.video&&"object"===typeof b.video&&!l.deviceInfo.demotion.videoinput){l.deviceInfo.demotion.videoinput=!0;c.video=!1;l.externalJson.getUserMediaFailureCode=L.Constant.getUserMedia.FAILURE_USERMEDIA_AGAIN_ONLY_GET_AUDIO;L.Logger.warning("[tk-sdk]Gets the data stream failed and now only gets the audio device stream , oldUserMediaConfig info:"+g+" , nowUserMediaConfig info:"+
L.Utils.toJsonStringify(c)+"!");l&&l.dispatchEvent&&TK&&TK.coreEventController&&TK.coreEventController.dispatchEvent({type:"getUserMedia_failure_reGetOnlyAudioStream",message:{errorMsg:e,code:L.Constant.getUserMedia.FAILURE_USERMEDIA_AGAIN_ONLY_GET_AUDIO,externalJson:l.externalJson}},!1);w(c);return}if(b.video&&"object"===typeof b.video&&!l.deviceInfo.demotion.audioinput){l.deviceInfo.demotion.audioinput=!0;c.audio=!1;l.externalJson.getUserMediaFailureCode=L.Constant.getUserMedia.FAILURE_USERMEDIA_AGAIN_ONLY_GET_VIDEO;
L.Logger.warning("[tk-sdk]Gets the data stream failed and now only gets the video device stream , oldUserMediaConfig info:"+g+" , nowUserMediaConfig info:"+L.Utils.toJsonStringify(c)+"!");l&&l.dispatchEvent&&TK&&TK.coreEventController&&TK.coreEventController.dispatchEvent({type:"getUserMedia_failure_reGetOnlyVideoStream",message:{errorMsg:e,code:L.Constant.getUserMedia.FAILURE_USERMEDIA_AGAIN_ONLY_GET_VIDEO,externalJson:l.externalJson}},!1);w(c);return}}var e="[tk-sdk]Gets the data stream failed[video , audio] ,currUserMediaConfig info:"+
g+"!";L.Logger.warning(e);l.externalJson.getUserMediaFailureCode=L.Constant.getUserMedia.FAILURE_ALL;l&&l.dispatchEvent&&TK&&TK.coreEventController&&TK.coreEventController.dispatchEvent({type:"getUserMedia_failure",message:{errorMsg:e,code:L.Constant.getUserMedia.FAILURE_ALL,externalJson:l.externalJson}},!1);if(d&&"function"===typeof d){b=[];for(c=0;c<arguments.length;c++)b[c]=arguments[c];l&&l.externalJson&&void 0!==l.externalJson.getUserMediaFailureCode&&b.push({getUserMediaFailureCode:l.externalJson.getUserMediaFailureCode});
d.apply(d,b)}};var w=function(c){g=c&&"object"===typeof c?L.Utils.toJsonStringify(c):c;k||(k=g);l.isStopLocalStream&&TK.default_stream&&TK.default_stream.stream&&TK.default_stream.stream.getTracks&&b(TK.default_stream.stream);a.streamJson.selectStream&&TK.default_stream&&TK.default_stream.stream&&TK.default_stream.stream.customdata_createID===a.streamJson.selectStream.customdata_createID||b(a.streamJson.selectStream);f(c,m,t)};w(e)},d=function(b,c){var d={video:{},audio:{}};b?(void 0!==b.audio&&(d.audio=
b.audio),void 0!==b.video&&(d.video=b.video),d.audio&&"object"===typeof d.audio&&void 0!==d.audio.sourceId&&(d.audio.deviceId=d.audio.sourceId,delete d.audio.sourceId),d.video&&"object"===typeof d.video&&void 0!==d.video.sourceId&&(d.video.deviceId=d.video.sourceId,delete d.video.sourceId)):(d.audio.deviceId=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput),d.video.deviceId=L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput));if(d.video&&"object"===typeof d.video){b=
a.room_video_width||320;var e=a.room_video_width||320,f=a.room_video_height||240,k=a.room_video_height||240,m=Number(a.room_video_fps||10),t=Number(a.room_video_fps||10);void 0===d.video.width&&(d.video.width={ideal:b,max:e});void 0===d.video.height&&(d.video.height={ideal:f,max:k});void 0===d.video.frameRate&&(d.video.frameRate={ideal:m,max:t})}c.audio.sourceId?(d.audio="object"===typeof d.audio?d.audio:{},d.audio.deviceId=c.audio.sourceId):c.audio.deviceId&&(d.audio="object"===typeof d.audio?d.audio:
{},d.audio.deviceId=c.audio.deviceId);c.video.sourceId?(d.video="object"===typeof d.video?d.video:{},d.video.deviceId=c.video.sourceId):c.video.deviceId&&(d.video="object"===typeof d.video?d.video:{},d.video.deviceId=c.video.deviceId);c.exclude&&c.exclude.audio?d.audio=!1:d.audio&&"object"===typeof d.audio&&void 0!==d.audio.deviceId&&(d.audio.deviceId="object"!==d.audio.deviceId?{exact:d.audio.deviceId}:d.audio.deviceId);c.exclude&&c.exclude.video?d.video=!1:d.video&&"object"===typeof d.video&&void 0!==
d.video.deviceId&&(d.video.deviceId="object"!==d.video.deviceId?{exact:d.video.deviceId}:d.video.deviceId);return d};a.getUserMedia=function(a,b,f,l){l=void 0!=l&&null!=l&&"object"===typeof l?l:{video:{},audio:{},exclude:{}};l.video=l.video||{};l.audio=l.audio||{};l.exclude=l.exclude||{};l.externalJson=l.externalJson||{};l.deviceInfo={initDeviceId:{videoinput:void 0,audioinput:void 0},demotion:{videoinput:!1,audioinput:!1}};f=d(f,l);f.audio&&"object"===typeof f.audio&&(l.deviceInfo.initDeviceId.audioinput=
"object"===typeof f.audio.deviceId?f.audio.deviceId.exact:f.audio.deviceId);f.video&&"object"===typeof f.video&&(l.deviceInfo.initDeviceId.videoinput="object"===typeof f.video.deviceId?f.video.deviceId.exact:f.video.deviceId);l.isNeedCheckChangeLocalStream?e(function(d){var e=d.videoinput;d=d.audioinput;f.video&&"object"===typeof f.video&&e.old!==e.now?e.now?f.video.deviceId={exact:e.now}:f.video=!1:e.old||(f.video=!1);f.audio&&"object"===typeof f.audio&&d.old!==d.now?d.now?f.audio.deviceId={exact:d.now}:
f.audio=!1:d.old||(f.audio=!1);c(a,b,f,l)},l.deviceInfo.initDeviceId.videoinput,l.deviceInfo.initDeviceId.audioinput):c(a,b,f,l)};a.enumerateDevices=function(a,b){function c(c){var d=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput),e=L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput),f=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput),g={},k={},l={hasdevice:{audioinput:!1,audiooutput:!1,videoinput:!1},devices:{audioinput:[],audiooutput:[],videoinput:[]},
useDevices:{}};c&&c.forEach&&c.forEach(function(a){null!=a&&"communications"!=a.groupId&&"communications"!=a.deiceId&&"\u901a\u8baf"!=a.label&&("audioinput"===a.kind&&a.deviceId===d&&(l.useDevices[a.kind]=a.deviceId),"videoinput"===a.kind&&a.deviceId===e&&(l.useDevices[a.kind]=a.deviceId),"audiooutput"===a.kind&&a.deviceId===f&&(l.useDevices[a.kind]=a.deviceId),g[a.kind]=a.deviceId,l.devices[a.kind].push(a),l.hasdevice[a.kind]=!0,"default"===a.deviceId&&(k[a.kind]=a.deviceId))});l.useDevices.audioinput||
(l.useDevices.audioinput=k.audioinput||g.audioinput||"");l.useDevices.videoinput||(l.useDevices.videoinput=k.videoinput||g.videoinput||"");l.useDevices.audiooutput||(l.useDevices.audiooutput=k.audiooutput||g.audiooutput||"");L.Utils.localStorage?b.isSetlocalStorage&&(L.Utils.localStorage.setItem(L.Constant.deviceStorage.audioinput,l.useDevices.audioinput),L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,l.useDevices.videoinput),L.Utils.localStorage.setItem(L.Constant.deviceStorage.audiooutput,
l.useDevices.audiooutput)):L.Logger.error("[tk-sdk]not support localStorage");L.Logger.info("[tk-sdk]enumerateDevices devicesInfo:",L.Utils.toJsonStringify(l));a&&"function"===typeof a&&a(l)}b=b||{};b.isSetlocalStorage=void 0!=b.isSetlocalStorage?b.isSetlocalStorage:!1;(function(a){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return L.Logger.error("[tk-sdk]navigator.mediaDevices.enumerateDevices method not supported."),a&&"function"===typeof a&&a([]),null;navigator.mediaDevices.enumerateDevices().then(function(b){var c=
{};b.forEach(function(a){L.Logger.debug("[tk-sdk]"+a.kind+": "+a.label+" id \x3d "+a.deviceId,a);c[a.kind]=c[a.kind]||{};c[a.kind][a.deviceId]={kind:a.kind,label:a.label,deviceId:a.deviceId}});L.Logger.debug("[tk-sdk]enumerateDevices devices:"+L.Utils.toJsonStringify(c));a&&"function"===typeof a&&a(b)}).catch(function(b){L.Logger.error("[tk-sdk]enumerateDevices error :"+b.name+": "+b.message);a&&"function"===typeof a&&a([]);throw b;})})(function(a){c(a)})};a.getsSoundMeterInstance=function(a){if(a)return new function(a){var b=
this;b.audioContext=a;b.instant=0;b.slow=0;b.clip=0;b.script=b.audioContext.createScriptProcessor(2048,1,1);b.script.onaudioprocess=function(a){a=a.inputBuffer.getChannelData(0);var c,d=0,e=0;for(c=0;c<a.length;++c)d+=a[c]*a[c],.99<Math.abs(a[c])&&(e+=1);b.instant=Math.sqrt(d/a.length);b.slow=.95*b.slow+.05*b.instant;b.clip=e/a.length};b.connectToSource=function(a,c){L.Logger.debug("SoundMeter connecting");try{b.mic=b.audioContext.createMediaStreamSource(a),b.mic.connect(b.script),b.script.connect(b.audioContext.destination),
"undefined"!==typeof c&&c(null)}catch(n){L.Logger.error("[tk-sdk]connecToSource error:",n),"undefined"!==typeof c&&c(n)}};b.stop=function(){b.mic.disconnect();b.script.disconnect()};return b}(a);L.Logger.error("[tk-sdk]getsSoundMeterInstance audioContext is not exist!")};a.setElementSinkIdToAudioouputDevice=function(a,b,c){if(b=b||L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput))if(TK.isTkNative)c&&"function"===typeof c&&c(!1);else{var d=0,e=function(a,e,f){if(a&&/(audio|video)/g.test(a.nodeName.toLowerCase())&&
b)if(a.setSinkId)try{a.setSinkId(b).then(function(){var e=a.getAttribute("id");L.Logger.debug("[tk-sdk]Audio output device set to "+b,e?" , element id is "+e:"  element:",e?"":a);d++;d===f&&c&&"function"===typeof c&&c(!0)}).catch(function(b){var e=void 0,g=a.getAttribute("id");b&&"SecurityError"===b.name&&(e="You need to use HTTPS for selecting audio output device  ");L.Logger.warning("[tk-sdk]setSinkId error:",b,e?e:"",g?" , element id is "+g:"  element:",g?"":a);d++;d===f&&c&&"function"===typeof c&&
c(!1)})}catch(F){e=a.getAttribute("id"),L.Logger.error("[tk-sdk]setSinkId err:",F,e?" , element id is "+e:"  element:",e?"":a),d++,d===f&&c&&"function"===typeof c&&c(!1)}else e=a.getAttribute("id"),L.Logger.error("[tk-sdk]The browser does not support the setSinkId method,audiooutputDeviceId :",b,e?" , element id is "+e:"  element:",e?"":a),d++,d===f&&c&&"function"===typeof c&&c(!1);else d++,d===f&&c&&"function"===typeof c&&c(!1)};if(!a){a=[];var f=document.getElementsByTagName("audio"),g=document.getElementsByTagName("video");
if(f&&0<f.length)for(var k=0;k<f.length;k++){var m=f[k];a.push(m)}if(g&&0<g.length)for(k=0;k<g.length;k++)m=g[k],a.push(m)}if(a&&0<a.length)for(f=a.length,k=0;k<a.length;k++)m=a[k],e(m,k,f);else e(a,0,1)}else c&&"function"===typeof c&&c(!1)};a.changeLocalDeviceToLocalstream=function(b,c,d,e){var f={},g;for(g in c)L.Constant.deviceStorage[g]&&c[g]!==L.Utils.localStorage.getItem(L.Constant.deviceStorage[g])&&(L.Utils.localStorage.setItem(L.Constant.deviceStorage[g],c[g]),f[g]=!0);!f.videoinput&&!f.audioinput&&
TK&&TK.default_stream&&TK.default_stream.stream&&(c.videoinput&&TK.default_stream.stream.getVideoTracks&&TK.default_stream.stream.getVideoTracks()&&0===TK.default_stream.stream.getVideoTracks().length&&(f.videoinput=!0),c.audioinput&&TK.default_stream.stream.getAudioTracks&&TK.default_stream.stream.getAudioTracks()&&0===TK.default_stream.stream.getAudioTracks().length&&(f.audioinput=!0));(f.videoinput||f.audioinput)&&a.getUserMedia(function(a){b&&"function"===typeof b&&b(a);d&&"function"===typeof d&&
d(a)},void 0,void 0,{isDemotionLocalStream:!0,isNeedCheckChangeLocalStream:!1,isStopLocalStream:!1});e&&0<e.length&&a.setElementSinkIdToAudioouputDevice(e)};a.addOndevicechange=function(a){if(!navigator.mediaDevices)return L.Logger.error("Browser does not support navigator.mediaDevices!"),!1;if(navigator.mediaDevices)return navigator.mediaDevices.ondevicechange=null,navigator.mediaDevices.ondevicechange=function(b){L.Logger.debug("[tk-sdk]AVMgr:ondevicechange event:",b);a&&"function"===typeof a&&
a(b)},!0};a.removeOndevicechange=function(){if(!navigator.mediaDevices)return L.Logger.error("Browser does not support navigator.mediaDevices!"),!1;if(!navigator.mediaDevices.ondevicechange)return!1;navigator.mediaDevices.ondevicechange=null;return!0};a.stopStreamTracks=function(a,c,d){b(a,c,d)};return a}(TK);TK=TK||{};
TK.NativeAVMgr=function(){var b={room_video_width:320,room_video_height:240,room_video_fps:10},a={},f={},e=100;b.setAVMgrProperty=function(a){for(var c in a)b.hasOwnProperty(c)&&(b[c]=a[c])};tknative.addEventListener("message",function(b){var c=b.data.name;if("onEnumerateDevices"===c){var d=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput),e=L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput),l=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput);L.Logger.debug("devices in enumerateDevices(client):",
b.data);var p=b.data.audioinput,n=b.data.videoinput,u=b.data.audiooutput,t=b.data.seq,w={},A={},C={hasdevice:{audioinput:!1,audiooutput:!1,videoinput:!1},devices:{audioinput:[],audiooutput:[],videoinput:[]},useDevices:{}},y=function(a){null!=a&&"communications"!=a.groupId&&"communications"!=a.deiceId&&"\u901a\u8baf"!=a.label&&("audioinput"===a.kind&&a.deviceId===d&&(C.useDevices[a.kind]=a.deviceId),"videoinput"===a.kind&&a.deviceId===e&&(C.useDevices[a.kind]=a.deviceId),"audiooutput"===a.kind&&a.deviceId===
l&&(C.useDevices[a.kind]=a.deviceId),w[a.kind]=a.deviceId,C.devices[a.kind].push(a),C.hasdevice[a.kind]=!0,"default"===a.deviceId&&(A[a.kind]=a.deviceId))};Array.isArray(p)&&p.forEach(function(a){y(a)});Array.isArray(n)&&n.forEach(function(a){y(a)});Array.isArray(u)&&u.forEach(function(a){y(a)});C.useDevices.audioinput||(C.useDevices.audioinput=A.audioinput||w.audioinput||"");C.useDevices.videoinput||(C.useDevices.videoinput=A.videoinput||w.videoinput||"");C.useDevices.audiooutput||(C.useDevices.audiooutput=
A.audiooutput||w.audiooutput||"");L.Utils.localStorage?f[t].isSetlocalStorage&&(L.Utils.localStorage.setItem(L.Constant.deviceStorage.audioinput,C.useDevices.audioinput),L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,C.useDevices.videoinput),L.Utils.localStorage.setItem(L.Constant.deviceStorage.audiooutput,C.useDevices.audiooutput)):L.Logger.error("not support localStorage");a[t]&&(a[t](C),delete a[t]);f[t]&&delete f[t]}if("onMicVolumeReport"===c){p=b.data.volume;if(null===p||void 0===
p)return;if(a["detecte-mic-callback"]&&"function"===typeof a["detecte-mic-callback"])a["detecte-mic-callback"](p/100)}"onGetSpeakerVolume"===c&&(p=b.data.volume,t=b.data.seq,"function"===typeof a[t]&&(p=Math.round(p/2.55),a[t](p),delete a[t]))},!1);var c=function(a,c,e,f){var d=function(b){tknative.postMessage({command:"setCamera",deviceId:b.video.deviceId,width:Number(b.video.width),height:Number(b.video.height),fps:Number(b.video.frameRate)});tknative.postMessage({command:"setMicrophone",deviceId:b.audio.deviceId});
a(null)};e=e||{audio:{},video:{}};if(e.screen)L.Logger.debug("[tk-sdk]Screen access requested!"),a(null);else{var g={video:{},audio:{},screen:e.screen};"object"===typeof e.audio&&(g.audio=e.audio);f=void 0!=f&&null!=f&&"object"===typeof f?f:{video:{},audio:{},exclude:{}};f.video=f.video||{};f.audio=f.audio||{};var k=e.audio.mandatory||{sourceId:f.audio.sourceId||L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput)||""},m=e.video.mandatory||{sourceId:f.video.sourceId||L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput)||
"",idealWidth:b.room_video_width||320,maxWidth:b.room_video_width||320,idealHeight:b.room_video_height||240,maxHeight:b.room_video_height||240};g.video.width=m.maxWidth;g.video.height=m.maxHeight;void 0!==e.video.optional?g.video.frameRate=e.video.optional[1].maxFrameRate:(c={idealFrameRate:Number(b.room_video_fps||10),maxFrameRate:Number(b.room_video_fps||10)},void 0!=c.idealFrameRate&&void 0!=c.maxFrameRate?g.video.frameRate=c.maxFrameRate:void 0!=c.frameRate&&(g.video.frameRate=c.frameRate));m.sourceId&&
k.sourceId?(null!==k.sourceId&&void 0!==k.sourceId?g.audio.deviceId=k.sourceId:g.audio=!1,null!==m.sourceId&&void 0!==m.sourceId?g.video.deviceId=m.sourceId:g.video=!1,f.exclude&&f.exclude.video?g.video=!1:f.exclude&&f.exclude.audio&&(g.audio=!1),d(g)):b.enumerateDevices(function(a){var b=a.useDevices;a=a.hasdevice;null===a.videoinput||void 0===a.videoinput||null===b.videoinput||void 0===b.videoinput||m.sourceId||(m.sourceId=b.videoinput,L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,
m.sourceId));null===a.audioinput||void 0===a.audioinput||null===b.audioinput||void 0===b.audioinput||k.sourceId||(k.sourceId=b.audioinput,L.Utils.localStorage.setItem(L.Constant.deviceStorage.audioinput,k.sourceId));null!==k.sourceId&&void 0!==k.sourceId?g.audio.deviceId=k.sourceId:g.audio=!1;null!==m.sourceId&&void 0!==m.sourceId?g.video.deviceId=m.sourceId:g.video=!1;f.exclude&&f.exclude.video?g.video=!1:f.exclude&&f.exclude.audio&&(g.audio=!1);d(g)})}};b.getUserMedia=function(a,b,e,f){c(a,b,e,
f)};b.startDetecteMic=function(c,e){b.stopDetectMic();tknative.postMessage({command:"startDetecteMic",deviceId:c});a["detecte-mic-callback"]=e};b.stopDetectMic=function(){tknative.postMessage({command:"stopDetecteMic"});delete a["detecte-mic-callback"]};b.startDetecteCam=function(a,c){b.stopDetecteCam();tknative.postMessage({command:"startDetecteCam",deviceId:a,args:c})};b.stopDetecteCam=function(){tknative.postMessage({command:"stopDetecteCam"})};b.enumerateDevices=function(b,c){var d=e++;a[d]=b;
b={};b.isSetlocalStorage=void 0===c?!1:void 0!=c.isSetlocalStorage?c.isSetlocalStorage:!1;f[d]=b;tknative.postMessage({command:"enumerateDevices",seq:d})};b.setSpeaker=function(a){tknative.postMessage({command:"setSpeaker",deviceId:a})};b.getsSoundMeterInstance=function(a){if(a)return new function(a){var b=this;b.audioContext=a;b.instant=0;b.slow=0;b.clip=0;b.script=b.audioContext.createScriptProcessor(2048,1,1);b.script.onaudioprocess=function(a){a=a.inputBuffer.getChannelData(0);var c,d=0,e=0;for(c=
0;c<a.length;++c)d+=a[c]*a[c],.99<Math.abs(a[c])&&(e+=1);b.instant=Math.sqrt(d/a.length);b.slow=.95*b.slow+.05*b.instant;b.clip=e/a.length};b.connectToSource=function(a,c){L.Logger.debug("SoundMeter connecting");try{b.mic=b.audioContext.createMediaStreamSource(a),b.mic.connect(b.script),b.script.connect(b.audioContext.destination),"undefined"!==typeof c&&c(null)}catch(p){L.Logger.error(p),"undefined"!==typeof c&&c(p)}};b.stop=function(){b.mic.disconnect();b.script.disconnect()};return b}(a);L.Logger.error("[tk-sdk]getsSoundMeterInstance audioContext is not exist!")};
b.setElementSinkIdToAudioouputDevice=function(a,b,c){b=b||L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput);tknative.postMessage({command:"setSpeaker",deviceId:b});c&&"function"===typeof c&&c()};b.changeLocalDeviceToLocalstream=function(a,c,e,f){var d={},g;for(g in c)L.Constant.deviceStorage[g]&&c[g]!==L.Utils.localStorage.getItem(L.Constant.deviceStorage[g])&&(L.Utils.localStorage.setItem(L.Constant.deviceStorage[g],c[g]),d[g]=!0);(d.videoinput||d.audioinput)&&b.getUserMedia(function(b){a&&
"function"===typeof a&&a(b);e&&"function"===typeof e&&e(b)},void 0,void 0,{isDemotionLocalStream:!0,isNeedCheckChangeLocalStream:!1,isStopLocalStream:!1});f&&0<f.length&&b.setElementSinkIdToAudioouputDevice(f)};b.addOndevicechange=function(a){};b.removeOndevicechange=function(){};b.getSpeakerVolume=function(b){if("function"!==typeof b)L.Logger.error("[tk-sdk] wrong arguments in funciton getSpeakerVolume");else{var c=e++;a[c]=b;tknative.postMessage({command:"getSpeakerVolume",seq:c})}};b.setSpeakerVolume=
function(a){void 0===a||null===a||0>a||100<a?L.Logger.error("[tk-sdk] invalid arguments in funciton setSpeakerVolume"):(a=Math.round(2.55*a),tknative.postMessage({command:"setSpeakerVolume",volume:a}))};return b};
